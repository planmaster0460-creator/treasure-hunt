<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0A2463">
<title>2026 ëŒ€ì „ ì‚¬ì´ì–¸ìŠ¤ í˜ìŠ¤í‹°ë²Œ - AI ìŠ¤íƒ¬í”„ íˆ¬ì–´</title>
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@300;400;500;700;900&family=Jua&family=Do+Hyeon&family=Gugi&family=Gaegu&family=Gamja+Flower&family=Gothic+A1:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body,#root{width:100%;min-height:100vh;min-height:100dvh}
body{font-family:'Noto Sans KR',sans-serif;-webkit-font-smoothing:antialiased;overscroll-behavior:none}
input,textarea,select,button{font-family:inherit;outline:none}
button{cursor:pointer}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#ccc;border-radius:4px}
@keyframes floatDown{0%{transform:translateY(-10vh) rotate(0);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(110vh) rotate(360deg);opacity:0}}
@keyframes heroFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes bounceIn{0%{transform:scale(.3);opacity:0}50%{transform:scale(1.05)}70%{transform:scale(.95)}100%{transform:scale(1);opacity:1}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes scanLine{0%{top:10%}50%{top:85%}100%{top:10%}}
@keyframes blink{0%,100%{opacity:.2}50%{opacity:1}}
@keyframes stampPop{0%{transform:scale(0) rotate(-180deg)}60%{transform:scale(1.3) rotate(10deg)}100%{transform:scale(1) rotate(0)}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script>
"use strict";
const e=React.createElement,{useState,useEffect,useRef,useCallback}=React;

const DEFAULT_CONFIG={
festivalName:"2026 ëŒ€ì „ ì‚¬ì´ì–¸ìŠ¤ í˜ìŠ¤í‹°ë²Œ",
subtitle:"ëª¨ë°”ì¼ AI ìŠ¤íƒ¬í”„ íˆ¬ì–´",
primaryColor:"#0A2463",secondaryColor:"#00B4D8",accentColor:"#FB8500",
bgColor:"#F0F7FF",textColor:"#1B1B2F",cardBg:"#FFFFFF",
fontFamily:"'Noto Sans KR', sans-serif",titleFont:"'Black Han Sans', sans-serif",
completionMessage:"ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰\nëª¨ë“  ìŠ¤íƒ¬í”„ë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤!\nì¢…í•©ì•ˆë‚´ì†Œì—ì„œ ì„ ë¬¼ì„ ìˆ˜ë ¹í•˜ì„¸ìš”!",
festivalInfo:"2026 ëŒ€ì „ ì‚¬ì´ì–¸ìŠ¤ í˜ìŠ¤í‹°ë²Œì€ ëŒ€ì „ê´‘ì—­ì‹œ ì—‘ìŠ¤í¬ì‹œë¯¼ê´‘ì¥ ì¼ëŒ€ì—ì„œ ê°œìµœë©ë‹ˆë‹¤.\n\nâ–¶ ê¸°ê°„: 2026ë…„ 10ì›” 15ì¼ ~ 10ì›” 20ì¼\nâ–¶ ì¥ì†Œ: ëŒ€ì „ ì—‘ìŠ¤í¬ì‹œë¯¼ê´‘ì¥ ë° ê³¼í•™ë¬¸í™”ê±°ë¦¬\nâ–¶ ì£¼ìµœ: ëŒ€ì „ê´‘ì—­ì‹œ\nâ–¶ ì£¼ê´€: ëŒ€ì „ê´€ê´‘ê³µì‚¬\n\në‹¤ì–‘í•œ ê³¼í•™ ì²´í—˜ í”„ë¡œê·¸ë¨ê³¼ ê³µì—°, ì „ì‹œê°€ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
heroImage:null,stampImage:null,stampEmptyImage:null,mapImage:null,
locations:[
{id:"loc1",name:"ê³¼í•™ì²´í—˜ê´€",icon:"ğŸ”¬",code:"DJSF2026-A1",mission:"ê³¼í•™ì²´í—˜ê´€ì—ì„œ VR ìš°ì£¼íƒí—˜ì„ ì²´í—˜í•˜ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ì²¨ë‹¨ ê³¼í•™ê¸°ìˆ ì„ ì§ì ‘ ì²´í—˜í•  ìˆ˜ ìˆëŠ” ê³µê°„",iconImage:null},
{id:"loc2",name:"ë¡œì¼“ì „ì‹œì¥",icon:"ğŸš€",code:"DJSF2026-B2",mission:"í•œêµ­í˜• ë°œì‚¬ì²´ ëˆ„ë¦¬í˜¸ ëª¨í˜• ì•ì—ì„œ ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ìš°ì£¼ ë°œì‚¬ì²´ì™€ ìœ„ì„±ì˜ ì—­ì‚¬ë¥¼ í•œëˆˆì—",iconImage:null},
{id:"loc3",name:"AIë¡œë´‡ê´€",icon:"ğŸ¤–",code:"DJSF2026-C3",mission:"AI ë¡œë´‡ê³¼ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ì¸ê³µì§€ëŠ¥ê³¼ ë¡œë´‡ì˜ ë¯¸ë˜ë¥¼ ë§Œë‚˜ëŠ” ê³³",iconImage:null},
{id:"loc4",name:"ìƒëª…ê³¼í•™ê´€",icon:"ğŸ§¬",code:"DJSF2026-D4",mission:"DNA ì¶”ì¶œ ì²´í—˜ì„ ì™„ë£Œí•˜ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ìƒëª…ì˜ ì‹ ë¹„ë¥¼ íƒêµ¬í•˜ëŠ” ì²´í—˜ ê³µê°„",iconImage:null},
{id:"loc5",name:"ì—ë„ˆì§€íŒŒë¹Œë¦¬ì˜¨",icon:"âš¡",code:"DJSF2026-E5",mission:"ì‹ ì¬ìƒì—ë„ˆì§€ í€´ì¦ˆë¥¼ í’€ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ë¯¸ë˜ ì—ë„ˆì§€ ê¸°ìˆ ì„ ë°°ìš°ëŠ” ì¹œí™˜ê²½ ê³µê°„",iconImage:null},
{id:"loc6",name:"ì²œë¬¸ìš°ì£¼ê´€",icon:"ğŸŒŒ",code:"DJSF2026-F6",mission:"ì²œì²´ë§ì›ê²½ìœ¼ë¡œ ë³„ì„ ê´€ì¸¡í•˜ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ë³„ê³¼ ìš°ì£¼ì˜ ì‹ ë¹„ë¥¼ íƒí—˜í•˜ëŠ” ê³³",iconImage:null}
]};

const ADMIN_PW="0460";
const EMOJIS=["ğŸ”¬","ğŸš€","ğŸ¤–","ğŸ§¬","âš¡","ğŸŒŒ","ğŸª","ğŸ­","ğŸ¨","ğŸµ","ğŸ›","ğŸŒ³","ğŸ¡","ğŸ¢","ğŸ¯","ğŸ†","â­","ğŸ’","ğŸ”­","ğŸ§ª","ğŸ§²","ğŸŒ","â˜€ï¸","ğŸŒŠ","ğŸ¦•","ğŸ‰","ğŸ“","ğŸ“¡","ğŸ’¡","ğŸˆ","ğŸ","ğŸ…","ğŸ”®","ğŸ›¸","ğŸŒˆ","ğŸ¶","ğŸ–¼","ğŸ—¿","â›©","ğŸ°"];

// Storage helpers using localStorage
function LS(k,v){if(v===undefined){try{const d=localStorage.getItem(k);return d?JSON.parse(d):null}catch{return null}}else{try{localStorage.setItem(k,JSON.stringify(v))}catch{}}}

function getQR(data,sz){return`https://api.qrserver.com/v1/create-qr-code/?size=${sz||200}x${sz||200}&data=${encodeURIComponent(data)}&format=png&margin=8`}

function handleImgUpload(cb,maxSz){
const inp=document.createElement("input");inp.type="file";inp.accept="image/*";
inp.onchange=function(ev){const f=ev.target.files[0];if(!f)return;const r=new FileReader();
r.onload=function(re){const img=new Image();img.onload=function(){
const c=document.createElement("canvas");let w=img.width,h=img.height;
if(w>(maxSz||800)||h>(maxSz||800)){if(w>h){h=(h/w)*(maxSz||800);w=maxSz||800}else{w=(w/h)*(maxSz||800);h=maxSz||800}}
c.width=w;c.height=h;c.getContext("2d").drawImage(img,0,0,w,h);cb(c.toDataURL("image/png",0.85))};
img.src=re.target.result};r.readAsDataURL(f)};inp.click()}

function App(){
const[config,setConfig]=useState(()=>LS("djsf-config")||DEFAULT_CONFIG);
const[screen,setScreen]=useState("register");
const[user,setUser]=useState(null);
const[stamps,setStamps]=useState({});
const[showAdmin,setShowAdmin]=useState(false);
const[adminAuth,setAdminAuth]=useState(false);
const[adminPw,setAdminPw]=useState("");
const[adminTab,setAdminTab]=useState("locations");
const[chatMsgs,setChatMsgs]=useState([]);
const[chatIn,setChatIn]=useState("");
const[chatLoad,setChatLoad]=useState(false);
const[scanRes,setScanRes]=useState(null);
const[reg,setReg]=useState({name:"",birth:"",phone:"",agree:false});
const[showComp,setShowComp]=useState(false);
const[editLoc,setEditLoc]=useState(null);
const[parts,setParts]=useState(()=>LS("djsf-parts")||[]);
const[pwErr,setPwErr]=useState(false);
const[showMap,setShowMap]=useState(false);
const[emojiPick,setEmojiPick]=useState(null);
const[scanning,setScanning]=useState(false);
const[camErr,setCamErr]=useState(null);

const chatEnd=useRef(null);
const acnt=useRef(0),atimer=useRef(null);
const vidRef=useRef(null),canRef=useRef(null),strRef=useRef(null),animRef=useRef(null);

const saveCfg=(nc)=>{setConfig(nc);LS("djsf-config",nc)};
const saveParts=(l)=>{setParts(l);LS("djsf-parts",l)};

const allDone=config.locations.length>0&&config.locations.every(l=>stamps[l.id]);
const cnt=config.locations.filter(l=>stamps[l.id]).length;

useEffect(()=>{if(allDone&&!showComp&&screen==="tour")setShowComp(true)},[allDone,screen]);
useEffect(()=>{chatEnd.current?.scrollIntoView({behavior:"smooth"})},[chatMsgs]);

// Admin 3-tap
const adminTap=()=>{acnt.current++;clearTimeout(atimer.current);
if(acnt.current>=3){acnt.current=0;setShowAdmin(true)}
atimer.current=setTimeout(()=>{acnt.current=0},1200)};

// Register
const doReg=()=>{if(!reg.name||!reg.birth||!reg.phone||!reg.agree)return;
const u={name:reg.name,birth:reg.birth,phone:reg.phone,time:new Date().toISOString()};
setUser(u);saveParts([...parts,u]);setScreen("tour")};

// QR Scanner
const startScan=async()=>{setScanning(true);setCamErr(null);setScanRes(null);
try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});
strRef.current=s;if(vidRef.current){vidRef.current.srcObject=s;vidRef.current.setAttribute("playsinline","true");
await vidRef.current.play();doScanFrame()}}catch(er){
setCamErr(er.name==="NotAllowedError"?"ì¹´ë©”ë¼ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.":"ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nhttps(ë³´ì•ˆì—°ê²°)ì—ì„œë§Œ ì¹´ë©”ë¼ê°€ ì‘ë™í•©ë‹ˆë‹¤.")}};

const doScanFrame=()=>{
if(!vidRef.current||!canRef.current||!window.jsQR){animRef.current=requestAnimationFrame(doScanFrame);return}
const v=vidRef.current,c=canRef.current;
if(v.readyState!==v.HAVE_ENOUGH_DATA){animRef.current=requestAnimationFrame(doScanFrame);return}
c.width=v.videoWidth;c.height=v.videoHeight;
const ctx=c.getContext("2d",{willReadFrequently:true});ctx.drawImage(v,0,0,c.width,c.height);
const img=ctx.getImageData(0,0,c.width,c.height);
const code=window.jsQR(img.data,img.width,img.height,{inversionAttempts:"dontInvert"});
if(code&&code.data){onScanned(code.data);return}
animRef.current=requestAnimationFrame(doScanFrame)};

const onScanned=(data)=>{const loc=config.locations.find(l=>l.code===data);
if(loc){if(stamps[loc.id]){setScanRes({ok:false,msg:'ì´ë¯¸ "'+loc.name+'" ìŠ¤íƒ¬í”„ë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤!',icon:"ğŸ”„"})}
else{setStamps(p=>({...p,[loc.id]:true}));setScanRes({ok:true,msg:'"'+loc.name+'" ìŠ¤íƒ¬í”„ íšë“!',icon:"ğŸ‰"})}}
else{setScanRes({ok:false,msg:"ìœ íš¨í•˜ì§€ ì•Šì€ QRì½”ë“œì…ë‹ˆë‹¤.",icon:"âŒ"})}
stopScan()};

const stopScan=()=>{if(animRef.current)cancelAnimationFrame(animRef.current);
if(strRef.current)strRef.current.getTracks().forEach(t=>t.stop());strRef.current=null;setScanning(false)};

// AI Chat
const sendChat=async()=>{if(!chatIn.trim()||chatLoad)return;const msg=chatIn.trim();setChatIn("");
setChatMsgs(p=>[...p,{role:"user",text:msg}]);setChatLoad(true);
try{const r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,
system:'ë‹¹ì‹ ì€ "'+config.festivalName+'"ì˜ AI ì•ˆë‚´ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ì¹œì ˆí•˜ê³  ê°„ê²°í•˜ê²Œ(3-4ë¬¸ì¥) ë‹µë³€í•˜ì„¸ìš”.\n\n[ì¶•ì œ ì •ë³´]\n'+config.festivalInfo+'\n\n[ìŠ¤íƒ¬í”„ íˆ¬ì–´ ì¥ì†Œ]\n'+config.locations.map((l,i)=>(i+1)+". "+l.name+": "+l.desc+" - ë¯¸ì…˜: "+l.mission).join("\n")+"\n\nì´ "+config.locations.length+"ê°œ ì¥ì†Œ ë°©ë¬¸ â†’ QR ìŠ¤ìº” â†’ ìŠ¤íƒ¬í”„ ìˆ˜ì§‘ â†’ ì¢…í•©ì•ˆë‚´ì†Œì—ì„œ ì„ ë¬¼ ìˆ˜ë ¹",
messages:[...chatMsgs.slice(-10).map(m=>({role:m.role==="user"?"user":"assistant",content:m.text})),{role:"user",content:msg}]})});
const d=await r.json();const txt=d.content?d.content.map(c=>c.text||"").join(""):"ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
setChatMsgs(p=>[...p,{role:"assistant",text:txt}])}catch{setChatMsgs(p=>[...p,{role:"assistant",text:"ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."}])}
setChatLoad(false)};

const C=config; // shorthand

// â”€â”€ StampIcon component
function SI(props){const{loc,size,stamped}=props;const sz=size||44;
if(stamped&&C.stampImage)return e("img",{src:C.stampImage,style:{width:sz,height:sz,borderRadius:sz*.25,objectFit:"cover",animation:"stampPop .5s"}});
if(!stamped&&C.stampEmptyImage)return e("img",{src:C.stampEmptyImage,style:{width:sz,height:sz,borderRadius:sz*.25,objectFit:"cover",opacity:.45}});
if(loc?.iconImage)return e("div",{style:{width:sz,height:sz,borderRadius:sz*.25,overflow:"hidden",border:stamped?"3px solid "+C.accentColor:"3px solid #e2e8f0"}},
e("img",{src:loc.iconImage,style:{width:"100%",height:"100%",objectFit:"cover"}}));
return e("div",{style:{width:sz,height:sz,borderRadius:"50%",background:stamped?"linear-gradient(135deg,"+C.accentColor+","+C.secondaryColor+")":"#e2e8f0",
display:"flex",alignItems:"center",justifyContent:"center",fontSize:sz*.45,color:stamped?"#fff":"#b0b8c4",fontWeight:800,
transition:"all .4s cubic-bezier(.34,1.56,.64,1)",boxShadow:stamped?"0 4px 16px "+C.accentColor+"55":"inset 0 2px 4px rgba(0,0,0,.06)",
transform:stamped?"scale(1)":"scale(.92)"}},stamped?"âœ“":(loc?.icon||"?"))}

// â”€â”€ Admin PW Modal
function PwModal(){return e("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.6)",zIndex:2000,display:"flex",alignItems:"center",justifyContent:"center",padding:20,backdropFilter:"blur(4px)"}},
e("div",{style:{background:"#fff",borderRadius:20,padding:"28px 24px",width:"100%",maxWidth:320,textAlign:"center",boxShadow:"0 20px 60px rgba(0,0,0,.3)"}},
e("div",{style:{fontSize:32,marginBottom:8}},"ğŸ”"),
e("p",{style:{fontSize:15,fontWeight:700,marginBottom:18,color:"#333"}},"ê´€ë¦¬ì ì¸ì¦"),
e("input",{type:"password",inputMode:"numeric",value:adminPw,onChange:ev=>{setAdminPw(ev.target.value);setPwErr(false)},
placeholder:"ë¹„ë°€ë²ˆí˜¸ ì…ë ¥",maxLength:10,autoFocus:true,
onKeyDown:ev=>{if(ev.key==="Enter"){if(adminPw===ADMIN_PW){setAdminAuth(true);setScreen("admin");setShowAdmin(false)}else setPwErr(true)}},
style:{width:"100%",padding:14,borderRadius:12,border:"2px solid "+(pwErr?"#ef4444":"#e2e8f0"),fontSize:18,textAlign:"center",boxSizing:"border-box",letterSpacing:8}}),
pwErr&&e("p",{style:{color:"#ef4444",fontSize:12,marginTop:8}},"ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤"),
e("div",{style:{display:"flex",gap:10,marginTop:18}},
e("button",{onClick:()=>{setShowAdmin(false);setAdminPw("");setPwErr(false)},style:{flex:1,padding:12,borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:14}},"ì·¨ì†Œ"),
e("button",{onClick:()=>{if(adminPw===ADMIN_PW){setAdminAuth(true);setScreen("admin");setShowAdmin(false)}else setPwErr(true)},
style:{flex:1,padding:12,borderRadius:10,border:"none",background:C.primaryColor,color:"#fff",fontSize:14,fontWeight:700}},"í™•ì¸"))))}

// Hidden admin trigger area
const adminArea=e("div",{onClick:adminTap,style:{position:"fixed",top:0,right:0,width:50,height:50,zIndex:999}});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REGISTER SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
if(screen==="register"){
const ok=reg.name&&reg.birth.length>=6&&reg.phone.length>=12&&reg.agree;
return e("div",{style:{fontFamily:C.fontFamily,minHeight:"100vh",minHeight:"100dvh",background:"linear-gradient(160deg,"+C.primaryColor+","+C.secondaryColor+")",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,position:"relative"}},
adminArea,
showAdmin&&!adminAuth&&e(PwModal),
// Particles
e("div",{style:{position:"fixed",inset:0,overflow:"hidden",pointerEvents:"none"}},
[0,1,2,3,4,5].map(i=>e("div",{key:i,style:{position:"absolute",width:6,height:6,borderRadius:"50%",background:"rgba(255,255,255,.15)",left:(15+i*15)+"%",top:"-10%",animation:"floatDown "+(8+i*2)+"s linear infinite",animationDelay:i*1.5+"s"}}))),
// Hero
C.heroImage?e("img",{src:C.heroImage,style:{width:140,height:140,objectFit:"contain",marginBottom:10,filter:"drop-shadow(0 8px 24px rgba(0,0,0,.3))",animation:"heroFloat 3s ease-in-out infinite"}}):
e("div",{style:{width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,.15)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:56,marginBottom:10,backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,.2)",animation:"heroFloat 3s ease-in-out infinite"}},"ğŸ”¬"),
e("h1",{style:{fontFamily:C.titleFont,fontSize:28,color:"#fff",margin:"0 0 4px",textShadow:"0 3px 12px rgba(0,0,0,.3)",textAlign:"center"}},C.festivalName),
e("p",{style:{color:"rgba(255,255,255,.85)",fontSize:14,letterSpacing:3,marginBottom:24,fontWeight:500}},C.subtitle),
// Form card
e("div",{style:{background:"rgba(255,255,255,.97)",borderRadius:24,padding:"28px 22px",width:"100%",maxWidth:380,boxShadow:"0 24px 64px rgba(0,0,0,.2)"}},
e("h2",{style:{fontSize:17,fontWeight:800,color:C.textColor,marginBottom:20,textAlign:"center"}},"ğŸ« ì°¸ì—¬ ë“±ë¡"),
// Fields
[{k:"name",l:"ì´ë¦„",ph:"í™ê¸¸ë™",im:"text"},{k:"birth",l:"ì£¼ë¯¼ë²ˆí˜¸ ì•ìë¦¬ (6ìë¦¬)",ph:"990101",im:"numeric",mx:6},{k:"phone",l:"íœ´ëŒ€í° ë²ˆí˜¸",ph:"010-1234-5678",im:"tel"}].map(f=>
e("div",{key:f.k,style:{marginBottom:14}},
e("label",{style:{fontSize:12,fontWeight:600,color:"#64748b",display:"block",marginBottom:5}},f.l),
e("input",{value:reg[f.k],inputMode:f.im,maxLength:f.mx||20,placeholder:f.ph,
onChange:ev=>{let v=ev.target.value;
if(f.k==="birth")v=v.replace(/\D/g,"").slice(0,6);
if(f.k==="phone"){v=v.replace(/\D/g,"").slice(0,11);if(v.length>7)v=v.slice(0,3)+"-"+v.slice(3,7)+"-"+v.slice(7);else if(v.length>3)v=v.slice(0,3)+"-"+v.slice(3)}
setReg(p=>({...p,[f.k]:v}))},
style:{width:"100%",padding:"13px 14px",borderRadius:12,border:"2px solid #e8edf2",fontSize:15,boxSizing:"border-box"}}))),
// Agree
e("label",{style:{display:"flex",alignItems:"flex-start",gap:10,padding:14,background:"#f8fafc",borderRadius:12,marginBottom:20,cursor:"pointer",border:reg.agree?"2px solid "+C.primaryColor+"30":"2px solid transparent"}},
e("input",{type:"checkbox",checked:reg.agree,onChange:ev=>setReg(p=>({...p,agree:ev.target.checked})),style:{marginTop:2,width:20,height:20,accentColor:C.primaryColor,flexShrink:0}}),
e("span",{style:{fontSize:11,color:"#64748b",lineHeight:1.6},dangerouslySetInnerHTML:{__html:'<strong style="color:'+C.primaryColor+'">[í•„ìˆ˜]</strong> ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.<br>ìˆ˜ì§‘í•­ëª©: ì´ë¦„, ì£¼ë¯¼ë²ˆí˜¸ ì•ìë¦¬, íœ´ëŒ€í°ë²ˆí˜¸<br>ëª©ì : ìŠ¤íƒ¬í”„ íˆ¬ì–´ ì°¸ì—¬ ë° ê²½í’ˆ ì§€ê¸‰<br>ë³´ìœ ê¸°ê°„: í–‰ì‚¬ ì¢…ë£Œ í›„ 1ê°œì›” ì´ë‚´ íŒŒê¸°'}})),
// Submit
e("button",{onClick:doReg,disabled:!ok,style:{width:"100%",padding:15,borderRadius:14,border:"none",
background:ok?"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")":"#cbd5e1",color:"#fff",fontSize:17,fontWeight:800,
cursor:ok?"pointer":"not-allowed",transition:"all .3s",boxShadow:ok?"0 6px 24px "+C.primaryColor+"44":"none",fontFamily:C.titleFont,letterSpacing:1}},"ğŸš€ íˆ¬ì–´ ì‹œì‘í•˜ê¸°")),
e("p",{style:{color:"rgba(255,255,255,.5)",fontSize:10,marginTop:20,textAlign:"center"}},"Â© 2026 ëŒ€ì „ê´‘ì—­ì‹œ"))}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
if(screen==="admin"&&adminAuth){
const tabs=[{id:"locations",ic:"ğŸ“",l:"ì¥ì†Œ"},{id:"design",ic:"ğŸ¨",l:"ë””ìì¸"},{id:"qrcodes",ic:"ğŸ“±",l:"QRì½”ë“œ"},{id:"festival",ic:"ğŸ“‹",l:"ì¶•ì œì •ë³´"},{id:"users",ic:"ğŸ‘¥",l:"ì°¸ê°€ì"}];
return e("div",{style:{fontFamily:C.fontFamily,background:"#f1f5f9",minHeight:"100vh"}},
// Header
e("div",{style:{background:"#1e293b",color:"#fff",padding:"14px 18px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100}},
e("div",{style:{display:"flex",alignItems:"center",gap:8}},e("span",{style:{fontSize:18}},"âš™ï¸"),e("span",{style:{fontWeight:800,fontSize:15}},"ê´€ë¦¬ì ëª¨ë“œ")),
e("button",{onClick:()=>setScreen(user?"tour":"register"),style:{background:"rgba(255,255,255,.12)",border:"none",color:"#fff",padding:"7px 14px",borderRadius:8,fontSize:12,fontWeight:600}},"âœ• ë‚˜ê°€ê¸°")),
// Tabs
e("div",{style:{display:"flex",overflowX:"auto",background:"#fff",borderBottom:"2px solid #f1f5f9",position:"sticky",top:49,zIndex:99}},
tabs.map(t=>e("button",{key:t.id,onClick:()=>setAdminTab(t.id),style:{padding:"11px 14px",border:"none",borderBottom:adminTab===t.id?"3px solid "+C.primaryColor:"3px solid transparent",background:"transparent",color:adminTab===t.id?C.primaryColor:"#94a3b8",fontWeight:adminTab===t.id?700:400,fontSize:12,whiteSpace:"nowrap"}},t.ic+" "+t.l))),
// Content
e("div",{style:{padding:16,maxWidth:600,margin:"0 auto"}},

// â”€â”€ LOCATIONS TAB
adminTab==="locations"&&e("div",null,
e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}},
e("h3",{style:{fontSize:15,fontWeight:800,margin:0}},"ìŠ¤íƒ¬í”„ ì¥ì†Œ ("+C.locations.length+"ê°œ)"),
e("button",{onClick:()=>{const nl={id:"loc"+Date.now(),name:"ìƒˆ ì¥ì†Œ",icon:"ğŸ“",code:"DJSF2026-"+String.fromCharCode(65+C.locations.length)+(C.locations.length+1),mission:"ë¯¸ì…˜ ë‚´ìš© ì…ë ¥",desc:"ì¥ì†Œ ì„¤ëª… ì…ë ¥",iconImage:null};saveCfg({...C,locations:[...C.locations,nl]});setEditLoc(nl.id)},
style:{background:C.primaryColor,color:"#fff",border:"none",padding:"8px 14px",borderRadius:8,fontSize:12,fontWeight:700}},
"+ ì¥ì†Œ ì¶”ê°€")),
C.locations.map((loc,idx)=>e("div",{key:loc.id,style:{background:"#fff",borderRadius:14,padding:16,marginBottom:10,boxShadow:"0 1px 3px rgba(0,0,0,.05)",border:editLoc===loc.id?"2px solid "+C.primaryColor:"1px solid #f1f5f9"}},
editLoc===loc.id?
// Edit mode
e("div",null,
e("div",{style:{marginBottom:12}},
e("label",{style:{fontSize:11,fontWeight:700,color:"#64748b",display:"block",marginBottom:6}},"ì•„ì´ì½˜"),
e("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},
loc.iconImage?e("img",{src:loc.iconImage,style:{width:40,height:40,borderRadius:10,objectFit:"cover"}}):e("span",{style:{fontSize:32}},loc.icon),
e("button",{onClick:()=>setEmojiPick(emojiPick===loc.id?null:loc.id),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:11}},"ì´ëª¨ì§€ ë³€ê²½"),
e("button",{onClick:()=>handleImgUpload(img=>{const u=C.locations.map(l=>l.id===loc.id?{...l,iconImage:img}:l);saveCfg({...C,locations:u})},200),
style:{padding:"6px 10px",borderRadius:8,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:11}},"ì´ë¯¸ì§€ ì—…ë¡œë“œ"),
loc.iconImage&&e("button",{onClick:()=>{const u=C.locations.map(l=>l.id===loc.id?{...l,iconImage:null}:l);saveCfg({...C,locations:u})},
style:{padding:"6px 8px",borderRadius:8,border:"1px solid #fecaca",background:"#fef2f2",fontSize:11,color:"#dc2626"}},"âœ•")),
emojiPick===loc.id&&e("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:8,padding:8,background:"#f8fafc",borderRadius:10,maxHeight:120,overflowY:"auto"}},
EMOJIS.map(em=>e("button",{key:em,onClick:()=>{const u=C.locations.map(l=>l.id===loc.id?{...l,icon:em,iconImage:null}:l);saveCfg({...C,locations:u});setEmojiPick(null)},
style:{width:36,height:36,border:loc.icon===em?"2px solid "+C.primaryColor:"1px solid #e2e8f0",borderRadius:8,background:"#fff",fontSize:18,display:"flex",alignItems:"center",justifyContent:"center"}},em)))),
// Fields
[{k:"name",l:"ì¥ì†Œëª…",t:"input"},{k:"code",l:"QR ì½”ë“œê°’ (ê³ ìœ ì½”ë“œ)",t:"input",mono:true},{k:"mission",l:"ë¯¸ì…˜ ë‚´ìš©",t:"ta"},{k:"desc",l:"ì¥ì†Œ ì„¤ëª…",t:"ta"}].map(f=>
e("div",{key:f.k,style:{marginBottom:10}},
e("label",{style:{fontSize:11,fontWeight:700,color:"#64748b"}},f.l),
f.t==="ta"?e("textarea",{value:loc[f.k],rows:2,onChange:ev=>{const u=C.locations.map(l=>l.id===loc.id?{...l,[f.k]:ev.target.value}:l);saveCfg({...C,locations:u})},
style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13,boxSizing:"border-box",resize:"vertical"}}):
e("input",{value:loc[f.k],onChange:ev=>{const v=f.k==="code"?ev.target.value.toUpperCase():ev.target.value;const u=C.locations.map(l=>l.id===loc.id?{...l,[f.k]:v}:l);saveCfg({...C,locations:u})},
style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13,boxSizing:"border-box",fontFamily:f.mono?"monospace":"inherit"}}))),
e("button",{onClick:()=>{setEditLoc(null);setEmojiPick(null)},style:{background:C.primaryColor,color:"#fff",border:"none",padding:"9px 24px",borderRadius:8,fontSize:13,fontWeight:700}},"âœ“ ì™„ë£Œ")):
// View mode
e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
e("div",{style:{display:"flex",gap:12,alignItems:"center"}},
loc.iconImage?e("img",{src:loc.iconImage,style:{width:36,height:36,borderRadius:8,objectFit:"cover"}}):e("span",{style:{fontSize:26}},loc.icon),
e("div",null,e("div",{style:{fontWeight:700,fontSize:14}},loc.name),e("div",{style:{fontSize:10,color:"#94a3b8",fontFamily:"monospace"}},loc.code))),
e("div",{style:{display:"flex",gap:6}},
e("button",{onClick:()=>setEditLoc(loc.id),style:{background:"#f1f5f9",border:"none",padding:"6px 10px",borderRadius:6,fontSize:12}},"âœï¸"),
e("button",{onClick:()=>{if(C.locations.length<=1)return;saveCfg({...C,locations:C.locations.filter(l=>l.id!==loc.id)})},
style:{background:"#fef2f2",border:"none",padding:"6px 10px",borderRadius:6,fontSize:12}},"ğŸ—‘")))))),

// â”€â”€ DESIGN TAB
adminTab==="design"&&e("div",null,
e("h3",{style:{fontSize:15,fontWeight:800,marginBottom:14}},"ğŸ¨ ë””ìì¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•"),
// Images
e("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12,boxShadow:"0 1px 3px rgba(0,0,0,.05)"}},
e("h4",{style:{fontSize:13,fontWeight:700,marginBottom:14,color:"#334155"}},"ğŸ–¼ ì´ë¯¸ì§€ ê´€ë¦¬"),
[{k:"heroImage",l:"ì‹œì‘í™”ë©´ ìºë¦­í„°",d:"PNG ê¶Œì¥ (íˆ¬ëª…ë°°ê²½)",ms:400},{k:"stampImage",l:"ì™„ë£Œ ìŠ¤íƒ¬í”„ ì´ë¯¸ì§€",d:"ìˆ˜ì§‘ì™„ë£Œ ì‹œ í‘œì‹œ",ms:200},{k:"stampEmptyImage",l:"ë¯¸ì™„ë£Œ ìŠ¤íƒ¬í”„ ì´ë¯¸ì§€",d:"ë¯¸ìˆ˜ì§‘ ì‹œ í‘œì‹œ",ms:200},{k:"mapImage",l:"ì „ì²´ ì•ˆë‚´ ì§€ë„",d:"ì¥ì†Œ ìœ„ì¹˜ê°€ í‘œì‹œëœ ì§€ë„",ms:1200}].map(item=>
e("div",{key:item.k,style:{display:"flex",alignItems:"center",gap:12,padding:"12px 0",borderBottom:"1px solid #f1f5f9"}},
e("div",{style:{width:56,height:56,borderRadius:10,background:"#f8fafc",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",border:"2px dashed #e2e8f0",flexShrink:0}},
C[item.k]?e("img",{src:C[item.k],style:{width:"100%",height:"100%",objectFit:"cover"}}):e("span",{style:{fontSize:10,color:"#94a3b8"}},"ì—†ìŒ")),
e("div",{style:{flex:1}},e("div",{style:{fontSize:13,fontWeight:600,color:"#334155"}},item.l),e("div",{style:{fontSize:10,color:"#94a3b8"}},item.d)),
e("div",{style:{display:"flex",flexDirection:"column",gap:4}},
e("button",{onClick:()=>handleImgUpload(img=>saveCfg({...C,[item.k]:img}),item.ms),style:{padding:"5px 10px",borderRadius:6,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:10}},"ğŸ“· ì—…ë¡œë“œ"),
C[item.k]&&e("button",{onClick:()=>saveCfg({...C,[item.k]:null}),style:{padding:"5px 10px",borderRadius:6,border:"1px solid #fecaca",background:"#fef2f2",fontSize:10,color:"#dc2626"}},"ì‚­ì œ"))))),
// Text
e("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12,boxShadow:"0 1px 3px rgba(0,0,0,.05)"}},
e("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12,color:"#334155"}},"âœï¸ í…ìŠ¤íŠ¸"),
[{k:"festivalName",l:"ì¶•ì œëª…"},{k:"subtitle",l:"ë¶€ì œëª©"}].map(f=>e("div",{key:f.k,style:{marginBottom:10}},
e("label",{style:{fontSize:11,fontWeight:600,color:"#64748b"}},f.l),
e("input",{value:C[f.k],onChange:ev=>saveCfg({...C,[f.k]:ev.target.value}),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:14,boxSizing:"border-box"}}))),
e("label",{style:{fontSize:11,fontWeight:600,color:"#64748b"}},"ì™„ë£Œ ë©”ì‹œì§€"),
e("textarea",{value:C.completionMessage,rows:3,onChange:ev=>saveCfg({...C,completionMessage:ev.target.value}),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13,boxSizing:"border-box",resize:"vertical"}})),
// Colors
e("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12,boxShadow:"0 1px 3px rgba(0,0,0,.05)"}},
e("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12,color:"#334155"}},"ğŸ¨ ìƒ‰ìƒ"),
e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}},
[{k:"primaryColor",l:"ë©”ì¸"},{k:"secondaryColor",l:"ë³´ì¡°"},{k:"accentColor",l:"ê°•ì¡°"},{k:"bgColor",l:"ë°°ê²½"},{k:"textColor",l:"ê¸€ì"},{k:"cardBg",l:"ì¹´ë“œ"}].map(c=>
e("div",{key:c.k},e("label",{style:{fontSize:10,fontWeight:600,color:"#64748b"}},c.l),
e("div",{style:{display:"flex",alignItems:"center",gap:6}},
e("input",{type:"color",value:C[c.k],onChange:ev=>saveCfg({...C,[c.k]:ev.target.value}),style:{width:32,height:32,border:"2px solid #e2e8f0",borderRadius:8,padding:0}}),
e("input",{value:C[c.k],onChange:ev=>saveCfg({...C,[c.k]:ev.target.value}),style:{flex:1,padding:7,borderRadius:6,border:"1px solid #e2e8f0",fontSize:11,fontFamily:"monospace"}})))))),
// Fonts
e("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12,boxShadow:"0 1px 3px rgba(0,0,0,.05)"}},
e("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12,color:"#334155"}},"ğŸ”¤ í°íŠ¸"),
[{k:"titleFont",l:"ì œëª©",opts:["'Black Han Sans',sans-serif","'Jua',sans-serif","'Do Hyeon',sans-serif","'Gugi',sans-serif","'Gaegu',cursive"]},
{k:"fontFamily",l:"ë³¸ë¬¸",opts:["'Noto Sans KR',sans-serif","'Jua',sans-serif","'Gothic A1',sans-serif","'Gamja Flower',cursive","'Gaegu',cursive"]}].map(f=>
e("div",{key:f.k,style:{marginBottom:10}},
e("label",{style:{fontSize:10,fontWeight:600,color:"#64748b"}},f.l),
e("select",{value:C[f.k],onChange:ev=>saveCfg({...C,[f.k]:ev.target.value}),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13}},
f.opts.map(o=>e("option",{key:o,value:o},o.split("'")[1]))),
e("div",{style:{marginTop:4,padding:8,background:"#f8fafc",borderRadius:8,fontFamily:C[f.k],fontSize:f.k==="titleFont"?20:14}},"ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸")))),
// Preview
e("div",{style:{background:"#fff",borderRadius:14,padding:16,boxShadow:"0 1px 3px rgba(0,0,0,.05)"}},
e("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12,color:"#334155"}},"ğŸ‘ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°"),
e("div",{style:{background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",borderRadius:14,padding:20,textAlign:"center"}},
C.heroImage&&e("img",{src:C.heroImage,style:{width:60,height:60,objectFit:"contain",marginBottom:6}}),
e("div",{style:{fontFamily:C.titleFont,fontSize:16,color:"#fff"}},C.festivalName),
e("div",{style:{fontFamily:C.fontFamily,fontSize:11,color:"rgba(255,255,255,.8)",marginTop:3}},C.subtitle),
e("div",{style:{display:"flex",justifyContent:"center",gap:6,marginTop:12}},
C.locations.slice(0,6).map((l,i)=>e("div",{key:i,style:{width:30,height:30,borderRadius:"50%",background:i<3?C.accentColor:"rgba(255,255,255,.25)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:i<3?12:10,color:"#fff"}},i<3?"âœ“":l.icon)))))),

// â”€â”€ QR CODES TAB
adminTab==="qrcodes"&&e("div",null,
e("h3",{style:{fontSize:15,fontWeight:800,marginBottom:6}},"ğŸ“± QR ì½”ë“œ ê´€ë¦¬"),
e("p",{style:{fontSize:12,color:"#64748b",marginBottom:16}},"ê° ì¥ì†Œì— ì•„ë˜ QR ì½”ë“œë¥¼ ì¸ì‡„í•˜ì—¬ ë¹„ì¹˜í•´ì£¼ì„¸ìš”."),
e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}},
C.locations.map(loc=>e("div",{key:loc.id,style:{background:"#fff",borderRadius:14,padding:14,textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,.05)"}},
e("div",{style:{fontSize:22,marginBottom:4}},loc.icon),
e("div",{style:{fontSize:12,fontWeight:700,color:"#334155",marginBottom:6}},loc.name),
e("img",{src:getQR(loc.code,300),style:{width:"100%",maxWidth:160,borderRadius:8,border:"1px solid #f1f5f9"}}),
e("div",{style:{marginTop:6,fontSize:9,color:"#94a3b8",fontFamily:"monospace",background:"#f8fafc",padding:"3px 6px",borderRadius:4}},loc.code))))),

// â”€â”€ FESTIVAL INFO TAB
adminTab==="festival"&&e("div",null,
e("h3",{style:{fontSize:15,fontWeight:800,marginBottom:6}},"ğŸ“‹ ì¶•ì œ ì •ë³´ (AI ë§¤ë‹ˆì €ìš©)"),
e("p",{style:{fontSize:12,color:"#64748b",marginBottom:14}},"ì—¬ê¸° ì…ë ¥í•œ ì •ë³´ë¥¼ AI ë§¤ë‹ˆì €ê°€ í•™ìŠµí•˜ì—¬ ê´€ëŒê° ì§ˆë¬¸ì— ë‹µë³€í•©ë‹ˆë‹¤."),
e("textarea",{value:C.festivalInfo,rows:18,onChange:ev=>saveCfg({...C,festivalInfo:ev.target.value}),placeholder:"ì¶•ì œ ì •ë³´ë¥¼ ììœ ë¡­ê²Œ ì…ë ¥í•˜ì„¸ìš”...",
style:{width:"100%",padding:14,borderRadius:12,border:"2px solid #e2e8f0",fontSize:14,lineHeight:1.8,boxSizing:"border-box",resize:"vertical"}}),
e("div",{style:{marginTop:10,padding:12,background:"#ecfdf5",borderRadius:10,fontSize:11,color:"#065f46"}},"ğŸ’¡ ì¶•ì œ ì¼ì •, ìš´ì˜ì‹œê°„, ì£¼ì°¨ì •ë³´, í”„ë¡œê·¸ë¨, ë§›ì§‘ ë“±ì„ ìƒì„¸íˆ ì‘ì„±í•˜ë©´ AI ë‹µë³€ í’ˆì§ˆì´ ë†’ì•„ì§‘ë‹ˆë‹¤.")),

// â”€â”€ PARTICIPANTS TAB
adminTab==="users"&&e("div",null,
e("h3",{style:{fontSize:15,fontWeight:800,marginBottom:14}},"ğŸ‘¥ ì°¸ê°€ì ("+parts.length+"ëª…)"),
parts.length===0?e("div",{style:{textAlign:"center",padding:40,color:"#94a3b8"}},"ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤"):
e("div",{style:{background:"#fff",borderRadius:12,overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,.05)"}},
e("div",{style:{display:"grid",gridTemplateColumns:"40px 1fr 80px 1fr",padding:"10px 12px",background:"#f8fafc",fontSize:10,fontWeight:700,color:"#64748b"}},
e("div",null,"#"),e("div",null,"ì´ë¦„"),e("div",null,"ìƒë…„ì›”ì¼"),e("div",null,"ì—°ë½ì²˜")),
parts.slice().reverse().map((p,i)=>e("div",{key:i,style:{display:"grid",gridTemplateColumns:"40px 1fr 80px 1fr",padding:"10px 12px",borderTop:"1px solid #f1f5f9",fontSize:12}},
e("div",{style:{color:"#94a3b8"}},parts.length-i),e("div",{style:{fontWeight:600}},p.name),e("div",null,p.birth),e("div",{style:{fontSize:11}},p.phone)))))))}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN TOUR SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
return e("div",{style:{fontFamily:C.fontFamily,background:C.bgColor,minHeight:"100vh",minHeight:"100dvh",paddingBottom:90,position:"relative"}},
adminArea,
showAdmin&&!adminAuth&&e(PwModal),

// â”€â”€ COMPLETION MODAL
showComp&&e("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.65)",zIndex:1100,display:"flex",alignItems:"center",justifyContent:"center",padding:20,backdropFilter:"blur(6px)"},onClick:()=>setShowComp(false)},
e("div",{onClick:ev=>ev.stopPropagation(),style:{background:"#fff",borderRadius:24,padding:"36px 28px",width:"100%",maxWidth:340,textAlign:"center",animation:"bounceIn .5s"}},
e("div",{style:{fontSize:56,marginBottom:8}},"ğŸ†"),
e("h2",{style:{fontFamily:C.titleFont,fontSize:22,color:C.primaryColor,margin:"0 0 10px"}},"ë¯¸ì…˜ ì™„ë£Œ!"),
e("p",{style:{fontSize:14,color:"#475569",lineHeight:1.8,whiteSpace:"pre-line"}},C.completionMessage),
e("div",{style:{marginTop:16,padding:14,background:C.primaryColor+"0a",borderRadius:12,fontSize:13,color:C.primaryColor,fontWeight:600}},"ğŸ“‹ "+user?.name+" | ğŸ“± "+user?.phone),
e("button",{onClick:()=>setShowComp(false),style:{marginTop:18,padding:"12px 40px",borderRadius:12,border:"none",background:C.accentColor,color:"#fff",fontSize:15,fontWeight:800}},"í™•ì¸"))),

// â”€â”€ SCANNER MODAL
(scanning||scanRes)&&e("div",{style:{position:"fixed",inset:0,background:"#000",zIndex:1100,display:"flex",flexDirection:"column"}},
e("div",{style:{padding:"14px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",background:"rgba(0,0,0,.8)",zIndex:10}},
e("span",{style:{color:"#fff",fontSize:15,fontWeight:700}},"ğŸ“· QR ìŠ¤ìº”"),
e("button",{onClick:()=>{stopScan();setScanRes(null)},style:{background:"rgba(255,255,255,.15)",border:"none",color:"#fff",padding:"8px 16px",borderRadius:8,fontSize:13}},"âœ• ë‹«ê¸°")),
scanRes?
e("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:30}},
e("div",{style:{background:"#fff",borderRadius:24,padding:"40px 28px",width:"100%",maxWidth:340,textAlign:"center",animation:"bounceIn .4s"}},
e("div",{style:{fontSize:56,marginBottom:8}},scanRes.icon),
e("h3",{style:{fontSize:18,fontWeight:800,color:scanRes.ok?C.primaryColor:"#dc2626",margin:"0 0 8px"}},scanRes.ok?"ìŠ¤íƒ¬í”„ íšë“!":"ì•Œë¦¼"),
e("p",{style:{fontSize:15,color:"#475569",lineHeight:1.6}},scanRes.msg),
e("div",{style:{display:"flex",gap:10,marginTop:20}},
e("button",{onClick:()=>{setScanRes(null);startScan()},style:{flex:1,padding:12,borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:14}},"ê³„ì† ìŠ¤ìº”"),
e("button",{onClick:()=>setScanRes(null),style:{flex:1,padding:12,borderRadius:10,border:"none",background:C.primaryColor,color:"#fff",fontSize:14,fontWeight:700}},"ëŒì•„ê°€ê¸°")))):
e("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center"}},
e("video",{ref:vidRef,style:{width:"100%",height:"100%",objectFit:"cover"},playsInline:true,muted:true}),
e("canvas",{ref:canRef,style:{display:"none"}}),
// Overlay
e("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"}},
e("div",{style:{width:240,height:240,position:"relative"}},
// Corners
[[0,0,"borderTop","borderLeft","borderTopLeftRadius"],[0,1,"borderTop","borderRight","borderTopRightRadius"],
[1,0,"borderBottom","borderLeft","borderBottomLeftRadius"],[1,1,"borderBottom","borderRight","borderBottomRightRadius"]].map(([r,c,bv,bh,br])=>{
const st={position:"absolute",width:36,height:36};st[r===0?"top":"bottom"]=-2;st[c===0?"left":"right"]=-2;
st[bv+"Width"]="4px";st[bh+"Width"]="4px";st.borderColor=C.secondaryColor;st.borderStyle="solid";
st[bv.replace("border","borderTop")==="borderTop"?bv:bv]="4px solid "+C.secondaryColor;st[br]=12;
return e("div",{key:r+""+c,style:{position:"absolute",width:36,height:36,...(()=>{const s={};s[r===0?"top":"bottom"]=-2;s[c===0?"left":"right"]=-2;
s.borderStyle="solid";s.borderColor=C.secondaryColor;s.borderWidth=0;
if(r===0)s.borderTopWidth=4;else s.borderBottomWidth=4;if(c===0)s.borderLeftWidth=4;else s.borderRightWidth=4;
s[br]=12;return s})()}})}),
e("div",{style:{position:"absolute",left:10,right:10,height:3,background:"linear-gradient(90deg,transparent,"+C.secondaryColor+",transparent)",borderRadius:2,animation:"scanLine 2s ease-in-out infinite"}}))),
camErr&&e("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.9)",padding:30}},
e("div",{style:{textAlign:"center",color:"#fff"}},
e("div",{style:{fontSize:48,marginBottom:12}},"ğŸ“·"),
e("p",{style:{fontSize:15,whiteSpace:"pre-line",lineHeight:1.6}},camErr),
e("button",{onClick:startScan,style:{marginTop:20,padding:"12px 30px",borderRadius:10,border:"none",background:C.primaryColor,color:"#fff",fontSize:14,fontWeight:700}},"ë‹¤ì‹œ ì‹œë„"))),
e("div",{style:{position:"absolute",bottom:30,left:0,right:0,textAlign:"center"}},
e("p",{style:{color:"rgba(255,255,255,.8)",fontSize:13,textShadow:"0 1px 4px rgba(0,0,0,.5)"}},"QR ì½”ë“œë¥¼ ì‚¬ê°í˜• ì•ˆì— ë§ì¶°ì£¼ì„¸ìš”")))),

// â”€â”€ MAP MODAL
showMap&&e("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.65)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:16,backdropFilter:"blur(4px)"},onClick:()=>setShowMap(false)},
e("div",{onClick:ev=>ev.stopPropagation(),style:{background:"#fff",borderRadius:20,width:"100%",maxWidth:420,maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",animation:"slideUp .3s"}},
e("div",{style:{padding:"14px 18px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #f1f5f9",flexShrink:0}},
e("span",{style:{fontWeight:800,fontSize:15,color:C.textColor}},"ğŸ—º ì „ì²´ ì•ˆë‚´ ì§€ë„"),
e("button",{onClick:()=>setShowMap(false),style:{width:32,height:32,borderRadius:"50%",border:"none",background:"#f1f5f9",fontSize:16,display:"flex",alignItems:"center",justifyContent:"center"}},"âœ•")),
e("div",{style:{flex:1,overflow:"auto",padding:12}},
C.mapImage?e("img",{src:C.mapImage,style:{width:"100%",borderRadius:12,display:"block"}}):
e("div",{style:{padding:"60px 20px",textAlign:"center",color:"#94a3b8"}},
e("div",{style:{fontSize:48,marginBottom:12}},"ğŸ—º"),
e("p",{style:{fontSize:14}},"ì•ˆë‚´ ì§€ë„ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"),
e("p",{style:{fontSize:12,marginTop:4}},"ê´€ë¦¬ìê°€ ì§€ë„ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤")),
e("div",{style:{marginTop:12}},
C.locations.map((loc,i)=>e("div",{key:loc.id,style:{display:"flex",gap:10,alignItems:"center",padding:"10px 6px",borderBottom:"1px solid #f8fafc"}},
e("div",{style:{width:28,height:28,borderRadius:"50%",background:stamps[loc.id]?C.accentColor:"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:stamps[loc.id]?"#fff":"#64748b",fontWeight:700,flexShrink:0}},stamps[loc.id]?"âœ“":i+1),
e("div",null,e("div",{style:{fontSize:13,fontWeight:600,color:C.textColor}},loc.icon+" "+loc.name),
e("div",{style:{fontSize:11,color:"#94a3b8"}},loc.desc)))))))),

// â”€â”€ AI CHAT
screen==="chat"&&e("div",{style:{position:"fixed",inset:0,background:C.bgColor,zIndex:900,display:"flex",flexDirection:"column"}},
e("div",{style:{background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",color:"#fff",padding:"14px 18px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}},
e("div",{style:{display:"flex",alignItems:"center",gap:10}},
e("div",{style:{width:36,height:36,borderRadius:"50%",background:"rgba(255,255,255,.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20}},"ğŸ¤–"),
e("div",null,e("div",{style:{fontWeight:700,fontSize:14}},"AI ì•ˆë‚´ ë§¤ë‹ˆì €"),e("div",{style:{fontSize:10,opacity:.8}},"ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!"))),
e("button",{onClick:()=>setScreen("tour"),style:{background:"rgba(255,255,255,.15)",border:"none",color:"#fff",padding:"7px 14px",borderRadius:8,fontSize:12,fontWeight:600}},"âœ•")),
e("div",{style:{flex:1,overflow:"auto",padding:14,display:"flex",flexDirection:"column",gap:10}},
chatMsgs.length===0&&e("div",{style:{textAlign:"center",padding:"32px 16px",color:"#94a3b8"}},
e("div",{style:{fontSize:44,marginBottom:8}},"ğŸ¤–"),
e("p",{style:{fontSize:14,fontWeight:600,color:"#475569"}},"AI ì•ˆë‚´ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤"),
e("p",{style:{fontSize:12,marginBottom:16}},"ì¶•ì œì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”!"),
["ì¶•ì œ ì¼ì •ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?","ìŠ¤íƒ¬í”„ íˆ¬ì–´ëŠ” ì–´ë–»ê²Œ ì°¸ì—¬í•˜ë‚˜ìš”?","ì£¼ì°¨ì¥ì´ ì–´ë””ì— ìˆë‚˜ìš”?"].map(q=>
e("button",{key:q,onClick:()=>setChatIn(q),style:{display:"block",width:"100%",padding:"10px 14px",marginBottom:8,borderRadius:12,border:"1px solid "+C.primaryColor+"22",background:C.primaryColor+"06",color:C.primaryColor,fontSize:13,textAlign:"left"}},"ğŸ’¬ "+q))),
chatMsgs.map((msg,i)=>e("div",{key:i,style:{display:"flex",justifyContent:msg.role==="user"?"flex-end":"flex-start",gap:8}},
msg.role!=="user"&&e("div",{style:{width:30,height:30,borderRadius:"50%",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,flexShrink:0}},"ğŸ¤–"),
e("div",{style:{maxWidth:"78%",padding:"10px 14px",borderRadius:msg.role==="user"?"14px 14px 4px 14px":"14px 14px 14px 4px",
background:msg.role==="user"?C.primaryColor:"#fff",color:msg.role==="user"?"#fff":C.textColor,fontSize:14,lineHeight:1.7,boxShadow:"0 1px 3px rgba(0,0,0,.06)",whiteSpace:"pre-wrap"}},msg.text))),
chatLoad&&e("div",{style:{display:"flex",gap:8,alignItems:"center"}},
e("div",{style:{width:30,height:30,borderRadius:"50%",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14}},"ğŸ¤–"),
e("div",{style:{padding:"10px 16px",background:"#fff",borderRadius:14,boxShadow:"0 1px 3px rgba(0,0,0,.06)",fontSize:18,animation:"blink 1.4s infinite"}},"â€¢â€¢â€¢")),
e("div",{ref:chatEnd})),
e("div",{style:{padding:"10px 14px",borderTop:"1px solid #e2e8f0",background:"#fff",display:"flex",gap:8,flexShrink:0,paddingBottom:"max(10px, env(safe-area-inset-bottom))"}},
e("input",{value:chatIn,onChange:ev=>setChatIn(ev.target.value),onKeyDown:ev=>{if(ev.key==="Enter"&&!ev.shiftKey){ev.preventDefault();sendChat()}},
placeholder:"ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...",style:{flex:1,padding:"12px 16px",borderRadius:24,border:"2px solid #e2e8f0",fontSize:14}}),
e("button",{onClick:sendChat,disabled:!chatIn.trim()||chatLoad,
style:{width:44,height:44,borderRadius:"50%",border:"none",background:chatIn.trim()?C.primaryColor:"#e2e8f0",color:"#fff",fontSize:18}},"â†‘"))),

// â”€â”€ HEADER
e("div",{style:{background:"linear-gradient(160deg,"+C.primaryColor+","+C.secondaryColor+")",padding:"22px 20px 52px",textAlign:"center",position:"relative"}},
C.heroImage&&e("img",{src:C.heroImage,style:{width:50,height:50,objectFit:"contain",position:"absolute",top:12,left:16,filter:"drop-shadow(0 2px 6px rgba(0,0,0,.2))"}}),
e("h1",{style:{fontFamily:C.titleFont,fontSize:22,color:"#fff",margin:0,textShadow:"0 2px 8px rgba(0,0,0,.2)"}},C.festivalName),
e("p",{style:{color:"rgba(255,255,255,.8)",fontSize:12,marginTop:3,letterSpacing:2}},C.subtitle),
e("p",{style:{color:"rgba(255,255,255,.9)",fontSize:13,marginTop:8}},"ğŸ‘‹ ",e("strong",null,user?.name),"ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!")),

// â”€â”€ PROGRESS CARD
e("div",{style:{margin:"-32px 16px 14px",background:C.cardBg,borderRadius:18,padding:"18px 18px 14px",boxShadow:"0 6px 24px rgba(0,0,0,.08)",position:"relative",zIndex:10}},
e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}},
e("span",{style:{fontSize:14,fontWeight:700,color:C.textColor}},"ğŸ—‚ ìŠ¤íƒ¬í”„ ìˆ˜ì§‘"),
e("span",{style:{fontSize:22,fontWeight:900,color:C.primaryColor,fontFamily:C.titleFont}},cnt+" / "+C.locations.length)),
e("div",{style:{display:"flex",justifyContent:"center",gap:8,flexWrap:"wrap"}},
C.locations.map(loc=>e(SI,{key:loc.id,loc:loc,stamped:!!stamps[loc.id],size:42}))),
e("div",{style:{marginTop:12,height:7,background:"#e8edf2",borderRadius:4,overflow:"hidden"}},
e("div",{style:{height:"100%",width:(cnt/Math.max(C.locations.length,1)*100)+"%",background:"linear-gradient(90deg,"+C.primaryColor+","+C.accentColor+")",borderRadius:4,transition:"width .6s cubic-bezier(.34,1.56,.64,1)"}})),
allDone&&e("button",{onClick:()=>setShowComp(true),style:{width:"100%",marginTop:12,padding:13,borderRadius:12,border:"none",
background:"linear-gradient(135deg,"+C.accentColor+",#f59e0b)",color:"#fff",fontSize:15,fontWeight:800,animation:"pulse 2s infinite",fontFamily:C.titleFont}},"ğŸ† ì„ ë¬¼ ìˆ˜ë ¹í•˜ê¸°")),

// â”€â”€ ACTION BUTTONS
e("div",{style:{padding:"0 16px",display:"flex",gap:10,marginBottom:14}},
e("button",{onClick:()=>{setScanRes(null);startScan()},style:{flex:2,padding:14,borderRadius:14,border:"none",
background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",color:"#fff",fontSize:15,fontWeight:800,
display:"flex",alignItems:"center",justifyContent:"center",gap:8,boxShadow:"0 4px 16px "+C.primaryColor+"33"}},
e("span",{style:{fontSize:20}},"ğŸ“·")," QR ìŠ¤ìº”"),
e("button",{onClick:()=>setShowMap(true),style:{flex:1,padding:14,borderRadius:14,border:"2px solid "+C.primaryColor+"22",
background:C.cardBg,color:C.primaryColor,fontSize:14,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",gap:6}},
"ğŸ—º ì§€ë„")),

// â”€â”€ LOCATIONS LIST
e("div",{style:{padding:"0 16px"}},
e("h3",{style:{fontSize:14,fontWeight:800,color:C.textColor,marginBottom:10}},"ğŸ“ ìŠ¤íƒ¬í”„ ì¥ì†Œ"),
C.locations.map(loc=>e("div",{key:loc.id,style:{background:C.cardBg,borderRadius:14,padding:"14px",marginBottom:8,boxShadow:"0 2px 8px rgba(0,0,0,.04)",
display:"flex",gap:12,alignItems:"center",border:stamps[loc.id]?"2px solid "+C.accentColor+"30":"1px solid #f1f5f9",transition:"all .3s"}},
e(SI,{loc:loc,stamped:!!stamps[loc.id],size:44}),
e("div",{style:{flex:1,minWidth:0}},
e("div",{style:{fontSize:14,fontWeight:700,color:C.textColor}},loc.name),
e("div",{style:{fontSize:11,color:"#94a3b8",marginTop:2}},loc.desc),
e("div",{style:{fontSize:11,color:C.primaryColor,marginTop:3,fontWeight:500}},"ğŸ“Œ "+loc.mission)),
stamps[loc.id]&&e("div",{style:{background:C.accentColor+"15",color:C.accentColor,padding:"4px 10px",borderRadius:20,fontSize:10,fontWeight:800,whiteSpace:"nowrap"}},"ì™„ë£Œ âœ“")))),

// â”€â”€ BOTTOM NAV
e("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:"#fff",borderTop:"1px solid #e8edf2",display:"flex",justifyContent:"space-around",alignItems:"flex-end",padding:"6px 0",paddingBottom:"max(6px, env(safe-area-inset-bottom))",zIndex:100}},
e("button",{onClick:()=>setScreen("tour"),style:{border:"none",background:"transparent",display:"flex",flexDirection:"column",alignItems:"center",gap:2,color:screen==="tour"?C.primaryColor:"#94a3b8",fontSize:10,fontWeight:600,padding:"4px 18px"}},
e("span",{style:{fontSize:20}},"ğŸ—º"),"íˆ¬ì–´"),
e("button",{onClick:()=>{setScanRes(null);startScan()},style:{border:"none",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",
width:54,height:54,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",marginTop:-22,boxShadow:"0 4px 20px "+C.primaryColor+"44"}},
e("span",{style:{fontSize:24}},"ğŸ“·")),
e("button",{onClick:()=>setScreen("chat"),style:{border:"none",background:"transparent",display:"flex",flexDirection:"column",alignItems:"center",gap:2,color:"#94a3b8",fontSize:10,fontWeight:600,padding:"4px 18px"}},
e("span",{style:{fontSize:20}},"ğŸ¤–"),"AIì•ˆë‚´")))}

ReactDOM.render(e(App),document.getElementById("root"));
</script>
</body>
</html>
