<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0A2463">
<title>2026 ëŒ€ì „ ì‚¬ì´ì–¸ìŠ¤ í˜ìŠ¤í‹°ë²Œ - AI ìŠ¤íƒ¬í”„ íˆ¬ì–´</title>
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@300;400;500;700;900&family=Jua&family=Do+Hyeon&family=Gugi&family=Gaegu&family=Gamja+Flower&family=Gothic+A1:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body,#root{width:100%;min-height:100vh;min-height:100dvh}
body{font-family:'Noto Sans KR',sans-serif;-webkit-font-smoothing:antialiased;overscroll-behavior:none}
input,textarea,select,button{font-family:inherit;outline:none}
button{cursor:pointer}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#ccc;border-radius:4px}
@keyframes floatDown{0%{transform:translateY(-10vh) rotate(0);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(110vh) rotate(360deg);opacity:0}}
@keyframes heroFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes bounceIn{0%{transform:scale(.3);opacity:0}50%{transform:scale(1.05)}70%{transform:scale(.95)}100%{transform:scale(1);opacity:1}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes scanLine{0%{top:10%}50%{top:85%}100%{top:10%}}
@keyframes blink{0%,100%{opacity:.2}50%{opacity:1}}
@keyframes toastIn{0%{transform:translateX(-50%) translateY(-30px);opacity:0}100%{transform:translateX(-50%) translateY(0);opacity:1}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.abtn{position:fixed;top:10px;right:10px;width:40px;height:40px;z-index:998;display:flex;align-items:center;justify-content:center;border-radius:50%;background:rgba(255,255,255,.08);border:none;font-size:18px;opacity:0;transition:opacity .3s,background .3s}
.abtn:hover{opacity:1!important;background:rgba(0,0,0,.1)}
@media(hover:none){.abtn{opacity:.12}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script>
"use strict";

// â”€â”€â”€ Firebase Init (graceful fallback) â”€â”€â”€
var db=null,PCOL="stamp_participants";
try{if(typeof firebase!=="undefined"&&firebase.initializeApp){
firebase.initializeApp({apiKey:"AIzaSyDf0FS-HBKDErSfUzc8cLP-NgnuOPgdpl4",authDomain:"treasure-hunt-cc9bb.firebaseapp.com",projectId:"treasure-hunt-cc9bb",storageBucket:"treasure-hunt-cc9bb.firebasestorage.app",messagingSenderId:"418214737669",appId:"1:418214737669:web:cde3ea516eb54f722e296c"});
db=firebase.firestore();console.log("Firebase connected!")}}catch(e){console.warn("Firebase unavailable, using local mode",e)}

const el=React.createElement,{useState,useEffect,useRef}=React;

const DEF={festivalName:"2026 ëŒ€ì „ ì‚¬ì´ì–¸ìŠ¤ í˜ìŠ¤í‹°ë²Œ",subtitle:"ëª¨ë°”ì¼ AI ìŠ¤íƒ¬í”„ íˆ¬ì–´",
primaryColor:"#0A2463",secondaryColor:"#00B4D8",accentColor:"#FB8500",bgColor:"#F0F7FF",textColor:"#1B1B2F",cardBg:"#FFFFFF",
fontFamily:"'Noto Sans KR',sans-serif",titleFont:"'Black Han Sans',sans-serif",
completionMessage:"ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰\nëª¨ë“  ìŠ¤íƒ¬í”„ë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤!\nì¢…í•©ì•ˆë‚´ì†Œì—ì„œ ì„ ë¬¼ì„ ìˆ˜ë ¹í•˜ì„¸ìš”!",
festivalInfo:"2026 ëŒ€ì „ ì‚¬ì´ì–¸ìŠ¤ í˜ìŠ¤í‹°ë²Œì€ ëŒ€ì „ê´‘ì—­ì‹œ ì—‘ìŠ¤í¬ì‹œë¯¼ê´‘ì¥ ì¼ëŒ€ì—ì„œ ê°œìµœë©ë‹ˆë‹¤.\n\nâ–¶ ê¸°ê°„: 2026ë…„ 10ì›” 15ì¼~20ì¼\nâ–¶ ì¥ì†Œ: ëŒ€ì „ ì—‘ìŠ¤í¬ì‹œë¯¼ê´‘ì¥\nâ–¶ ì£¼ìµœ: ëŒ€ì „ê´‘ì—­ì‹œ / ì£¼ê´€: ëŒ€ì „ê´€ê´‘ê³µì‚¬\n\në‹¤ì–‘í•œ ê³¼í•™ ì²´í—˜ í”„ë¡œê·¸ë¨ê³¼ ê³µì—°, ì „ì‹œê°€ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
apiKey:"",heroImage:null,stampImage:null,stampEmptyImage:null,mapImage:null,
locations:[
{id:"loc1",name:"ê³¼í•™ì²´í—˜ê´€",icon:"ğŸ”¬",code:"DJSF2026-A1",mission:"VR ìš°ì£¼íƒí—˜ì„ ì²´í—˜í•˜ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ì²¨ë‹¨ ê³¼í•™ê¸°ìˆ  ì²´í—˜ ê³µê°„",iconImage:null},
{id:"loc2",name:"ë¡œì¼“ì „ì‹œì¥",icon:"ğŸš€",code:"DJSF2026-B2",mission:"ëˆ„ë¦¬í˜¸ ëª¨í˜• ì•ì—ì„œ ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ìš°ì£¼ ë°œì‚¬ì²´ì™€ ìœ„ì„±ì˜ ì—­ì‚¬",iconImage:null},
{id:"loc3",name:"AIë¡œë´‡ê´€",icon:"ğŸ¤–",code:"DJSF2026-C3",mission:"AI ë¡œë´‡ê³¼ ëŒ€í™”í•˜ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ì¸ê³µì§€ëŠ¥ê³¼ ë¡œë´‡ì˜ ë¯¸ë˜",iconImage:null},
{id:"loc4",name:"ìƒëª…ê³¼í•™ê´€",icon:"ğŸ§¬",code:"DJSF2026-D4",mission:"DNA ì¶”ì¶œ ì²´í—˜ í›„ ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ìƒëª…ì˜ ì‹ ë¹„ íƒêµ¬ ê³µê°„",iconImage:null},
{id:"loc5",name:"ì—ë„ˆì§€íŒŒë¹Œë¦¬ì˜¨",icon:"âš¡",code:"DJSF2026-E5",mission:"ì‹ ì¬ìƒì—ë„ˆì§€ í€´ì¦ˆë¥¼ í’€ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ë¯¸ë˜ ì—ë„ˆì§€ ê¸°ìˆ  ì²´í—˜",iconImage:null},
{id:"loc6",name:"ì²œë¬¸ìš°ì£¼ê´€",icon:"ğŸŒŒ",code:"DJSF2026-F6",mission:"ì²œì²´ë§ì›ê²½ìœ¼ë¡œ ë³„ì„ ê´€ì¸¡í•˜ê³  ìŠ¤íƒ¬í”„ë¥¼ ë°›ìœ¼ì„¸ìš”!",desc:"ë³„ê³¼ ìš°ì£¼ì˜ ì‹ ë¹„ íƒí—˜",iconImage:null}]};

const ADMIN_PW="0460",EMOJIS=["ğŸ”¬","ğŸš€","ğŸ¤–","ğŸ§¬","âš¡","ğŸŒŒ","ğŸª","ğŸ­","ğŸ¨","ğŸµ","ğŸ›","ğŸŒ³","ğŸ¡","ğŸ¢","ğŸ¯","ğŸ†","â­","ğŸ’","ğŸ”­","ğŸ§ª","ğŸ§²","ğŸŒ","â˜€ï¸","ğŸŒŠ","ğŸ¦•","ğŸ‰","ğŸ“","ğŸ“¡","ğŸ’¡","ğŸˆ","ğŸ","ğŸ…","ğŸ”®","ğŸ›¸","ğŸŒˆ","ğŸ¶","ğŸ–¼","ğŸ—¿","â›©","ğŸ°"];
function LS(k,v){const p="djsf_"+k;if(v===undefined){try{const d=localStorage.getItem(p);return d?JSON.parse(d):null}catch{return null}}try{localStorage.setItem(p,JSON.stringify(v))}catch{}}
function getQR(d,s){return"https://api.qrserver.com/v1/create-qr-code/?size="+(s||200)+"x"+(s||200)+"&data="+encodeURIComponent(d)+"&format=png&margin=8"}
function imgUp(cb,mx){const i=document.createElement("input");i.type="file";i.accept="image/*";i.onchange=function(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=function(re){const img=new Image();img.onload=function(){const c=document.createElement("canvas");let w=img.width,ht=img.height;mx=mx||800;if(w>mx||ht>mx){if(w>ht){ht=(ht/w)*mx;w=mx}else{w=(w/ht)*mx;ht=mx}}c.width=w;c.height=ht;c.getContext("2d").drawImage(img,0,0,w,ht);cb(c.toDataURL("image/png",0.85))};img.src=re.target.result};r.readAsDataURL(f)};i.click()}

function App(){
const savedU=LS("user"),savedS=LS("stamps")||{},savedDocId=LS("docId");
const[C,setC]=useState(()=>LS("config")||DEF);
const[scr,setScr]=useState(savedU?"tour":"register");
const[user,setUser]=useState(savedU);
const[stamps,setStamps]=useState(savedS);
const[docId,setDocId]=useState(savedDocId);
const[showAdm,setShowAdm]=useState(false);
const[admAuth,setAdmAuth]=useState(false);
const[admPw,setAdmPw]=useState("");
const[admTab,setAdmTab]=useState("locations");
const[msgs,setMsgs]=useState([]);
const[chatIn,setChatIn]=useState("");
const[chatLoad,setChatLoad]=useState(false);
const[scanRes,setScanRes]=useState(null);
const[reg,setReg]=useState({name:"",birth:"",phone:"",agree:false});
const[showComp,setShowComp]=useState(false);
const[editLoc,setEditLoc]=useState(null);
const[fbParts,setFbParts]=useState([]);
const[pwErr,setPwErr]=useState(false);
const[showMap,setShowMap]=useState(false);
const[emojiPk,setEmojiPk]=useState(null);
const[scanning,setScanning]=useState(false);
const[camErr,setCamErr]=useState(null);
const[toast,setToast]=useState(null);
const[dirty,setDirty]=useState(false);
const[showResume,setShowResume]=useState(!!savedU);
const[fbOk,setFbOk]=useState(!!db);
const chatEnd=useRef(null),vidRef=useRef(null),canRef=useRef(null),strRef=useRef(null),animRef=useRef(null),ttimer=useRef(null);

// â”€â”€â”€ Firebase: listen participants (admin) â”€â”€â”€
useEffect(()=>{
  if(!db){setFbOk(false);return}
  const unsub=db.collection(PCOL).orderBy("time","desc").onSnapshot(snap=>{
    const list=[];snap.forEach(doc=>{list.push({id:doc.id,...doc.data()})});setFbParts(list);setFbOk(true);
  },err=>{console.error("Firestore err:",err);setFbOk(false)});
  return ()=>unsub();
},[]);

useEffect(()=>{LS("stamps",stamps)},[stamps]);
useEffect(()=>{if(C.locations.length>0&&C.locations.every(l=>stamps[l.id])&&!showComp&&scr==="tour")setShowComp(true)},[stamps,scr]);
useEffect(()=>{chatEnd.current?.scrollIntoView({behavior:"smooth"})},[msgs]);

const showT=(m,t)=>{clearTimeout(ttimer.current);setToast({m,t:t||"ok"});ttimer.current=setTimeout(()=>setToast(null),2500)};
const updC=(nc)=>{setC(nc);setDirty(true)};
const saveC=()=>{LS("config",C);setDirty(false);showT("âœ… ì €ì¥ ì™„ë£Œ!")};
const cnt=C.locations.filter(l=>stamps[l.id]).length;
const allDone=C.locations.length>0&&cnt===C.locations.length;

// â”€â”€â”€ Firebase: save participant â”€â”€â”€
const fbSaveUser=async(u)=>{
  if(!db)return null;
  try{const ref=await db.collection(PCOL).add({name:u.name,birth:u.birth,phone:u.phone,time:u.time,stamps:{},completed:false});
  setDocId(ref.id);LS("docId",ref.id);return ref.id}catch(e){console.error("FB save err:",e);return null}};

// â”€â”€â”€ Firebase: update stamps â”€â”€â”€
const fbUpdateStamps=async(newStamps)=>{
  if(!db)return;
  const did=docId||LS("docId");if(!did)return;
  const completed=C.locations.length>0&&C.locations.every(l=>newStamps[l.id]);
  try{await db.collection(PCOL).doc(did).update({stamps:newStamps,completed:completed,
    completedTime:completed?new Date().toISOString():null})}catch(e){console.error("FB update err:",e)}};

// â”€â”€â”€ Register â”€â”€â”€
const doReg=async()=>{if(!reg.name||!reg.birth||!reg.phone||!reg.agree)return;
  const u={name:reg.name,birth:reg.birth,phone:reg.phone,time:new Date().toISOString()};
  setUser(u);LS("user",u);LS("stamps",{});setStamps({});
  const lp=LS("parts")||[];LS("parts",[...lp,u]);
  await fbSaveUser(u);
  setScr("tour");showT("ğŸ‰ ë“±ë¡ ì™„ë£Œ!")};
const doResume=()=>{setScr("tour");setShowResume(false);showT("ğŸ‘‹ "+savedU.name+"ë‹˜, ì´ì–´ì„œ ì§„í–‰!")};
const doNew=()=>{setShowResume(false);setUser(null);LS("user",null);LS("stamps",null);LS("docId",null);setStamps({});setDocId(null)};
const doLogout=()=>{setUser(null);setStamps({});setDocId(null);LS("user",null);LS("stamps",null);LS("docId",null);setScr("register");setShowResume(false)};

// â”€â”€â”€ Scanner â”€â”€â”€
const startScan=async()=>{setScanning(true);setCamErr(null);setScanRes(null);
try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});
strRef.current=s;if(vidRef.current){vidRef.current.srcObject=s;vidRef.current.setAttribute("playsinline","true");await vidRef.current.play();doFrame()}}
catch(er){setCamErr(er.name==="NotAllowedError"?"ì¹´ë©”ë¼ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.\nì„¤ì •ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.\n\nğŸ’¡ ì•„ì´í°: ì„¤ì • > Safari > ì¹´ë©”ë¼\nğŸ’¡ ì•ˆë“œë¡œì´ë“œ: ë¸Œë¼ìš°ì € > ì‚¬ì´íŠ¸ ì„¤ì • > ì¹´ë©”ë¼":"ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nâš ï¸ httpsì—ì„œë§Œ ì¹´ë©”ë¼ê°€ ì‘ë™í•©ë‹ˆë‹¤.")}};
const doFrame=()=>{if(!vidRef.current||!canRef.current||!window.jsQR){animRef.current=requestAnimationFrame(doFrame);return}
const v=vidRef.current,c=canRef.current;if(v.readyState!==v.HAVE_ENOUGH_DATA){animRef.current=requestAnimationFrame(doFrame);return}
c.width=v.videoWidth;c.height=v.videoHeight;const ctx=c.getContext("2d",{willReadFrequently:true});ctx.drawImage(v,0,0,c.width,c.height);
const img=ctx.getImageData(0,0,c.width,c.height);const code=window.jsQR(img.data,img.width,img.height,{inversionAttempts:"dontInvert"});
if(code?.data){onCode(code.data);return}animRef.current=requestAnimationFrame(doFrame)};
const onCode=(data)=>{const loc=C.locations.find(l=>l.code===data);
if(loc){if(stamps[loc.id])setScanRes({ok:0,msg:'ì´ë¯¸ "'+loc.name+'" ìŠ¤íƒ¬í”„ë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤!',ic:"ğŸ”„"});
else{const ns={...stamps,[loc.id]:true};setStamps(ns);LS("stamps",ns);fbUpdateStamps(ns);setScanRes({ok:1,msg:'"'+loc.name+'" ìŠ¤íƒ¬í”„ íšë“!',ic:"ğŸ‰"})}}
else setScanRes({ok:0,msg:"ìœ íš¨í•˜ì§€ ì•Šì€ QRì½”ë“œì…ë‹ˆë‹¤.",ic:"âŒ"});stopScan()};
const stopScan=()=>{if(animRef.current)cancelAnimationFrame(animRef.current);if(strRef.current)strRef.current.getTracks().forEach(t=>t.stop());strRef.current=null;setScanning(false)};

// â”€â”€â”€ AI Chat â”€â”€â”€
const sendChat=async()=>{if(!chatIn.trim()||chatLoad)return;const m=chatIn.trim();setChatIn("");
setMsgs(p=>[...p,{role:"user",text:m}]);setChatLoad(true);
if(!C.apiKey){setMsgs(p=>[...p,{role:"assistant",text:"âš ï¸ AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ê´€ë¦¬ìê°€ API í‚¤ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤."}]);setChatLoad(false);return}
try{const r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",
headers:{"Content-Type":"application/json","x-api-key":C.apiKey,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},
body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,
system:'ë‹¹ì‹ ì€ "'+C.festivalName+'"ì˜ AI ì•ˆë‚´ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ì¹œì ˆí•˜ê²Œ 3~4ë¬¸ì¥ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”.\n\n[ì¶•ì œ ì •ë³´]\n'+C.festivalInfo+'\n\n[ìŠ¤íƒ¬í”„ ì¥ì†Œ]\n'+C.locations.map((l,i)=>(i+1)+'. '+l.name+': '+l.desc+' - '+l.mission).join('\n')+'\n\nì´ '+C.locations.length+'ê°œ ë°©ë¬¸â†’QRìŠ¤ìº”â†’ìŠ¤íƒ¬í”„â†’ì¢…í•©ì•ˆë‚´ì†Œ ì„ ë¬¼ìˆ˜ë ¹',
messages:[...msgs.slice(-10).map(x=>({role:x.role==="user"?"user":"assistant",content:x.text})),{role:"user",content:m}]})});
if(!r.ok)throw new Error(await r.text());const d=await r.json();
setMsgs(p=>[...p,{role:"assistant",text:d.content?.map(c=>c.text||"").join("")||"ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."}])}
catch(er){let em="ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";if(String(er).includes("invalid"))em="âš ï¸ API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
setMsgs(p=>[...p,{role:"assistant",text:em}])}setChatLoad(false)};

// â”€â”€â”€ Components â”€â”€â”€
const SI=({loc,size:sz,stamped})=>{sz=sz||44;
if(stamped&&C.stampImage)return el("img",{src:C.stampImage,style:{width:sz,height:sz,borderRadius:sz*.25,objectFit:"cover"}});
if(!stamped&&C.stampEmptyImage)return el("img",{src:C.stampEmptyImage,style:{width:sz,height:sz,borderRadius:sz*.25,objectFit:"cover",opacity:.45}});
if(loc?.iconImage)return el("div",{style:{width:sz,height:sz,borderRadius:sz*.25,overflow:"hidden",border:stamped?"3px solid "+C.accentColor:"3px solid #e2e8f0"}},el("img",{src:loc.iconImage,style:{width:"100%",height:"100%",objectFit:"cover"}}));
return el("div",{style:{width:sz,height:sz,borderRadius:"50%",background:stamped?"linear-gradient(135deg,"+C.accentColor+","+C.secondaryColor+")":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:sz*.45,color:stamped?"#fff":"#b0b8c4",fontWeight:800,boxShadow:stamped?"0 4px 16px "+C.accentColor+"55":"inset 0 2px 4px rgba(0,0,0,.06)",transform:stamped?"scale(1)":"scale(.92)",transition:"all .4s"}},stamped?"âœ“":(loc?.icon||"?"))};

const Toast=toast?el("div",{style:{position:"fixed",top:16,left:"50%",transform:"translateX(-50%)",zIndex:9999,padding:"12px 24px",borderRadius:14,background:toast.t==="ok"?"#065f46":"#991b1b",color:"#fff",fontSize:14,fontWeight:700,boxShadow:"0 8px 30px rgba(0,0,0,.25)",animation:"toastIn .3s",whiteSpace:"nowrap"}},toast.m):null;
const AdminBtn=el("button",{className:"abtn",onClick:()=>setShowAdm(true),title:"ê´€ë¦¬ì"},"âš™ï¸");
const PwModal=()=>el("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.6)",zIndex:2000,display:"flex",alignItems:"center",justifyContent:"center",padding:20}},
el("div",{style:{background:"#fff",borderRadius:20,padding:"28px 24px",width:"100%",maxWidth:320,textAlign:"center",boxShadow:"0 20px 60px rgba(0,0,0,.3)"}},
el("div",{style:{fontSize:32,marginBottom:8}},"ğŸ”"),el("p",{style:{fontSize:15,fontWeight:700,marginBottom:18}},"ê´€ë¦¬ì ì¸ì¦"),
el("input",{type:"password",inputMode:"numeric",value:admPw,autoFocus:true,onChange:e=>{setAdmPw(e.target.value);setPwErr(false)},placeholder:"ë¹„ë°€ë²ˆí˜¸",maxLength:10,
onKeyDown:e=>{if(e.key==="Enter"){if(admPw===ADMIN_PW){setAdmAuth(true);setScr("admin");setShowAdm(false);setAdmPw("")}else setPwErr(true)}},
style:{width:"100%",padding:14,borderRadius:12,border:"2px solid "+(pwErr?"#ef4444":"#e2e8f0"),fontSize:18,textAlign:"center",boxSizing:"border-box",letterSpacing:8}}),
pwErr&&el("p",{style:{color:"#ef4444",fontSize:12,marginTop:8}},"ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤"),
el("div",{style:{display:"flex",gap:10,marginTop:18}},
el("button",{onClick:()=>{setShowAdm(false);setAdmPw("");setPwErr(false)},style:{flex:1,padding:12,borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:14}},"ì·¨ì†Œ"),
el("button",{onClick:()=>{if(admPw===ADMIN_PW){setAdmAuth(true);setScr("admin");setShowAdm(false);setAdmPw("")}else setPwErr(true)},style:{flex:1,padding:12,borderRadius:10,border:"none",background:C.primaryColor,color:"#fff",fontSize:14,fontWeight:700}},"í™•ì¸"))));
const SaveBar=dirty?el("div",{style:{position:"fixed",bottom:0,left:0,right:0,zIndex:200,padding:"12px 16px",background:"linear-gradient(135deg,#1e293b,#334155)",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 -4px 20px rgba(0,0,0,.2)",animation:"slideUp .3s"}},
el("span",{style:{color:"#fbbf24",fontSize:13,fontWeight:600}},"âš ï¸ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤"),
el("button",{onClick:saveC,style:{padding:"10px 28px",borderRadius:10,border:"none",background:"linear-gradient(135deg,#22c55e,#16a34a)",color:"#fff",fontSize:14,fontWeight:800,boxShadow:"0 4px 12px rgba(34,197,94,.4)"}},"ğŸ’¾ ì €ì¥í•˜ê¸°")):null;

// â•â•â•â•â•â•â•â• REGISTER â•â•â•â•â•â•â•â•
if(scr==="register"){const ok=reg.name&&reg.birth.length>=6&&reg.phone.length>=12&&reg.agree;
return el("div",{style:{fontFamily:C.fontFamily,minHeight:"100dvh",background:"linear-gradient(160deg,"+C.primaryColor+","+C.secondaryColor+")",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,position:"relative"}},
Toast,AdminBtn,showAdm&&!admAuth&&el(PwModal),
el("div",{style:{position:"fixed",inset:0,overflow:"hidden",pointerEvents:"none"}},[0,1,2,3,4,5].map(i=>el("div",{key:i,style:{position:"absolute",width:6,height:6,borderRadius:"50%",background:"rgba(255,255,255,.15)",left:(15+i*15)+"%",top:"-10%",animation:"floatDown "+(8+i*2)+"s linear infinite",animationDelay:i*1.5+"s"}}))),
C.heroImage?el("img",{src:C.heroImage,style:{width:140,height:140,objectFit:"contain",marginBottom:10,filter:"drop-shadow(0 8px 24px rgba(0,0,0,.3))",animation:"heroFloat 3s ease-in-out infinite"}}):el("div",{style:{width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,.15)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:56,marginBottom:10,border:"2px solid rgba(255,255,255,.2)",animation:"heroFloat 3s ease-in-out infinite"}},"ğŸ”¬"),
el("h1",{style:{fontFamily:C.titleFont,fontSize:28,color:"#fff",margin:"0 0 4px",textShadow:"0 3px 12px rgba(0,0,0,.3)",textAlign:"center"}},C.festivalName),
el("p",{style:{color:"rgba(255,255,255,.85)",fontSize:14,letterSpacing:3,marginBottom:24,fontWeight:500}},C.subtitle),
showResume&&savedU?el("div",{style:{background:"rgba(255,255,255,.97)",borderRadius:20,padding:20,width:"100%",maxWidth:380,marginBottom:16,boxShadow:"0 12px 40px rgba(0,0,0,.2)",animation:"fadeIn .4s"}},
el("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:14}},
el("div",{style:{width:44,height:44,borderRadius:"50%",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,color:"#fff"}},"ğŸ‘‹"),
el("div",null,el("div",{style:{fontSize:15,fontWeight:800,color:C.textColor}},savedU.name+"ë‹˜, ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”!"),
el("div",{style:{fontSize:12,color:"#64748b",marginTop:2}},"ìŠ¤íƒ¬í”„: "+Object.keys(savedS).length+"/"+C.locations.length+"ê°œ ì§„í–‰ì¤‘"))),
el("div",{style:{display:"flex",gap:8}},
el("button",{onClick:doResume,style:{flex:2,padding:12,borderRadius:12,border:"none",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",color:"#fff",fontSize:14,fontWeight:800,boxShadow:"0 4px 16px "+C.primaryColor+"44"}},"ğŸ”„ ì´ì–´ì„œ í•˜ê¸°"),
el("button",{onClick:doNew,style:{flex:1,padding:12,borderRadius:12,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:13,color:"#64748b"}},"ìƒˆë¡œ ë“±ë¡"))):
el("div",{style:{background:"rgba(255,255,255,.97)",borderRadius:24,padding:"28px 22px",width:"100%",maxWidth:380,boxShadow:"0 24px 64px rgba(0,0,0,.2)"}},
el("h2",{style:{fontSize:17,fontWeight:800,color:C.textColor,marginBottom:20,textAlign:"center"}},"ğŸ« ì°¸ì—¬ ë“±ë¡"),
[{k:"name",l:"ì´ë¦„",ph:"í™ê¸¸ë™",im:"text"},{k:"birth",l:"ì£¼ë¯¼ë²ˆí˜¸ ì•ìë¦¬ (6ìë¦¬)",ph:"990101",im:"numeric",mx:6},{k:"phone",l:"íœ´ëŒ€í° ë²ˆí˜¸",ph:"010-1234-5678",im:"tel"}].map(f=>el("div",{key:f.k,style:{marginBottom:14}},
el("label",{style:{fontSize:12,fontWeight:600,color:"#64748b",display:"block",marginBottom:5}},f.l),
el("input",{value:reg[f.k],inputMode:f.im,maxLength:f.mx||20,placeholder:f.ph,onChange:e=>{let v=e.target.value;if(f.k==="birth")v=v.replace(/\D/g,"").slice(0,6);if(f.k==="phone"){v=v.replace(/\D/g,"").slice(0,11);if(v.length>7)v=v.slice(0,3)+"-"+v.slice(3,7)+"-"+v.slice(7);else if(v.length>3)v=v.slice(0,3)+"-"+v.slice(3)}setReg(p=>({...p,[f.k]:v}))},
style:{width:"100%",padding:"13px 14px",borderRadius:12,border:"2px solid #e8edf2",fontSize:15,boxSizing:"border-box"}}))),
el("label",{style:{display:"flex",alignItems:"flex-start",gap:10,padding:14,background:"#f8fafc",borderRadius:12,marginBottom:20,cursor:"pointer",border:reg.agree?"2px solid "+C.primaryColor+"30":"2px solid transparent"}},
el("input",{type:"checkbox",checked:reg.agree,onChange:e=>setReg(p=>({...p,agree:e.target.checked})),style:{marginTop:2,width:20,height:20,accentColor:C.primaryColor,flexShrink:0}}),
el("span",{style:{fontSize:11,color:"#64748b",lineHeight:1.6},dangerouslySetInnerHTML:{__html:'<b style="color:'+C.primaryColor+'">[í•„ìˆ˜]</b> ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.<br>ìˆ˜ì§‘: ì´ë¦„, ì£¼ë¯¼ë²ˆí˜¸ ì•ìë¦¬, íœ´ëŒ€í°ë²ˆí˜¸<br>ëª©ì : ìŠ¤íƒ¬í”„ íˆ¬ì–´ ë° ê²½í’ˆ ì§€ê¸‰<br>ë³´ìœ : í–‰ì‚¬ ì¢…ë£Œ í›„ 1ê°œì›” ì´ë‚´ íŒŒê¸°'}})),
el("button",{onClick:doReg,disabled:!ok,style:{width:"100%",padding:15,borderRadius:14,border:"none",background:ok?"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")":"#cbd5e1",color:"#fff",fontSize:17,fontWeight:800,cursor:ok?"pointer":"not-allowed",fontFamily:C.titleFont,letterSpacing:1,boxShadow:ok?"0 6px 24px "+C.primaryColor+"44":"none"}},"ğŸš€ íˆ¬ì–´ ì‹œì‘í•˜ê¸°")),
el("p",{style:{color:"rgba(255,255,255,.5)",fontSize:10,marginTop:20,textAlign:"center"}},"Â© 2026 ëŒ€ì „ê´‘ì—­ì‹œ"))}

// â•â•â•â•â•â•â•â• ADMIN â•â•â•â•â•â•â•â•
if(scr==="admin"&&admAuth){
const totalP=fbParts.length,compP=fbParts.filter(p=>p.completed).length;
const tabs=[{id:"dashboard",ic:"ğŸ“Š",l:"í˜„í™©"},{id:"locations",ic:"ğŸ“",l:"ì¥ì†Œ"},{id:"design",ic:"ğŸ¨",l:"ë””ìì¸"},{id:"api",ic:"ğŸ¤–",l:"AIì„¤ì •"},{id:"qrcodes",ic:"ğŸ“±",l:"QRì½”ë“œ"},{id:"festival",ic:"ğŸ“‹",l:"ì¶•ì œì •ë³´"},{id:"users",ic:"ğŸ‘¥",l:"ì°¸ê°€ì"}];
return el("div",{style:{fontFamily:C.fontFamily,background:"#f1f5f9",minHeight:"100vh",paddingBottom:dirty?70:0}},
Toast,SaveBar,
el("div",{style:{background:"#1e293b",color:"#fff",padding:"14px 18px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100}},
el("div",{style:{display:"flex",alignItems:"center",gap:8}},el("span",{style:{fontSize:18}},"âš™ï¸"),el("span",{style:{fontWeight:800,fontSize:15}},"ê´€ë¦¬ì ëª¨ë“œ")),
el("button",{onClick:()=>{if(dirty&&confirm("ì €ì¥í•˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì €ì¥í• ê¹Œìš”?"))saveC();setScr(user?"tour":"register")},style:{background:"rgba(255,255,255,.12)",border:"none",color:"#fff",padding:"7px 14px",borderRadius:8,fontSize:12,fontWeight:600}},"âœ• ë‚˜ê°€ê¸°")),
el("div",{style:{display:"flex",overflowX:"auto",background:"#fff",borderBottom:"2px solid #f1f5f9",position:"sticky",top:49,zIndex:99}},tabs.map(t=>el("button",{key:t.id,onClick:()=>setAdmTab(t.id),style:{padding:"11px 12px",border:"none",borderBottom:admTab===t.id?"3px solid "+C.primaryColor:"3px solid transparent",background:"transparent",color:admTab===t.id?C.primaryColor:"#94a3b8",fontWeight:admTab===t.id?700:400,fontSize:11,whiteSpace:"nowrap"}},t.ic+" "+t.l))),
el("div",{style:{padding:16,maxWidth:600,margin:"0 auto"}},

// â”€â”€ DASHBOARD â”€â”€
admTab==="dashboard"&&el("div",null,
el("h3",{style:{fontSize:15,fontWeight:800,marginBottom:14}},"ğŸ“Š ì‹¤ì‹œê°„ í˜„í™©íŒ"),
!fbOk&&el("div",{style:{padding:14,background:"#fef2f2",borderRadius:12,marginBottom:14,border:"1px solid #fecaca",fontSize:12,color:"#991b1b",lineHeight:1.6}},db===null?"âš ï¸ Firebase ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¯¸ë¦¬ë³´ê¸°ì—ì„œëŠ” ë¡œì»¬ ëª¨ë“œë¡œ ë™ì‘í•©ë‹ˆë‹¤. ì‹¤ì œ ì›¹í˜¸ìŠ¤íŒ…ì— ë°°í¬í•˜ë©´ ì •ìƒ ì—°ë™ë©ë‹ˆë‹¤.":"âš ï¸ Firestore ì—°ê²° ì˜¤ë¥˜. Firebase ì½˜ì†”ì—ì„œ Firestore ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”."),
el("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:16}},
[{n:"ì´ ì°¸ê°€ì",v:totalP,ic:"ğŸ‘¥",bg:"#0A2463"},{n:"ì™„ë£Œ",v:compP,ic:"ğŸ†",bg:"#22c55e"},{n:"ì§„í–‰ì¤‘",v:totalP-compP,ic:"ğŸ”„",bg:"#f59e0b"}].map(s=>el("div",{key:s.n,style:{background:s.bg,borderRadius:14,padding:"16px 12px",textAlign:"center",color:"#fff"}},
el("div",{style:{fontSize:24,marginBottom:4}},s.ic),
el("div",{style:{fontSize:26,fontWeight:900,fontFamily:C.titleFont}},s.v),
el("div",{style:{fontSize:10,opacity:.8,marginTop:2}},s.n)))),
// Location stats
el("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12}},
el("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12}},"ğŸ“ ì¥ì†Œë³„ ë°©ë¬¸ í˜„í™©"),
C.locations.map(loc=>{const vis=fbParts.filter(p=>p.stamps&&p.stamps[loc.id]).length;const pct=totalP>0?Math.round(vis/totalP*100):0;
return el("div",{key:loc.id,style:{marginBottom:10}},
el("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,marginBottom:4}},
el("span",null,loc.icon+" "+loc.name),
el("span",{style:{fontWeight:700,color:C.primaryColor}},vis+"ëª… ("+pct+"%)")),
el("div",{style:{height:8,background:"#e8edf2",borderRadius:4,overflow:"hidden"}},
el("div",{style:{height:"100%",width:pct+"%",background:"linear-gradient(90deg,"+C.primaryColor+","+C.accentColor+")",borderRadius:4,transition:"width .5s"}})))})),
// Recent activity
el("div",{style:{background:"#fff",borderRadius:14,padding:16}},
el("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12}},"ğŸ• ìµœê·¼ ì°¸ê°€ì"),
fbParts.slice(0,10).map((p,i)=>{const sc=p.stamps?Object.keys(p.stamps).length:0;
return el("div",{key:p.id,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:i<9?"1px solid #f1f5f9":"none"}},
el("div",null,el("span",{style:{fontWeight:700,fontSize:13}},p.name),el("span",{style:{fontSize:11,color:"#94a3b8",marginLeft:8}},p.phone)),
el("div",{style:{display:"flex",alignItems:"center",gap:6}},
el("span",{style:{fontSize:12,color:C.primaryColor,fontWeight:600}},sc+"/"+C.locations.length),
p.completed&&el("span",{style:{background:"#ecfdf5",color:"#065f46",padding:"2px 8px",borderRadius:10,fontSize:10,fontWeight:700}},"ì™„ë£Œ âœ“")))}))),

// â”€â”€ LOCATIONS â”€â”€
admTab==="locations"&&el("div",null,el("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}},el("h3",{style:{fontSize:15,fontWeight:800,margin:0}},"ìŠ¤íƒ¬í”„ ì¥ì†Œ ("+C.locations.length+"ê°œ)"),el("button",{onClick:()=>{const nl={id:"loc"+Date.now(),name:"ìƒˆ ì¥ì†Œ",icon:"ğŸ“",code:"DJSF2026-NEW"+C.locations.length,mission:"ë¯¸ì…˜ ì…ë ¥",desc:"ì„¤ëª… ì…ë ¥",iconImage:null};updC({...C,locations:[...C.locations,nl]});setEditLoc(nl.id)},style:{background:C.primaryColor,color:"#fff",border:"none",padding:"8px 14px",borderRadius:8,fontSize:12,fontWeight:700}},"+ ì¶”ê°€")),C.locations.map(loc=>el("div",{key:loc.id,style:{background:"#fff",borderRadius:14,padding:16,marginBottom:10,border:editLoc===loc.id?"2px solid "+C.primaryColor:"1px solid #f1f5f9"}},editLoc===loc.id?el("div",null,el("div",{style:{marginBottom:12}},el("label",{style:{fontSize:11,fontWeight:700,color:"#64748b",display:"block",marginBottom:6}},"ì•„ì´ì½˜"),el("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}},loc.iconImage?el("img",{src:loc.iconImage,style:{width:40,height:40,borderRadius:10,objectFit:"cover"}}):el("span",{style:{fontSize:32}},loc.icon),el("button",{onClick:()=>setEmojiPk(emojiPk===loc.id?null:loc.id),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:11}},"ì´ëª¨ì§€"),el("button",{onClick:()=>imgUp(img=>updC({...C,locations:C.locations.map(l=>l.id===loc.id?{...l,iconImage:img}:l)}),200),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:11}},"ì´ë¯¸ì§€"),loc.iconImage&&el("button",{onClick:()=>updC({...C,locations:C.locations.map(l=>l.id===loc.id?{...l,iconImage:null}:l)}),style:{padding:"6px 8px",borderRadius:8,border:"1px solid #fecaca",background:"#fef2f2",fontSize:11,color:"#dc2626"}},"âœ•")),emojiPk===loc.id&&el("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:8,padding:8,background:"#f8fafc",borderRadius:10,maxHeight:120,overflowY:"auto"}},EMOJIS.map(em=>el("button",{key:em,onClick:()=>{updC({...C,locations:C.locations.map(l=>l.id===loc.id?{...l,icon:em,iconImage:null}:l)});setEmojiPk(null)},style:{width:36,height:36,border:loc.icon===em?"2px solid "+C.primaryColor:"1px solid #e2e8f0",borderRadius:8,background:"#fff",fontSize:18,display:"flex",alignItems:"center",justifyContent:"center"}},em)))),[{k:"name",l:"ì¥ì†Œëª…",t:"i"},{k:"code",l:"QRì½”ë“œê°’",t:"i"},{k:"mission",l:"ë¯¸ì…˜",t:"t"},{k:"desc",l:"ì„¤ëª…",t:"t"}].map(f=>el("div",{key:f.k,style:{marginBottom:10}},el("label",{style:{fontSize:11,fontWeight:700,color:"#64748b"}},f.l),f.t==="t"?el("textarea",{value:loc[f.k],rows:2,onChange:e=>updC({...C,locations:C.locations.map(l=>l.id===loc.id?{...l,[f.k]:e.target.value}:l)}),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13,boxSizing:"border-box",resize:"vertical"}}):el("input",{value:loc[f.k],onChange:e=>{const v=f.k==="code"?e.target.value.toUpperCase():e.target.value;updC({...C,locations:C.locations.map(l=>l.id===loc.id?{...l,[f.k]:v}:l)})},style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13,boxSizing:"border-box",fontFamily:f.k==="code"?"monospace":"inherit"}}))),el("button",{onClick:()=>{setEditLoc(null);setEmojiPk(null)},style:{background:C.primaryColor,color:"#fff",border:"none",padding:"9px 24px",borderRadius:8,fontSize:13,fontWeight:700}},"âœ“ ì™„ë£Œ")):el("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},el("div",{style:{display:"flex",gap:12,alignItems:"center"}},loc.iconImage?el("img",{src:loc.iconImage,style:{width:36,height:36,borderRadius:8,objectFit:"cover"}}):el("span",{style:{fontSize:26}},loc.icon),el("div",null,el("div",{style:{fontWeight:700,fontSize:14}},loc.name),el("div",{style:{fontSize:10,color:"#94a3b8",fontFamily:"monospace"}},loc.code))),el("div",{style:{display:"flex",gap:6}},el("button",{onClick:()=>setEditLoc(loc.id),style:{background:"#f1f5f9",border:"none",padding:"6px 10px",borderRadius:6,fontSize:12}},"âœï¸"),el("button",{onClick:()=>{if(C.locations.length<=1)return;updC({...C,locations:C.locations.filter(l=>l.id!==loc.id)})},style:{background:"#fef2f2",border:"none",padding:"6px 10px",borderRadius:6,fontSize:12}},"ğŸ—‘")))))),

// â”€â”€ DESIGN â”€â”€
admTab==="design"&&el("div",null,el("h3",{style:{fontSize:15,fontWeight:800,marginBottom:14}},"ğŸ¨ ë””ìì¸"),el("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12}},el("h4",{style:{fontSize:13,fontWeight:700,marginBottom:14,color:"#334155"}},"ğŸ–¼ ì´ë¯¸ì§€"),[{k:"heroImage",l:"ì‹œì‘í™”ë©´ ìºë¦­í„°",ms:400},{k:"stampImage",l:"ì™„ë£Œ ìŠ¤íƒ¬í”„",ms:200},{k:"stampEmptyImage",l:"ë¯¸ì™„ë£Œ ìŠ¤íƒ¬í”„",ms:200},{k:"mapImage",l:"ì•ˆë‚´ ì§€ë„",ms:1200}].map(it=>el("div",{key:it.k,style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:"1px solid #f1f5f9"}},el("div",{style:{width:50,height:50,borderRadius:10,background:"#f8fafc",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",border:"2px dashed #e2e8f0",flexShrink:0}},C[it.k]?el("img",{src:C[it.k],style:{width:"100%",height:"100%",objectFit:"cover"}}):el("span",{style:{fontSize:10,color:"#94a3b8"}},"ì—†ìŒ")),el("div",{style:{flex:1,fontSize:13,fontWeight:600}},it.l),el("div",{style:{display:"flex",gap:4}},el("button",{onClick:()=>imgUp(img=>updC({...C,[it.k]:img}),it.ms),style:{padding:"5px 10px",borderRadius:6,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:10}},"ğŸ“·"),C[it.k]&&el("button",{onClick:()=>updC({...C,[it.k]:null}),style:{padding:"5px 10px",borderRadius:6,border:"1px solid #fecaca",background:"#fef2f2",fontSize:10,color:"#dc2626"}},"ì‚­ì œ"))))),
el("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12}},el("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12}},"âœï¸ í…ìŠ¤íŠ¸"),[{k:"festivalName",l:"ì¶•ì œëª…"},{k:"subtitle",l:"ë¶€ì œëª©"}].map(f=>el("div",{key:f.k,style:{marginBottom:10}},el("label",{style:{fontSize:11,fontWeight:600,color:"#64748b"}},f.l),el("input",{value:C[f.k],onChange:e=>updC({...C,[f.k]:e.target.value}),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:14,boxSizing:"border-box"}}))),el("label",{style:{fontSize:11,fontWeight:600,color:"#64748b"}},"ì™„ë£Œ ë©”ì‹œì§€"),el("textarea",{value:C.completionMessage,rows:3,onChange:e=>updC({...C,completionMessage:e.target.value}),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13,boxSizing:"border-box",resize:"vertical"}})),
el("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12}},el("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12}},"ğŸ¨ ìƒ‰ìƒ"),el("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}},[{k:"primaryColor",l:"ë©”ì¸"},{k:"secondaryColor",l:"ë³´ì¡°"},{k:"accentColor",l:"ê°•ì¡°"},{k:"bgColor",l:"ë°°ê²½"},{k:"textColor",l:"ê¸€ì"},{k:"cardBg",l:"ì¹´ë“œ"}].map(c=>el("div",{key:c.k},el("label",{style:{fontSize:10,fontWeight:600,color:"#64748b"}},c.l),el("div",{style:{display:"flex",alignItems:"center",gap:6}},el("input",{type:"color",value:C[c.k],onChange:e=>updC({...C,[c.k]:e.target.value}),style:{width:32,height:32,border:"2px solid #e2e8f0",borderRadius:8,padding:0}}),el("input",{value:C[c.k],onChange:e=>updC({...C,[c.k]:e.target.value}),style:{flex:1,padding:7,borderRadius:6,border:"1px solid #e2e8f0",fontSize:11,fontFamily:"monospace"}})))))),
el("div",{style:{background:"#fff",borderRadius:14,padding:16,marginBottom:12}},el("h4",{style:{fontSize:13,fontWeight:700,marginBottom:12}},"ğŸ”¤ í°íŠ¸"),[{k:"titleFont",l:"ì œëª©",o:["'Black Han Sans',sans-serif","'Jua',sans-serif","'Do Hyeon',sans-serif","'Gugi',sans-serif","'Gaegu',cursive"]},{k:"fontFamily",l:"ë³¸ë¬¸",o:["'Noto Sans KR',sans-serif","'Jua',sans-serif","'Gothic A1',sans-serif","'Gamja Flower',cursive","'Gaegu',cursive"]}].map(f=>el("div",{key:f.k,style:{marginBottom:10}},el("label",{style:{fontSize:10,fontWeight:600,color:"#64748b"}},f.l),el("select",{value:C[f.k],onChange:e=>updC({...C,[f.k]:e.target.value}),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #e2e8f0",fontSize:13}},f.o.map(o=>el("option",{key:o,value:o},o.split("'")[1]))),el("div",{style:{marginTop:4,padding:8,background:"#f8fafc",borderRadius:8,fontFamily:C[f.k],fontSize:f.k==="titleFont"?20:14}},"ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸"))))),

// â”€â”€ API â”€â”€
admTab==="api"&&el("div",null,el("h3",{style:{fontSize:15,fontWeight:800,marginBottom:6}},"ğŸ¤– AI ì„¤ì •"),el("div",{style:{background:"#fffbeb",borderRadius:12,padding:14,marginBottom:16,border:"1px solid #fde68a"}},el("p",{style:{fontSize:13,fontWeight:700,color:"#92400e",marginBottom:8}},"AI ê¸°ëŠ¥ì„ ì“°ë ¤ë©´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤"),el("p",{style:{fontSize:12,color:"#a16207",lineHeight:1.6}},"console.anthropic.comì—ì„œ ë°œê¸‰ ê°€ëŠ¥")),el("div",{style:{background:"#fff",borderRadius:14,padding:16}},el("label",{style:{fontSize:12,fontWeight:700,display:"block",marginBottom:8}},"Anthropic API Key"),el("input",{type:"password",value:C.apiKey||"",placeholder:"sk-ant-api03-...",onChange:e=>updC({...C,apiKey:e.target.value}),style:{width:"100%",padding:12,borderRadius:10,border:"2px solid #e2e8f0",fontSize:13,boxSizing:"border-box",fontFamily:"monospace"}}),C.apiKey&&el("div",{style:{marginTop:12,padding:10,background:"#ecfdf5",borderRadius:8,fontSize:12,color:"#065f46"}},"âœ… í‚¤ ì„¤ì • ì™„ë£Œ"))),

// â”€â”€ QR â”€â”€
admTab==="qrcodes"&&el("div",null,el("h3",{style:{fontSize:15,fontWeight:800,marginBottom:6}},"ğŸ“± QR ì½”ë“œ"),el("p",{style:{fontSize:12,color:"#64748b",marginBottom:16}},"ê° ì¥ì†Œì— ì¸ì‡„í•˜ì—¬ ë¹„ì¹˜í•˜ì„¸ìš”."),el("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}},C.locations.map(loc=>el("div",{key:loc.id,style:{background:"#fff",borderRadius:14,padding:14,textAlign:"center"}},el("div",{style:{fontSize:22,marginBottom:4}},loc.icon),el("div",{style:{fontSize:12,fontWeight:700,marginBottom:6}},loc.name),el("img",{src:getQR(loc.code,300),style:{width:"100%",maxWidth:160,borderRadius:8}}),el("div",{style:{marginTop:6,fontSize:9,color:"#94a3b8",fontFamily:"monospace",background:"#f8fafc",padding:"3px 6px",borderRadius:4}},loc.code))))),

// â”€â”€ FESTIVAL â”€â”€
admTab==="festival"&&el("div",null,el("h3",{style:{fontSize:15,fontWeight:800,marginBottom:6}},"ğŸ“‹ ì¶•ì œ ì •ë³´ (AIìš©)"),el("textarea",{value:C.festivalInfo,rows:18,onChange:e=>updC({...C,festivalInfo:e.target.value}),style:{width:"100%",padding:14,borderRadius:12,border:"2px solid #e2e8f0",fontSize:14,lineHeight:1.8,boxSizing:"border-box",resize:"vertical"}}),el("div",{style:{marginTop:10,padding:12,background:"#ecfdf5",borderRadius:10,fontSize:11,color:"#065f46"}},"ğŸ’¡ ìƒì„¸í• ìˆ˜ë¡ AI ë‹µë³€ í’ˆì§ˆì´ ë†’ì•„ì§‘ë‹ˆë‹¤.")),

// â”€â”€ PARTICIPANTS (Firebase) â”€â”€
admTab==="users"&&el("div",null,
el("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}},
el("h3",{style:{fontSize:15,fontWeight:800,margin:0}},"ğŸ‘¥ ì°¸ê°€ì ("+(fbOk?fbParts.length:LS("parts")?.length||0)+"ëª…)"),
el("div",{style:{display:"flex",gap:6}},
el("div",{style:{padding:"4px 10px",borderRadius:8,background:fbOk?"#ecfdf5":"#fef2f2",fontSize:11,fontWeight:600,color:fbOk?"#065f46":"#991b1b"}},fbOk?"ğŸŸ¢ ì‹¤ì‹œê°„":"ğŸŸ¡ ë¡œì»¬ëª¨ë“œ"))),
(function(){const pList=fbOk?fbParts:(LS("parts")||[]).slice().reverse();
return pList.length===0?el("div",{style:{textAlign:"center",padding:40,color:"#94a3b8"}},"ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤"):
el("div",null,pList.map((p,i)=>{const sc=p.stamps?Object.keys(p.stamps).length:0;
return el("div",{key:p.id||i,style:{background:"#fff",borderRadius:12,padding:"12px 14px",marginBottom:6,display:"flex",justifyContent:"space-between",alignItems:"center"}},
el("div",null,el("div",{style:{fontWeight:700,fontSize:14}},el("span",{style:{color:"#94a3b8",fontSize:12,marginRight:6}},pList.length-i),p.name),
el("div",{style:{fontSize:11,color:"#64748b",marginTop:2}},(p.birth||"")+" Â· "+(p.phone||""))),
el("div",{style:{textAlign:"right"}},
fbOk&&el("div",{style:{fontSize:13,fontWeight:700,color:C.primaryColor}},sc+"/"+C.locations.length),
p.completed?el("div",{style:{fontSize:10,color:"#065f46",fontWeight:700,background:"#ecfdf5",padding:"2px 8px",borderRadius:8,marginTop:4}},"âœ… ì™„ë£Œ"):fbOk?el("div",{style:{fontSize:10,color:"#94a3b8",marginTop:4}},"ì§„í–‰ì¤‘"):null))}))})()))}

// â•â•â•â•â•â•â•â• MAIN TOUR â•â•â•â•â•â•â•â•
return el("div",{style:{fontFamily:C.fontFamily,background:C.bgColor,minHeight:"100dvh",paddingBottom:90}},
Toast,AdminBtn,showAdm&&!admAuth&&el(PwModal),
showComp&&el("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.65)",zIndex:1100,display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>setShowComp(false)},el("div",{onClick:e=>e.stopPropagation(),style:{background:"#fff",borderRadius:24,padding:"36px 28px",width:"100%",maxWidth:340,textAlign:"center",animation:"bounceIn .5s"}},el("div",{style:{fontSize:56,marginBottom:8}},"ğŸ†"),el("h2",{style:{fontFamily:C.titleFont,fontSize:22,color:C.primaryColor,margin:"0 0 10px"}},"ë¯¸ì…˜ ì™„ë£Œ!"),el("p",{style:{fontSize:14,color:"#475569",lineHeight:1.8,whiteSpace:"pre-line"}},C.completionMessage),el("div",{style:{marginTop:16,padding:14,background:C.primaryColor+"0a",borderRadius:12,fontSize:13,color:C.primaryColor,fontWeight:600}},"ğŸ“‹ "+user?.name+" | ğŸ“± "+user?.phone),el("button",{onClick:()=>setShowComp(false),style:{marginTop:18,padding:"12px 40px",borderRadius:12,border:"none",background:C.accentColor,color:"#fff",fontSize:15,fontWeight:800}},"í™•ì¸"))),
(scanning||scanRes)&&el("div",{style:{position:"fixed",inset:0,background:"#000",zIndex:1100,display:"flex",flexDirection:"column"}},el("div",{style:{padding:"14px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",background:"rgba(0,0,0,.8)",zIndex:10}},el("span",{style:{color:"#fff",fontSize:15,fontWeight:700}},"ğŸ“· QR ìŠ¤ìº”"),el("button",{onClick:()=>{stopScan();setScanRes(null)},style:{background:"rgba(255,255,255,.15)",border:"none",color:"#fff",padding:"8px 16px",borderRadius:8,fontSize:13}},"âœ• ë‹«ê¸°")),scanRes?el("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:30}},el("div",{style:{background:"#fff",borderRadius:24,padding:"40px 28px",width:"100%",maxWidth:340,textAlign:"center",animation:"bounceIn .4s"}},el("div",{style:{fontSize:56,marginBottom:8}},scanRes.ic),el("h3",{style:{fontSize:18,fontWeight:800,color:scanRes.ok?C.primaryColor:"#dc2626",margin:"0 0 8px"}},scanRes.ok?"ìŠ¤íƒ¬í”„ íšë“!":"ì•Œë¦¼"),el("p",{style:{fontSize:15,color:"#475569",lineHeight:1.6,whiteSpace:"pre-line"}},scanRes.msg),el("div",{style:{display:"flex",gap:10,marginTop:20}},el("button",{onClick:()=>{setScanRes(null);startScan()},style:{flex:1,padding:12,borderRadius:10,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:14}},"ê³„ì† ìŠ¤ìº”"),el("button",{onClick:()=>setScanRes(null),style:{flex:1,padding:12,borderRadius:10,border:"none",background:C.primaryColor,color:"#fff",fontSize:14,fontWeight:700}},"ëŒì•„ê°€ê¸°")))):el("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center"}},el("video",{ref:vidRef,style:{width:"100%",height:"100%",objectFit:"cover"},playsInline:true,muted:true}),el("canvas",{ref:canRef,style:{display:"none"}}),el("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"}},el("div",{style:{width:240,height:240,position:"relative"}},[[0,0,"Top","Left"],[0,1,"Top","Right"],[1,0,"Bottom","Left"],[1,1,"Bottom","Right"]].map(([r,c,v,hr])=>{const s={position:"absolute",width:36,height:36,borderStyle:"solid",borderColor:C.secondaryColor,borderWidth:0};s[v.toLowerCase()]=-2;s[hr.toLowerCase()]=-2;s["border"+v+"Width"]=4;s["border"+hr+"Width"]=4;s["border"+v+hr+"Radius"]=12;return el("div",{key:r+""+c,style:s})}),el("div",{style:{position:"absolute",left:10,right:10,height:3,background:"linear-gradient(90deg,transparent,"+C.secondaryColor+",transparent)",borderRadius:2,animation:"scanLine 2s ease-in-out infinite"}}))),camErr&&el("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.9)",padding:30}},el("div",{style:{textAlign:"center",color:"#fff"}},el("div",{style:{fontSize:48,marginBottom:12}},"ğŸ“·"),el("p",{style:{fontSize:14,whiteSpace:"pre-line",lineHeight:1.8}},camErr),el("button",{onClick:startScan,style:{marginTop:20,padding:"12px 30px",borderRadius:10,border:"none",background:C.primaryColor,color:"#fff",fontSize:14,fontWeight:700}},"ë‹¤ì‹œ ì‹œë„"))),el("div",{style:{position:"absolute",bottom:30,left:0,right:0,textAlign:"center"}},el("p",{style:{color:"rgba(255,255,255,.8)",fontSize:13}},"QRì½”ë“œë¥¼ ì‚¬ê°í˜• ì•ˆì— ë§ì¶°ì£¼ì„¸ìš”")))),
showMap&&el("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.65)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:()=>setShowMap(false)},el("div",{onClick:e=>e.stopPropagation(),style:{background:"#fff",borderRadius:20,width:"100%",maxWidth:420,maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",animation:"slideUp .3s"}},el("div",{style:{padding:"14px 18px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #f1f5f9",flexShrink:0}},el("span",{style:{fontWeight:800,fontSize:15}},"ğŸ—º ì•ˆë‚´ ì§€ë„"),el("button",{onClick:()=>setShowMap(false),style:{width:32,height:32,borderRadius:"50%",border:"none",background:"#f1f5f9",fontSize:16,display:"flex",alignItems:"center",justifyContent:"center"}},"âœ•")),el("div",{style:{flex:1,overflow:"auto",padding:12}},C.mapImage?el("img",{src:C.mapImage,style:{width:"100%",borderRadius:12}}):el("div",{style:{padding:"60px 20px",textAlign:"center",color:"#94a3b8"}},el("div",{style:{fontSize:48}},"ğŸ—º"),el("p",{style:{fontSize:14,marginTop:8}},"ì§€ë„ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤")),el("div",{style:{marginTop:12}},C.locations.map((loc,i)=>el("div",{key:loc.id,style:{display:"flex",gap:10,alignItems:"center",padding:"10px 6px",borderBottom:"1px solid #f8fafc"}},el("div",{style:{width:28,height:28,borderRadius:"50%",background:stamps[loc.id]?C.accentColor:"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:stamps[loc.id]?"#fff":"#64748b",fontWeight:700,flexShrink:0}},stamps[loc.id]?"âœ“":i+1),el("div",null,el("div",{style:{fontSize:13,fontWeight:600}},loc.icon+" "+loc.name)))))))),
scr==="chat"&&el("div",{style:{position:"fixed",inset:0,background:C.bgColor,zIndex:900,display:"flex",flexDirection:"column"}},el("div",{style:{background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",color:"#fff",padding:"14px 18px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}},el("div",{style:{display:"flex",alignItems:"center",gap:10}},el("div",{style:{width:36,height:36,borderRadius:"50%",background:"rgba(255,255,255,.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20}},"ğŸ¤–"),el("div",null,el("div",{style:{fontWeight:700,fontSize:14}},"AI ì•ˆë‚´ ë§¤ë‹ˆì €"))),el("button",{onClick:()=>setScr("tour"),style:{background:"rgba(255,255,255,.15)",border:"none",color:"#fff",padding:"7px 14px",borderRadius:8,fontSize:12}},"âœ•")),el("div",{style:{flex:1,overflow:"auto",padding:14,display:"flex",flexDirection:"column",gap:10}},msgs.length===0&&el("div",{style:{textAlign:"center",padding:"32px 16px",color:"#94a3b8"}},el("div",{style:{fontSize:44,marginBottom:8}},"ğŸ¤–"),el("p",{style:{fontSize:14,fontWeight:600,color:"#475569"}},"ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!"),!C.apiKey&&el("div",{style:{padding:12,background:"#fef3c7",borderRadius:10,fontSize:12,color:"#92400e",marginTop:12,marginBottom:12}},"âš ï¸ AIê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"),["ì¶•ì œ ì¼ì •ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?","ìŠ¤íƒ¬í”„ íˆ¬ì–´ ì°¸ì—¬ ë°©ë²•","ì£¼ì°¨ì¥ì´ ì–´ë””ì— ìˆë‚˜ìš”?"].map(q=>el("button",{key:q,onClick:()=>setChatIn(q),style:{display:"block",width:"100%",padding:"10px 14px",marginBottom:8,borderRadius:12,border:"1px solid "+C.primaryColor+"22",background:C.primaryColor+"06",color:C.primaryColor,fontSize:13,textAlign:"left"}},"ğŸ’¬ "+q))),msgs.map((m,i)=>el("div",{key:i,style:{display:"flex",justifyContent:m.role==="user"?"flex-end":"flex-start",gap:8}},m.role!=="user"&&el("div",{style:{width:30,height:30,borderRadius:"50%",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,flexShrink:0}},"ğŸ¤–"),el("div",{style:{maxWidth:"78%",padding:"10px 14px",borderRadius:m.role==="user"?"14px 14px 4px 14px":"14px 14px 14px 4px",background:m.role==="user"?C.primaryColor:"#fff",color:m.role==="user"?"#fff":C.textColor,fontSize:14,lineHeight:1.7,whiteSpace:"pre-wrap"}},m.text))),chatLoad&&el("div",{style:{display:"flex",gap:8}},el("div",{style:{width:30,height:30,borderRadius:"50%",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14}},"ğŸ¤–"),el("div",{style:{padding:"10px 16px",background:"#fff",borderRadius:14,fontSize:18,animation:"blink 1.4s infinite"}},"â€¢â€¢â€¢")),el("div",{ref:chatEnd})),el("div",{style:{padding:"10px 14px",borderTop:"1px solid #e2e8f0",background:"#fff",display:"flex",gap:8,flexShrink:0,paddingBottom:"max(10px,env(safe-area-inset-bottom))"}},el("input",{value:chatIn,onChange:e=>setChatIn(e.target.value),onKeyDown:e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendChat()}},placeholder:"ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...",style:{flex:1,padding:"12px 16px",borderRadius:24,border:"2px solid #e2e8f0",fontSize:14}}),el("button",{onClick:sendChat,disabled:!chatIn.trim()||chatLoad,style:{width:44,height:44,borderRadius:"50%",border:"none",background:chatIn.trim()?C.primaryColor:"#e2e8f0",color:"#fff",fontSize:18}},"â†‘"))),
el("div",{style:{background:"linear-gradient(160deg,"+C.primaryColor+","+C.secondaryColor+")",padding:"22px 20px 52px",textAlign:"center",position:"relative"}},C.heroImage&&el("img",{src:C.heroImage,style:{width:50,height:50,objectFit:"contain",position:"absolute",top:12,left:16}}),el("h1",{style:{fontFamily:C.titleFont,fontSize:22,color:"#fff",margin:0}},C.festivalName),el("p",{style:{color:"rgba(255,255,255,.8)",fontSize:12,marginTop:3,letterSpacing:2}},C.subtitle),el("p",{style:{color:"rgba(255,255,255,.9)",fontSize:13,marginTop:8}},"ğŸ‘‹ ",el("b",null,user?.name),"ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!")),
el("div",{style:{margin:"-32px 16px 14px",background:C.cardBg,borderRadius:18,padding:"18px 18px 14px",boxShadow:"0 6px 24px rgba(0,0,0,.08)",position:"relative",zIndex:10}},el("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}},el("span",{style:{fontSize:14,fontWeight:700,color:C.textColor}},"ğŸ—‚ ìŠ¤íƒ¬í”„ ìˆ˜ì§‘"),el("span",{style:{fontSize:22,fontWeight:900,color:C.primaryColor,fontFamily:C.titleFont}},cnt+"/"+C.locations.length)),el("div",{style:{display:"flex",justifyContent:"center",gap:8,flexWrap:"wrap"}},C.locations.map(l=>el(SI,{key:l.id,loc:l,stamped:!!stamps[l.id],size:42}))),el("div",{style:{marginTop:12,height:7,background:"#e8edf2",borderRadius:4,overflow:"hidden"}},el("div",{style:{height:"100%",width:(cnt/Math.max(C.locations.length,1)*100)+"%",background:"linear-gradient(90deg,"+C.primaryColor+","+C.accentColor+")",borderRadius:4,transition:"width .6s"}})),allDone&&el("button",{onClick:()=>setShowComp(true),style:{width:"100%",marginTop:12,padding:13,borderRadius:12,border:"none",background:"linear-gradient(135deg,"+C.accentColor+",#f59e0b)",color:"#fff",fontSize:15,fontWeight:800,animation:"pulse 2s infinite",fontFamily:C.titleFont}},"ğŸ† ì„ ë¬¼ ìˆ˜ë ¹í•˜ê¸°")),
el("div",{style:{padding:"0 16px",display:"flex",gap:10,marginBottom:14}},el("button",{onClick:()=>{setScanRes(null);startScan()},style:{flex:2,padding:14,borderRadius:14,border:"none",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",color:"#fff",fontSize:15,fontWeight:800,display:"flex",alignItems:"center",justifyContent:"center",gap:8,boxShadow:"0 4px 16px "+C.primaryColor+"33"}},el("span",{style:{fontSize:20}},"ğŸ“·")," QR ìŠ¤ìº”"),el("button",{onClick:()=>setShowMap(true),style:{flex:1,padding:14,borderRadius:14,border:"2px solid "+C.primaryColor+"22",background:C.cardBg,color:C.primaryColor,fontSize:14,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",gap:6}},"ğŸ—º ì§€ë„")),
el("div",{style:{padding:"0 16px"}},el("h3",{style:{fontSize:14,fontWeight:800,color:C.textColor,marginBottom:10}},"ğŸ“ ìŠ¤íƒ¬í”„ ì¥ì†Œ"),C.locations.map(l=>el("div",{key:l.id,style:{background:C.cardBg,borderRadius:14,padding:14,marginBottom:8,display:"flex",gap:12,alignItems:"center",border:stamps[l.id]?"2px solid "+C.accentColor+"30":"1px solid #f1f5f9"}},el(SI,{loc:l,stamped:!!stamps[l.id],size:44}),el("div",{style:{flex:1}},el("div",{style:{fontSize:14,fontWeight:700,color:C.textColor}},l.name),el("div",{style:{fontSize:11,color:"#94a3b8",marginTop:2}},l.desc),el("div",{style:{fontSize:11,color:C.primaryColor,marginTop:3,fontWeight:500}},"ğŸ“Œ "+l.mission)),stamps[l.id]&&el("div",{style:{background:C.accentColor+"15",color:C.accentColor,padding:"4px 10px",borderRadius:20,fontSize:10,fontWeight:800}},"ì™„ë£Œ âœ“")))),
el("div",{style:{padding:16,textAlign:"center"}},el("button",{onClick:doLogout,style:{padding:"8px 20px",borderRadius:8,border:"1px solid #e2e8f0",background:"#f8fafc",fontSize:12,color:"#94a3b8"}},"ğŸšª íˆ¬ì–´ ì¢…ë£Œ")),
el("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:"#fff",borderTop:"1px solid #e8edf2",display:"flex",justifyContent:"space-around",alignItems:"flex-end",padding:"6px 0",paddingBottom:"max(6px,env(safe-area-inset-bottom))",zIndex:100}},el("button",{onClick:()=>setScr("tour"),style:{border:"none",background:"transparent",display:"flex",flexDirection:"column",alignItems:"center",gap:2,color:scr==="tour"?C.primaryColor:"#94a3b8",fontSize:10,fontWeight:600,padding:"4px 18px"}},el("span",{style:{fontSize:20}},"ğŸ—º"),"íˆ¬ì–´"),el("button",{onClick:()=>{setScanRes(null);startScan()},style:{border:"none",background:"linear-gradient(135deg,"+C.primaryColor+","+C.secondaryColor+")",width:54,height:54,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",marginTop:-22,boxShadow:"0 4px 20px "+C.primaryColor+"44"}},el("span",{style:{fontSize:24}},"ğŸ“·")),el("button",{onClick:()=>setScr("chat"),style:{border:"none",background:"transparent",display:"flex",flexDirection:"column",alignItems:"center",gap:2,color:"#94a3b8",fontSize:10,fontWeight:600,padding:"4px 18px"}},el("span",{style:{fontSize:20}},"ğŸ¤–"),"AIì•ˆë‚´")))}

ReactDOM.render(el(App),document.getElementById("root"));
</script>
</body>
</html>
