<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>ì¶•ì œ ë³´ë¬¼ì°¾ê¸°</title>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700;900&family=Jua&family=Do+Hyeon&family=Gasoek+One&family=Gugi&family=Dokdo&family=East+Sea+Dokdo&family=Gamja+Flower&family=Hi+Melody&family=Poor+Story&family=Single+Day&family=Sunflower:wght@500;700&family=Yeon+Sung&family=Gothic+A1:wght@700;900&family=Song+Myung&family=Nanum+Pen+Script&family=Nanum+Brush+Script&family=Orbit&family=Bagel+Fat+One&family=Dongle:wght@700&family=IBM+Plex+Sans+KR:wght@400;700&family=Noto+Serif+KR:wght@400;700&family=Hahmlet:wght@400;700&family=Gowun+Dodum&family=Gowun+Batang&family=Stylish&family=Cute+Font&family=Kirang+Haerang&family=Black+And+White+Picture&family=Nanum+Gothic:wght@700;800&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<style>
:root{--primary:#FFD700;--primary-rgb:255,215,0;--secondary:#FF6B6B;--secondary-rgb:255,107,107;--accent:#6C5CE7;--accent-rgb:108,92,231;--bg-start:#1a1a2e;--bg-mid:#16213e;--bg-end:#0f3460;--card-bg:rgba(255,255,255,0.06);--card-border:rgba(255,255,255,0.1);--text:#fff;--text-muted:rgba(255,255,255,0.6);--text-dim:rgba(255,255,255,0.35);--font-display:'Black Han Sans',sans-serif;--font-body:'Noto Sans KR',sans-serif;--mission-1:#FF6B6B;--mission-2:#4ECDC4;--mission-3:#FFD93D;--mission-4:#6C5CE7;--mission-5:#FF8A5B;--mission-6:#EA4C89;--mission-7:#00B894;--mission-8:#FDCB6E;--mission-9:#E17055;--mission-10:#0984E3;--success:#4CAF50;--error:#FF6B6B;--btn-text:#1a1a2e}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{overflow-x:hidden;overscroll-behavior:none}
body{font-family:var(--font-body);background:linear-gradient(135deg,var(--bg-start),var(--bg-mid),var(--bg-end));color:var(--text);min-height:100vh;min-height:100dvh}
input,textarea,button,select{font-family:var(--font-body);-webkit-appearance:none}
#bg-layer{position:fixed;inset:0;z-index:0;pointer-events:none;background-size:cover;background-position:center;opacity:0;transition:opacity .5s}
#bg-overlay{position:fixed;inset:0;z-index:0;pointer-events:none}
#deco-layer{position:fixed;inset:0;z-index:1;pointer-events:none;overflow:hidden}
.deco-img{position:absolute;pointer-events:none}
@keyframes decoFloat{0%,100%{transform:translateY(0) var(--deco-extra,)}50%{transform:translateY(-15px) var(--deco-extra,)}}
@keyframes decoSpin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
@keyframes decoPulse{0%,100%{opacity:var(--deco-op,.7);transform:scale(1)}50%{opacity:1;transform:scale(1.12)}}
@keyframes decoSwing{0%,100%{transform:rotate(-8deg)}50%{transform:rotate(8deg)}}
@keyframes decoBounce{0%,100%{transform:translateY(0)}30%{transform:translateY(-18px)}50%{transform:translateY(-8px)}70%{transform:translateY(-14px)}}
@keyframes decoFadeLoop{0%,100%{opacity:.3}50%{opacity:var(--deco-op,.7)}}
.deco-float{animation:decoFloat 4s ease-in-out infinite}
.deco-spin{animation:decoSpin 8s linear infinite}
.deco-pulse{animation:decoPulse 3s ease-in-out infinite}
.deco-swing{animation:decoSwing 3s ease-in-out infinite;transform-origin:top center}
.deco-bounce{animation:decoBounce 2s ease-in-out infinite}
.deco-fadeloop{animation:decoFadeLoop 4s ease-in-out infinite}
.page{display:none;min-height:100vh;min-height:100dvh;padding:20px;flex-direction:column;position:relative;z-index:2}
.page.active{display:flex}
.center{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;flex:1}
.title{font-family:var(--font-display)}
.gold{background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.title-solid{-webkit-text-fill-color:currentColor!important;background:none!important}
.btn{border:none;border-radius:14px;cursor:pointer;font-weight:900;transition:all .2s;-webkit-user-select:none}
.btn:active{transform:scale(.97)}
.btn-gold{background:linear-gradient(135deg,var(--primary),var(--secondary));color:var(--btn-text);padding:18px;font-size:18px;width:100%}
.btn-ghost{background:rgba(255,255,255,.08);color:var(--text-muted);border:1px solid rgba(255,255,255,.12);padding:12px 24px;font-size:14px}
.btn-accent{background:linear-gradient(135deg,var(--accent),rgba(var(--accent-rgb),.7));color:#fff;padding:16px;font-size:16px;width:100%}
.btn-sm{padding:8px 16px;font-size:13px;border-radius:10px}
.btn-xs{padding:4px 10px;font-size:11px;border-radius:8px}
.btn-danger{background:rgba(255,107,107,.15);color:#FF6B6B;border:1px solid rgba(255,107,107,.3);padding:12px 24px;font-size:14px}
.inp{width:100%;padding:14px 16px;font-size:15px;background:rgba(255,255,255,.08);border:2px solid rgba(255,255,255,.12);border-radius:12px;color:#fff;outline:none}
.inp:focus{border-color:rgba(var(--primary-rgb),.5)}
.inp-sm{padding:10px 12px;font-size:14px}
.inp-xs{padding:6px 8px;font-size:12px}
select.inp{cursor:pointer}
.card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;padding:20px}
.err-box{margin-top:12px;padding:12px 16px;background:rgba(255,107,107,.15);border:1px solid rgba(255,107,107,.3);border-radius:12px;color:#FF6B6B;font-size:14px;text-align:center}
.divider{height:1px;background:rgba(255,255,255,.08);margin:16px 0}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(var(--primary-rgb),.3)}50%{box-shadow:0 0 40px rgba(var(--primary-rgb),.7)}}
@keyframes bounceIn{0%{opacity:0;transform:scale(.3)}50%{transform:scale(1.05)}100%{opacity:1;transform:scale(1)}}
@keyframes confetti{0%{transform:translateY(-100vh) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
@keyframes sparkle{0%{opacity:0;transform:scale(0) rotate(0)}50%{opacity:1;transform:scale(1) rotate(180deg)}100%{opacity:0;transform:scale(0) rotate(360deg)}}
@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.float{animation:float 3s ease-in-out infinite}.glow{animation:glow 2s ease-in-out infinite}.bounce{animation:bounceIn .6s ease-out}.shake{animation:shake .4s ease-in-out}.fadeIn{animation:fadeIn .4s ease-out}
.scanning-spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(var(--primary-rgb),.3);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite;vertical-align:middle;margin-right:8px}
.confetti-wrap{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999}
.confetti-piece{position:absolute;top:-20px;animation:confetti 3s linear infinite}
.sparkle-wrap{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.sparkle-piece{position:absolute;animation:sparkle 2s ease-in-out infinite}
.mission-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.mission-card{border-radius:18px;padding:20px 14px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;cursor:pointer;transition:all .2s;position:relative;min-height:155px}
.mission-card:active:not(.done){transform:scale(.97)}
.mission-card.done{cursor:default;opacity:.85}
.done-badge{position:absolute;top:10px;right:10px;width:26px;height:26px;border-radius:50%;background:var(--success);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:900}
.progress-dot{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px}
.progress-dot.completed{background:linear-gradient(135deg,#4CAF50,#2E7D32);border:2px solid #4CAF50}
.progress-dot.pending{background:rgba(255,255,255,.06);border:2px solid rgba(255,255,255,.1)}
.admin-tabs{display:flex;gap:6px;margin-bottom:20px;overflow-x:auto;padding-bottom:4px;-webkit-overflow-scrolling:touch}
.admin-tabs::-webkit-scrollbar{display:none}
.tab-btn{flex-shrink:0;padding:9px 14px;font-size:12px;border-radius:10px;cursor:pointer;white-space:nowrap;border:none;font-weight:700}
.tab-btn.active{background:rgba(var(--accent-rgb),.25);color:rgb(var(--accent-rgb));border:1px solid rgba(var(--accent-rgb),.4)}
.tab-btn.inactive{background:rgba(255,255,255,.05);color:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.08)}
.admin-section{display:none;flex-direction:column;gap:16px;flex:1;animation:fadeIn .3s}
.admin-section.active{display:flex}
.admin-label{display:block;margin-bottom:6px;font-size:13px;font-weight:700;color:rgba(255,255,255,.7)}
.admin-group{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px}
.theme-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(95px,1fr));gap:10px}
.theme-card{border-radius:14px;padding:12px 8px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all .15s}
.theme-card:active{transform:scale(.96)}
.theme-card.selected{border-color:var(--primary);box-shadow:0 0 20px rgba(var(--primary-rgb),.3)}
.theme-card .preview{width:100%;height:36px;border-radius:8px;margin-bottom:6px}
.color-row{display:flex;align-items:center;gap:10px;padding:8px 0}
.color-row label{font-size:12px;color:var(--text-dim);min-width:60px}
.color-inp{width:44px;height:44px;border:2px solid rgba(255,255,255,.2);border-radius:10px;cursor:pointer;padding:2px;background:transparent;flex-shrink:0}
.color-inp::-webkit-color-swatch{border:none;border-radius:8px}
.color-inp::-webkit-color-swatch-wrapper{padding:0}
.font-option{padding:12px 14px;border-radius:12px;cursor:pointer;border:2px solid transparent;margin-bottom:6px;background:rgba(255,255,255,.04);transition:all .15s}
.font-option:active{transform:scale(.98)}
.font-option.selected{border-color:var(--primary);background:rgba(var(--primary-rgb),.1)}
.font-cat-title{font-size:11px;font-weight:900;color:var(--primary);padding:8px 0 4px;text-transform:uppercase;letter-spacing:1px}
.upload-zone{border:2px dashed rgba(255,255,255,.15);border-radius:14px;padding:24px 16px;text-align:center;cursor:pointer;position:relative;overflow:hidden;transition:border-color .2s}
.upload-zone:hover{border-color:rgba(var(--primary-rgb),.4)}
.upload-preview{width:100%;max-height:200px;object-fit:contain;border-radius:10px;margin-top:10px}
.deco-admin-card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;display:flex;gap:10px;align-items:flex-start;margin-bottom:10px}
.deco-admin-card img{width:56px;height:56px;object-fit:contain;border-radius:8px;background:rgba(255,255,255,.06);flex-shrink:0}
.deco-ctrl{display:flex;gap:6px;flex-wrap:wrap}
.deco-ctrl select,.deco-ctrl input[type=range]{height:28px;font-size:10px}
.pt-row{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.mini-dot{width:22px;height:22px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:10px;margin-left:3px}
.qr-card{background:#fff;border-radius:14px;padding:16px;display:flex;flex-direction:column;align-items:center;text-align:center}
.qr-card img{width:200px;height:200px}
video{width:100%;height:100%;object-fit:cover}
.stat-card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:16px;text-align:center;flex:1}
.stat-num{font-size:28px;font-weight:900;font-family:var(--font-display)}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);padding:12px 24px;border-radius:12px;font-size:14px;font-weight:700;z-index:1000;animation:slideUp .3s ease-out;pointer-events:none;white-space:nowrap}
.toast-ok{background:rgba(76,175,80,.9);color:#fff}.toast-err{background:rgba(255,107,107,.9);color:#fff}
.toggle-row{display:flex;align-items:center;gap:10px;padding:6px 0}
.toggle{position:relative;width:44px;height:24px;background:rgba(255,255,255,.15);border-radius:12px;cursor:pointer;transition:background .2s;flex-shrink:0}
.toggle.on{background:var(--primary)}
.toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:#fff;transition:transform .2s}
.toggle.on::after{transform:translateX(20px)}
.xy-grid{display:grid;grid-template-columns:auto 1fr auto 1fr;gap:6px;align-items:center;font-size:11px;color:var(--text-dim)}
.xy-grid input[type=range]{width:100%}

/* â”€â”€ ê´€ë¦¬ì ì§„ì… ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨, ì´ˆì†Œí˜•) â”€â”€ */
.admin-corner-btn{position:fixed;top:12px;right:12px;z-index:50;width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:.2;transition:opacity .3s;font-size:11px;color:rgba(255,255,255,.3)}
.admin-corner-btn:hover,.admin-corner-btn:active{opacity:.7}

/* â”€â”€ í™ˆ í•˜ë‹¨ ë¡œê³  ì˜ì—­ â”€â”€ */
.home-logo-area{display:flex;flex-direction:column;align-items:center;gap:8px;padding:20px 0 10px;opacity:.7}
.home-logo-area img{max-height:50px;max-width:200px;object-fit:contain}
.home-logo-area .logo-text{font-size:11px;color:var(--text-dim);letter-spacing:1px}

@media(max-width:360px){.mission-grid{gap:10px}.mission-card{min-height:140px;padding:16px 10px}.page{padding:16px}}
@media(min-width:768px){.page{max-width:600px;margin:0 auto}.mission-grid{grid-template-columns:repeat(3,1fr)}}
@media print{body{background:#fff!important}#bg-layer,#bg-overlay,#deco-layer,.admin-corner-btn{display:none!important}}
</style>
</head>
<body>
<div id="bg-layer"></div><div id="bg-overlay"></div><div id="deco-layer"></div>

<!-- ê´€ë¦¬ì ë²„íŠ¼: ìš°ì¸¡ ìƒë‹¨ ì´ˆì†Œí˜• ì•„ì´ì½˜ -->
<div class="admin-corner-btn" id="admin-corner" onclick="showAdminLogin()" title="ê´€ë¦¬ì">âš™</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì¶•ì œ ë³´ë¬¼ì°¾ê¸° ëŒ€ëª¨í—˜ v4 â€” ê´€ë¦¬ì ë²„íŠ¼ & ë¡œê³ 
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var db=null,useFirebase=false;
var DEFAULT_CONFIG={festivalName:"ë³´ë¬¼ì°¾ê¸° ëŒ€ëª¨í—˜",festivalSub:"ìˆ¨ê²¨ì§„ ë³´ë¬¼ì„ ëª¨ë‘ ì°¾ì•„ë¼!",festivalIcon:"ğŸ—ºï¸",adminPw:"1234",theme:"treasure",
customColors:{primary:"#FFD700",secondary:"#FF6B6B",accent:"#6C5CE7",bgStart:"#1a1a2e",bgMid:"#16213e",bgEnd:"#0f3460"},
colorOverride:{enabled:false,primary:"",secondary:"",accent:"",bgStart:"",bgMid:"",bgEnd:""},
fontDisplay:"'Black Han Sans'",fontBody:"'Noto Sans KR'",
titleColor:"",textColor:"",btnTextColor:"",
bgImage:"",bgOverlay:"rgba(0,0,0,0.3)",bgBlend:"normal",bgFit:"cover",bgFixed:true,
decorations:[],
logoImage:"",logoImage2:"",logoText:"ëŒ€ì „ê´‘ì—­ì‹œ Â· ëŒ€ì „ê´€ê´‘ê³µì‚¬",
missionCount:4,missions:[
{name:"ì²« ë²ˆì§¸ ë³´ë¬¼",hint:"ê´€ë¦¬ìê°€ íŒíŠ¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”",emoji:"ğŸ—ï¸",code:""},
{name:"ë‘ ë²ˆì§¸ ë³´ë¬¼",hint:"ê´€ë¦¬ìê°€ íŒíŠ¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”",emoji:"ğŸ’",code:""},
{name:"ì„¸ ë²ˆì§¸ ë³´ë¬¼",hint:"ê´€ë¦¬ìê°€ íŒíŠ¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”",emoji:"ğŸ‘‘",code:""},
{name:"ë„¤ ë²ˆì§¸ ë³´ë¬¼",hint:"ê´€ë¦¬ìê°€ íŒíŠ¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”",emoji:"ğŸ†",code:""}],
rewardTitle:"ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰",rewardDesc:"ëª¨ë“  ë³´ë¬¼ì„ ì°¾ìœ¼ë©´ íŠ¹ë³„í•œ ì„ ë¬¼ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”!\nê´€ë¦¬ìì—ê²Œ ì™„ë£Œ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš”!"};

var THEMES={
treasure:{name:"ğŸ´â€â˜ ï¸ ë³´ë¬¼ì„¬",primary:"#FFD700",secondary:"#FF6B6B",accent:"#6C5CE7",bgStart:"#1a1a2e",bgMid:"#16213e",bgEnd:"#0f3460"},
space:{name:"ğŸš€ ìš°ì£¼íƒí—˜",primary:"#A78BFA",secondary:"#818CF8",accent:"#F472B6",bgStart:"#0f0524",bgMid:"#1a0a3e",bgEnd:"#2d1b69"},
forest:{name:"ğŸŒ² ìˆ²ì†ëª¨í—˜",primary:"#A3E635",secondary:"#4ADE80",accent:"#FB923C",bgStart:"#0a1f0a",bgMid:"#14351d",bgEnd:"#1a4731"},
ocean:{name:"ğŸŒŠ ë°”ë‹¤ì¶•ì œ",primary:"#22D3EE",secondary:"#38BDF8",accent:"#F9A8D4",bgStart:"#042f3b",bgMid:"#064e6e",bgEnd:"#0369a1"},
circus:{name:"ğŸª ì„œì»¤ìŠ¤",primary:"#F97316",secondary:"#EF4444",accent:"#FACC15",bgStart:"#2a0a0a",bgMid:"#4a1515",bgEnd:"#5c1a1a"},
spring:{name:"ğŸŒ¸ ë´„ê½ƒì¶•ì œ",primary:"#F9A8D4",secondary:"#F472B6",accent:"#A78BFA",bgStart:"#2d1029",bgMid:"#3d1a3a",bgEnd:"#4a1f4a"},
halloween:{name:"ğŸƒ í• ë¡œìœˆ",primary:"#FB923C",secondary:"#F97316",accent:"#A855F7",bgStart:"#1a0f00",bgMid:"#2d1a00",bgEnd:"#0d0d0d"},
winter:{name:"â„ï¸ ê²¨ìš¸ì™•êµ­",primary:"#BAE6FD",secondary:"#7DD3FC",accent:"#C4B5FD",bgStart:"#0c1929",bgMid:"#1e3a5f",bgEnd:"#172554"},
neon:{name:"ğŸ’œ ë„¤ì˜¨ì‹œí‹°",primary:"#E879F9",secondary:"#22D3EE",accent:"#A3E635",bgStart:"#09090b",bgMid:"#18181b",bgEnd:"#1c1026"},
retro:{name:"ğŸ•¹ï¸ ë ˆíŠ¸ë¡œ",primary:"#FFE66D",secondary:"#FF6B6B",accent:"#4ECDC4",bgStart:"#2C3E50",bgMid:"#34495E",bgEnd:"#1a252f"},
sunset:{name:"ğŸŒ… ì„ì–‘",primary:"#FF9A76",secondary:"#FECA57",accent:"#FF6348",bgStart:"#2d1b2e",bgMid:"#5c2d3e",bgEnd:"#1a0a1e"},
candy:{name:"ğŸ­ ìº”ë””íŒ",primary:"#FF78CB",secondary:"#FFE156",accent:"#78E0FF",bgStart:"#1f0a2e",bgMid:"#2e0a3e",bgEnd:"#3e0a4e"},
custom:{name:"ğŸ¨ ì»¤ìŠ¤í…€",primary:"#FFD700",secondary:"#FF6B6B",accent:"#6C5CE7",bgStart:"#1a1a2e",bgMid:"#16213e",bgEnd:"#0f3460"}
};

var FONT_DISPLAY_OPTIONS=[
{cat:"ì„íŒ©íŠ¸",fonts:[
{v:"'Black Han Sans'",l:"ë¸”ë™í•œì‚°ìŠ¤",s:"ë‘êº¼ìš´ ê³ ë”•ì²´"},
{v:"'Gasoek One'",l:"ê°€ì†ì›",s:"êµµì€ ì œëª©ì²´"},
{v:"'Bagel Fat One'",l:"ë² ì´ê¸€íŒ»ì›",s:"ë‘¥ê·¼ íŒì²´"},
{v:"'Kirang Haerang'",l:"ê¸°ë‘í•´ë‘",s:"ê°œì„± ê°•í•œ ë¶“ì²´"},
{v:"'Black And White Picture'",l:"í‘ë°±ì‚¬ì§„",s:"ë…íŠ¹í•œ ì¥ì‹ì²´"}
]},
{cat:"ê·€ì—¬ìš´",fonts:[
{v:"'Jua'",l:"ì£¼ì•„",s:"ë™ê¸€ë™ê¸€ ê·€ì—¬ìš´ì²´"},
{v:"'Gamja Flower'",l:"ê°ìê½ƒ",s:"ì†ê¸€ì”¨ ê·€ì—¬ìš´ì²´"},
{v:"'Hi Melody'",l:"í•˜ì´ë©œë¡œë””",s:"ë°ê³  ê²½ì¾Œí•œ"},
{v:"'Cute Font'",l:"ííŠ¸í°íŠ¸",s:"ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ëŠë‚Œ"},
{v:"'Dongle'",l:"ë™ê¸€",s:"ê°€ë²¼ìš´ ë‘¥ê·¼ì²´"}
]},
{cat:"ê°ì„±/ì†ê¸€ì”¨",fonts:[
{v:"'Dokdo'",l:"ë…ë„",s:"í˜ ìˆëŠ” ë¶“ê¸€ì”¨"},
{v:"'East Sea Dokdo'",l:"ë™í•´ë…ë„",s:"ììœ ë¡œìš´ ë¶“í„°ì¹˜"},
{v:"'Nanum Pen Script'",l:"ë‚˜ëˆ”íœ",s:"íœìœ¼ë¡œ ì“´ ëŠë‚Œ"},
{v:"'Nanum Brush Script'",l:"ë‚˜ëˆ”ë¶“",s:"ë¶“ìœ¼ë¡œ ì“´ ëŠë‚Œ"},
{v:"'Yeon Sung'",l:"ì—°ì„±",s:"ë¶€ë“œëŸ¬ìš´ ì†ê¸€ì”¨"},
{v:"'Poor Story'",l:"í‘¸ì–´ìŠ¤í† ë¦¬",s:"ë™í™” ê°™ì€ ëŠë‚Œ"},
{v:"'Single Day'",l:"ì‹±ê¸€ë°ì´",s:"ì‹¬í”Œí•œ ì†ê¸€ì”¨"},
{v:"'Stylish'",l:"ìŠ¤íƒ€ì¼ë¦¬ì‰¬",s:"ì„¸ë ¨ëœ ì†ê¸€ì”¨"}
]},
{cat:"ê¹”ë”í•œ/ëª¨ë˜",fonts:[
{v:"'Do Hyeon'",l:"ë„í˜„",s:"ë‘¥ê·¼ ê¹”ë”ì²´"},
{v:"'Gugi'",l:"êµ¬ê¸°",s:"ë…íŠ¹í•œ ëª¨ë˜ì²´"},
{v:"'Orbit'",l:"ì˜¤ë¥´ë¹—",s:"ë¯¸ë˜ì  ëŠë‚Œ"},
{v:"'Sunflower'",l:"í•´ë°”ë¼ê¸°",s:"ë°ê³  ê¹¨ë—í•œ"},
{v:"'Gothic A1'",l:"ê³ ë”•A1",s:"ê¸°ë³¸ ê¹”ë”í•œ ê³ ë”•"},
{v:"'Gowun Dodum'",l:"ê³ ìš´ë‹ì›€",s:"ë¶€ë“œëŸ¬ìš´ ë‹ì›€"},
{v:"'IBM Plex Sans KR'",l:"IBMí”Œë ‰ìŠ¤",s:"ì „ë¬¸ì ì¸ ì‚°ìŠ¤"},
{v:"'Nanum Gothic'",l:"ë‚˜ëˆ”ê³ ë”•",s:"ëŒ€í‘œì  í•œê¸€ ê³ ë”•"}
]},
{cat:"ì „í†µ/ëª…ì¡°",fonts:[
{v:"'Song Myung'",l:"ì†¡ëª…",s:"ì „í†µ ëª…ì¡°ì²´"},
{v:"'Noto Serif KR'",l:"ë…¸í† ì„¸ë¦¬í”„",s:"ê²©ì¡° ìˆëŠ” ì„¸ë¦¬í”„"},
{v:"'Hahmlet'",l:"í•¨ë ›",s:"ì„¸ë ¨ëœ ëª…ì¡°"},
{v:"'Gowun Batang'",l:"ê³ ìš´ë°”íƒ•",s:"ë¶€ë“œëŸ¬ìš´ ë°”íƒ•"},
{v:"'Nanum Myeongjo'",l:"ë‚˜ëˆ”ëª…ì¡°",s:"í´ë˜ì‹ ëª…ì¡°"}
]}
];

var FONT_BODY_OPTIONS=[
{v:"'Noto Sans KR'",l:"ë…¸í† ì‚°ìŠ¤ (ê¸°ë³¸)"},{v:"'Gothic A1'",l:"ê³ ë”•A1"},{v:"'Jua'",l:"ì£¼ì•„"},
{v:"'Gamja Flower'",l:"ê°ìê½ƒ"},{v:"'Sunflower'",l:"í•´ë°”ë¼ê¸°"},{v:"'Poor Story'",l:"í‘¸ì–´ìŠ¤í† ë¦¬"},
{v:"'Orbit'",l:"ì˜¤ë¥´ë¹—"},{v:"'Dongle'",l:"ë™ê¸€"},{v:"'Gowun Dodum'",l:"ê³ ìš´ë‹ì›€"},
{v:"'IBM Plex Sans KR'",l:"IBMí”Œë ‰ìŠ¤"},{v:"'Nanum Gothic'",l:"ë‚˜ëˆ”ê³ ë”•"},{v:"'Gowun Batang'",l:"ê³ ìš´ë°”íƒ•"},
{v:"'Noto Serif KR'",l:"ë…¸í† ì„¸ë¦¬í”„"},{v:"'Hahmlet'",l:"í•¨ë ›"},{v:"'Nanum Myeongjo'",l:"ë‚˜ëˆ”ëª…ì¡°"}
];

var DECO_ANIMS=[{v:"none",l:"ì—†ìŒ"},{v:"deco-float",l:"ë‘¥ë‘¥"},{v:"deco-spin",l:"íšŒì „"},{v:"deco-pulse",l:"ê¹œë¹¡"},{v:"deco-swing",l:"í”ë“¤í”ë“¤"},{v:"deco-bounce",l:"í†µí†µ"},{v:"deco-fadeloop",l:"í˜ì´ë“œ"}];
var EMOJI_LIST=["ğŸ—ï¸","ğŸ’","ğŸ‘‘","ğŸ†","â­","ğŸ¯","ğŸ”®","ğŸª","ğŸŒŸ","ğŸ","ğŸ¦„","ğŸ‰","ğŸµ","ğŸ€","ğŸ’«","ğŸ”¥","â„ï¸","ğŸŒˆ","ğŸ­","ğŸ¨"];

var config=null,player=null,completed=[],scanTarget=0,cameraStream=null,scanInterval=null;

function generateCode(){var c="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",s="HUNT-";for(var i=0;i<4;i++)s+=c[Math.floor(Math.random()*c.length)];return s}
function generateQRDataURL(t){if(typeof qrcode==="undefined")return"";var q=qrcode(0,"M");q.addData(t);q.make();var m=q.getModuleCount(),cs=Math.floor(400/m),mg=40,sz=m*cs+mg*2,cv=document.createElement("canvas");cv.width=sz;cv.height=sz;var ctx=cv.getContext("2d");ctx.fillStyle="#FFF";ctx.fillRect(0,0,sz,sz);ctx.fillStyle="#000";for(var r=0;r<m;r++)for(var c=0;c<m;c++)if(q.isDark(r,c))ctx.fillRect(mg+c*cs,mg+r*cs,cs,cs);return cv.toDataURL("image/png")}
function scanQRFromImage(img){return new Promise(function(res){if(typeof jsQR==="undefined"){res(null);return}try{var cv=document.createElement("canvas"),ctx=cv.getContext("2d"),w=img.naturalWidth||img.width,h=img.naturalHeight||img.height;if(!w||!h){res(null);return}var sc=Math.min(1000/Math.max(w,h),1);cv.width=Math.round(w*sc);cv.height=Math.round(h*sc);ctx.drawImage(img,0,0,cv.width,cv.height);var id=ctx.getImageData(0,0,cv.width,cv.height),code=jsQR(id.data,cv.width,cv.height,{inversionAttempts:"attemptBoth"});if(code&&code.data){res(code.data);return}ctx.drawImage(img,0,0,cv.width,cv.height);var d2=ctx.getImageData(0,0,cv.width,cv.height),dd=d2.data;for(var i=0;i<dd.length;i+=4)for(var c=0;c<3;c++){var v=((dd[i+c]/255-.5)*1.8+.5)*255;dd[i+c]=Math.max(0,Math.min(255,v))|0}ctx.putImageData(d2,0,0);var id2=ctx.getImageData(0,0,cv.width,cv.height),c2=jsQR(id2.data,cv.width,cv.height,{inversionAttempts:"attemptBoth"});res(c2&&c2.data?c2.data:null)}catch(e){res(null)}})}
function hexToRgb(h){if(!h||h[0]!=="#")return"255,255,255";return parseInt(h.slice(1,3),16)+","+parseInt(h.slice(3,5),16)+","+parseInt(h.slice(5,7),16)}
function toast(m,t){var e=document.createElement("div");e.className="toast toast-"+(t||"ok");e.textContent=m;document.body.appendChild(e);setTimeout(function(){e.style.opacity="0";e.style.transition="opacity .3s";setTimeout(function(){e.remove()},300)},2500)}
function makeConfetti(c){var cols=["#FF6B6B","#4ECDC4","#FFD93D","#6C5CE7","#FF8A5B","#EA4C89"],h="";for(var i=0;i<40;i++)h+='<div class="confetti-piece" style="left:'+Math.random()*100+"%;width:"+(8+Math.random()*8)+"px;height:"+(8+Math.random()*8)+"px;background:"+cols[i%6]+";border-radius:"+(Math.random()>.5?"50%":"2px")+";animation-duration:"+(2+Math.random()*3)+"s;animation-delay:"+Math.random()*2+'s"></div>';c.innerHTML=h}
function makeSparkles(c,n){var h="";for(var i=0;i<(n||6);i++)h+='<div class="sparkle-piece" style="left:'+(10+Math.random()*80)+"%;top:"+(10+Math.random()*80)+"%;font-size:"+(12+Math.random()*16)+"px;animation-duration:"+(1.5+Math.random()*2)+"s;animation-delay:"+Math.random()*3+'s">âœ¨</div>';c.innerHTML=h}
function formatDate(d){if(!d)return"";var dt=typeof d==="string"?new Date(d):d.toDate?d.toDate():new Date(d);return dt.getFullYear()+"."+(""+(dt.getMonth()+1)).padStart(2,"0")+"."+(""+(dt.getDate())).padStart(2,"0")+" "+(""+(dt.getHours())).padStart(2,"0")+":"+(""+(dt.getMinutes())).padStart(2,"0")}
function fileToBase64(file,maxKB){return new Promise(function(res){var r=new FileReader();r.onload=function(e){if(!maxKB||file.size<=maxKB*1024){res(e.target.result);return}var img=new Image();img.onload=function(){var cv=document.createElement("canvas"),ratio=Math.sqrt((maxKB*1024)/file.size);cv.width=Math.round(img.width*ratio);cv.height=Math.round(img.height*ratio);cv.getContext("2d").drawImage(img,0,0,cv.width,cv.height);res(cv.toDataURL("image/png",0.8))};img.src=e.target.result};r.readAsDataURL(file)})}

/* â•â•â• THEME ENGINE â•â•â• */
function getEffectiveColors(){
  var base=config.theme==="custom"?config.customColors:(THEMES[config.theme]||THEMES.treasure);
  var ov=config.colorOverride||{};
  if(!ov.enabled) return base;
  return {
    primary:ov.primary||base.primary,secondary:ov.secondary||base.secondary,
    accent:ov.accent||base.accent,bgStart:ov.bgStart||base.bgStart,
    bgMid:ov.bgMid||base.bgMid,bgEnd:ov.bgEnd||base.bgEnd
  };
}
function applyTheme(cfg){cfg=cfg||config;if(!cfg)return;
  var t=getEffectiveColors();
  var r=document.documentElement.style;
  r.setProperty("--primary",t.primary);r.setProperty("--primary-rgb",hexToRgb(t.primary));
  r.setProperty("--secondary",t.secondary);r.setProperty("--secondary-rgb",hexToRgb(t.secondary));
  r.setProperty("--accent",t.accent||"#6C5CE7");r.setProperty("--accent-rgb",hexToRgb(t.accent||"#6C5CE7"));
  r.setProperty("--bg-start",t.bgStart);r.setProperty("--bg-mid",t.bgMid);r.setProperty("--bg-end",t.bgEnd);
  if(cfg.fontDisplay)r.setProperty("--font-display",cfg.fontDisplay+",sans-serif");
  if(cfg.fontBody)r.setProperty("--font-body",cfg.fontBody+",sans-serif");
  if(cfg.btnTextColor)r.setProperty("--btn-text",cfg.btnTextColor);else r.setProperty("--btn-text","#1a1a2e");
  document.querySelectorAll(".gold").forEach(function(el){if(cfg.titleColor){el.classList.add("title-solid");el.style.color=cfg.titleColor}else{el.classList.remove("title-solid");el.style.color=""}});
  if(cfg.textColor){r.setProperty("--text",cfg.textColor);r.setProperty("--text-muted",cfg.textColor+"99");r.setProperty("--text-dim",cfg.textColor+"55")}
  else{r.setProperty("--text","#fff");r.setProperty("--text-muted","rgba(255,255,255,0.6)");r.setProperty("--text-dim","rgba(255,255,255,0.35)")}
  var bgL=document.getElementById("bg-layer"),bgO=document.getElementById("bg-overlay");
  if(cfg.bgImage){bgL.style.backgroundImage="url("+cfg.bgImage+")";bgL.style.opacity="1";
    bgL.style.backgroundSize=cfg.bgFit||"cover";bgL.style.backgroundAttachment=cfg.bgFixed?"fixed":"scroll";
    bgL.style.mixBlendMode=cfg.bgBlend||"normal";
    bgO.style.background=cfg.bgOverlay||"rgba(0,0,0,0.3)";document.body.style.background="transparent"}
  else{bgL.style.backgroundImage="none";bgL.style.opacity="0";bgO.style.background="none";
    document.body.style.background="linear-gradient(135deg,"+t.bgStart+","+t.bgMid+","+t.bgEnd+")"}
  renderDecorations(cfg.decorations||[]);document.title=cfg.festivalName||"ì¶•ì œ ë³´ë¬¼ì°¾ê¸°"}

function renderDecorations(ds){var l=document.getElementById("deco-layer");l.innerHTML="";if(!ds||!ds.length)return;
  ds.forEach(function(d){var img=document.createElement("img");img.src=d.data;img.className="deco-img "+(d.anim||"");
    var sz=d.size||15;img.style.width=sz+"vmin";img.style.height="auto";
    var op=d.opacity!=null?d.opacity:0.7;img.style.opacity=op;img.style.setProperty("--deco-op",op);
    var x=d.x!=null?d.x:10,y=d.y!=null?d.y:10;
    img.style.left=x+"%";img.style.top=y+"%";
    if(d.rotate)img.style.transform="rotate("+d.rotate+"deg)";
    l.appendChild(img)})}

function getMissionColor(i){var c=["--mission-1","--mission-2","--mission-3","--mission-4","--mission-5","--mission-6","--mission-7","--mission-8","--mission-9","--mission-10"];return getComputedStyle(document.documentElement).getPropertyValue(c[i%10]).trim()}

/* â•â•â• STORAGE â•â•â• */
function saveConfigLocal(){try{
  var c=JSON.parse(JSON.stringify(config));
  if(c.bgImage&&c.bgImage.length>500000){localStorage.setItem("fh_bg",c.bgImage);c.bgImage="__stored__"}
  if(c.logoImage&&c.logoImage.length>200000){localStorage.setItem("fh_logo1",c.logoImage);c.logoImage="__logo1__"}
  if(c.logoImage2&&c.logoImage2.length>200000){localStorage.setItem("fh_logo2",c.logoImage2);c.logoImage2="__logo2__"}
  if(c.decorations)c.decorations.forEach(function(d,i){if(d.data&&d.data.length>200000){localStorage.setItem("fh_deco_"+i,d.data);d.data="__stored_"+i+"__"}});
  localStorage.setItem("fh_config",JSON.stringify(c))}catch(e){console.error("Config save error:",e)}}
function loadConfigLocal(){try{var raw=localStorage.getItem("fh_config");if(!raw)return null;var c=JSON.parse(raw);
  if(c.bgImage==="__stored__"){var bg=localStorage.getItem("fh_bg");c.bgImage=bg||""}
  if(c.logoImage==="__logo1__"){c.logoImage=localStorage.getItem("fh_logo1")||""}
  if(c.logoImage2==="__logo2__"){c.logoImage2=localStorage.getItem("fh_logo2")||""}
  if(c.decorations)c.decorations.forEach(function(d,i){if(d.data&&d.data.indexOf("__stored_")===0){var dd=localStorage.getItem("fh_deco_"+i);d.data=dd||""}});
  return c}catch(e){return null}}
function savePlayerLocal(){localStorage.setItem("fh_player",JSON.stringify(player))}
async function saveConfigFB(){if(!useFirebase||!db)return;try{var c=JSON.parse(JSON.stringify(config));c.bgImage="";c.logoImage="";c.logoImage2="";c.decorations=(c.decorations||[]).map(function(d){return Object.assign({},d,{data:""})});await db.collection("settings").doc("config").set(c)}catch(e){}}
async function loadConfigFB(){if(!useFirebase||!db)return null;try{var doc=await db.collection("settings").doc("config").get();return doc.exists?doc.data():null}catch(e){return null}}
async function saveParticipantFB(p){if(!useFirebase||!db)return;try{await db.collection("participants").doc(p.phone+"_"+p.birthdate).set(p,{merge:true})}catch(e){}}
async function findParticipantFB(ph,bi){if(!useFirebase||!db)return null;try{var d=await db.collection("participants").doc(ph+"_"+bi).get();return d.exists?d.data():null}catch(e){return null}}
async function getAllParticipantsFB(){if(!useFirebase||!db)return[];try{var s=await db.collection("participants").get(),a=[];s.forEach(function(d){a.push(d.data())});return a}catch(e){return[]}}
async function saveConfig(){saveConfigLocal();if(useFirebase)await saveConfigFB()}
async function loadConfig(){var local=loadConfigLocal();if(useFirebase){var fb=await loadConfigFB();if(fb){if(local){fb.bgImage=local.bgImage||"";fb.logoImage=local.logoImage||"";fb.logoImage2=local.logoImage2||"";fb.decorations=(fb.decorations||[]).map(function(d,i){var ld=(local.decorations||[])[i];return Object.assign({},d,{data:ld?ld.data:""})})};config=fb;saveConfigLocal();return}}
  config=local||JSON.parse(JSON.stringify(DEFAULT_CONFIG));
  if(!config.colorOverride)config.colorOverride={enabled:false,primary:"",secondary:"",accent:"",bgStart:"",bgMid:"",bgEnd:""};
  if(config.logoText===undefined)config.logoText="ëŒ€ì „ê´‘ì—­ì‹œ Â· ëŒ€ì „ê´€ê´‘ê³µì‚¬";
  if(config.logoImage===undefined)config.logoImage="";
  if(config.logoImage2===undefined)config.logoImage2="";
  for(var i=0;i<config.missions.length;i++){if(!config.missions[i].code)config.missions[i].code=generateCode()}saveConfigLocal()}
async function saveParticipant(p){var pts=JSON.parse(localStorage.getItem("fh_participants")||"[]"),found=false;
  for(var i=0;i<pts.length;i++){if(pts[i].phone===p.phone&&pts[i].birthdate===p.birthdate){pts[i]=p;found=true;break}}
  if(!found)pts.push(p);localStorage.setItem("fh_participants",JSON.stringify(pts));if(useFirebase)await saveParticipantFB(p)}
async function getParticipants(){if(useFirebase){var fb=await getAllParticipantsFB();if(fb.length)return fb}return JSON.parse(localStorage.getItem("fh_participants")||"[]")}

function initFirebase(){var s=localStorage.getItem("fh_firebase_config");if(!s)return;try{firebase.initializeApp(JSON.parse(s));db=firebase.firestore();useFirebase=true}catch(e){useFirebase=false}}

/* â•â•â• NAVIGATION â•â•â• */
function show(id){document.querySelectorAll(".page").forEach(function(p){p.classList.remove("active")});var el=document.getElementById(id);if(el)el.classList.add("active");window.scrollTo(0,0);
  /* ê´€ë¦¬ì í˜ì´ì§€ì—ì„œëŠ” ì½”ë„ˆ ë²„íŠ¼ ìˆ¨ê¹€ */
  var cb=document.getElementById("admin-corner");
  if(cb){cb.style.display=(id==="pg-admin"||id==="pg-admin-login")?"none":"flex"}}
function showHome(){show("pg-home");makeSparkles(document.getElementById("home-sparkles"),10);document.getElementById("home-icon").textContent=config.festivalIcon||"ğŸ—ºï¸";document.getElementById("home-title").textContent=config.festivalName;document.getElementById("home-sub").textContent=config.festivalSub;
  /* ë¡œê³  ë Œë”ë§ */
  renderHomeLogo()}

function renderHomeLogo(){
  var area=document.getElementById("home-logo-area");if(!area)return;var h="";
  if(config.logoImage)h+='<img src="'+config.logoImage+'" alt="ë¡œê³ ">';
  if(config.logoImage2)h+='<img src="'+config.logoImage2+'" alt="ë¡œê³ 2">';
  if(config.logoText)h+='<div class="logo-text">'+config.logoText+'</div>';
  area.innerHTML=h;
  area.style.display=(config.logoImage||config.logoImage2||config.logoText)?"flex":"none"}

/* â•â•â• REGISTER / LOGIN â•â•â• */
function showRegister(){show("pg-register");document.getElementById("reg-name").value="";document.getElementById("reg-phone").value="";document.getElementById("reg-birth").value="";document.getElementById("reg-err").style.display="none"}
async function doRegister(){var name=document.getElementById("reg-name").value.trim(),phone=document.getElementById("reg-phone").value.replace(/[^0-9]/g,""),birth=document.getElementById("reg-birth").value.replace(/[^0-9]/g,""),errEl=document.getElementById("reg-err");
  if(!name){errEl.textContent="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!";errEl.style.display="block";return}
  if(!/^\d{10,11}$/.test(phone)){errEl.textContent="ì˜¬ë°”ë¥¸ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!";errEl.style.display="block";return}
  if(!/^\d{6}$/.test(birth)){errEl.textContent="ìƒë…„ì›”ì¼ ì• 6ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!";errEl.style.display="block";return}
  if(useFirebase){var ex=await findParticipantFB(phone,birth);if(ex){if(ex.name!==name){errEl.textContent="ì´ë¯¸ ë“±ë¡ëœ ì—°ë½ì²˜ì…ë‹ˆë‹¤.";errEl.style.display="block";return}player=ex;completed=ex.completedMissions||[];savePlayerLocal();showMissions();return}}
  else{var pts=JSON.parse(localStorage.getItem("fh_participants")||"[]");for(var i=0;i<pts.length;i++){if(pts[i].phone===phone&&pts[i].birthdate===birth){if(pts[i].name!==name){errEl.textContent="ì´ë¯¸ ë“±ë¡ëœ ì—°ë½ì²˜ì…ë‹ˆë‹¤.";errEl.style.display="block";return}player=pts[i];completed=pts[i].completedMissions||[];savePlayerLocal();showMissions();return}}}
  player={name:name,phone:phone,birthdate:birth,completedMissions:[],registeredAt:new Date().toISOString()};completed=[];savePlayerLocal();await saveParticipant(player);showMissions()}
function showLogin(){show("pg-login");document.getElementById("login-phone").value="";document.getElementById("login-birth").value="";document.getElementById("login-err").style.display="none"}
async function doLogin(){var phone=document.getElementById("login-phone").value.replace(/[^0-9]/g,""),birth=document.getElementById("login-birth").value.replace(/[^0-9]/g,""),errEl=document.getElementById("login-err");
  if(!/^\d{10,11}$/.test(phone)||!/^\d{6}$/.test(birth)){errEl.textContent="ì •ë³´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”!";errEl.style.display="block";return}
  var found=null;if(useFirebase)found=await findParticipantFB(phone,birth);
  else{var pts=JSON.parse(localStorage.getItem("fh_participants")||"[]");for(var i=0;i<pts.length;i++){if(pts[i].phone===phone&&pts[i].birthdate===birth){found=pts[i];break}}}
  if(!found){errEl.textContent="ë“±ë¡ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”!";errEl.style.display="block";return}
  player=found;completed=found.completedMissions||[];savePlayerLocal();showMissions()}

/* â•â•â• MISSIONS â•â•â• */
function showMissions(){show("pg-missions");var mc=config.missionCount||config.missions.length;document.getElementById("m-player-name").textContent=player?player.name:"";document.getElementById("m-festival").textContent=config.festivalName;
  var dots=document.getElementById("m-dots"),h="";for(var i=0;i<mc;i++){var dn=completed.indexOf(i)>=0;h+='<div class="progress-dot '+(dn?"completed":"pending")+'">'+(dn?"âœ“":(config.missions[i]?config.missions[i].emoji:"â­"))+"</div>"}dots.innerHTML=h;document.getElementById("m-count").textContent=completed.length+" / "+mc+" ì™„ë£Œ";
  var grid=document.getElementById("m-grid");h="";for(var i=0;i<mc;i++){var m=config.missions[i];if(!m)continue;var dn=completed.indexOf(i)>=0,col=getMissionColor(i);h+='<div class="mission-card '+(dn?"done":"")+'" style="background:'+(dn?"rgba(76,175,80,.12)":"linear-gradient(135deg,"+col+"18,"+col+"08)")+";border:"+(dn?"2px solid rgba(76,175,80,.35)":"2px solid "+col+"33")+'" onclick="'+(dn?"":"openScan("+i+")")+'">';if(dn)h+='<div class="done-badge">âœ“</div>';h+='<div style="font-size:38px;margin-bottom:8px;'+(dn?"filter:grayscale(.3)":"")+'">'+m.emoji+'</div><h3 style="font-size:14px;font-weight:900;margin-bottom:4px;color:'+(dn?"rgba(255,255,255,.45)":"var(--text)")+'">'+m.name+'</h3><p style="font-size:11px;color:'+(dn?"rgba(76,175,80,.7)":"var(--text-dim)")+';font-weight:600">'+(dn?"ì™„ë£Œ!":"íƒ­í•˜ì—¬ ë„ì „")+"</p></div>"}grid.innerHTML=h;document.getElementById("m-complete-btn").style.display=completed.length>=mc?"block":"none"}

/* â•â•â• SCAN â•â•â• */
function openScan(i){scanTarget=i;showScanInfo()}
function showScanInfo(){show("pg-scan-info");var m=config.missions[scanTarget];document.getElementById("si-emoji").textContent=m.emoji;document.getElementById("si-name").textContent=m.name;document.getElementById("si-name").style.color=getMissionColor(scanTarget);document.getElementById("si-hint").textContent=m.hint}
function showScanCamera(){show("pg-scan-cam");stopCamera();document.getElementById("sc-main").style.display="flex";document.getElementById("sc-live").style.display="none";document.getElementById("sc-photo-result").style.display="none";var can=!!(window.isSecureContext&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);document.getElementById("sc-btn-stream").style.display=can?"block":"none";document.getElementById("sc-env-msg").style.display=can?"none":"block"}
function tryLiveCamera(){document.getElementById("sc-main").style.display="none";document.getElementById("sc-live").style.display="flex";document.getElementById("sc-live-status").textContent="ì¹´ë©”ë¼ ì—°ê²° ì¤‘...";navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:640},height:{ideal:480}}}).then(function(stream){cameraStream=stream;var v=document.getElementById("sc-video");v.srcObject=stream;v.setAttribute("playsinline","");v.setAttribute("muted","");v.setAttribute("autoplay","");v.play().catch(function(){});document.getElementById("sc-live-status").textContent="ğŸ“· QRì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë¹„ì¶°ì£¼ì„¸ìš”!";var sCv=document.createElement("canvas"),sCtx=sCv.getContext("2d"),scanning=false;scanInterval=setInterval(function(){if(!v||v.readyState<2||scanning)return;scanning=true;sCv.width=v.videoWidth||320;sCv.height=v.videoHeight||240;sCtx.drawImage(v,0,0,sCv.width,sCv.height);if(typeof jsQR!=="undefined"){var id=sCtx.getImageData(0,0,sCv.width,sCv.height),code=jsQR(id.data,sCv.width,sCv.height,{inversionAttempts:"attemptBoth"});scanning=false;if(code&&code.data)handleScanResult(code.data)}else scanning=false},800)}).catch(function(){stopCamera();showScanCamera();document.getElementById("sc-btn-stream").style.display="none"})}
function triggerPhotoCapture(){document.getElementById("sc-file-input").click()}
function onPhotoCaptured(input){if(!input.files||!input.files[0])return;var file=input.files[0],reader=new FileReader();reader.onload=function(e){var img=new Image();img.onload=function(){document.getElementById("sc-main").style.display="none";document.getElementById("sc-live").style.display="none";document.getElementById("sc-photo-result").style.display="flex";document.getElementById("sc-photo-img").src=e.target.result;document.getElementById("sc-photo-status").innerHTML='<span class="scanning-spinner"></span>ë¶„ì„ ì¤‘...';document.getElementById("sc-photo-status").style.color="var(--primary)";document.getElementById("sc-photo-retry").style.display="none";scanQRFromImage(img).then(function(t){if(t)handleScanResult(t);else showPhotoFail()})};img.src=e.target.result};reader.readAsDataURL(file);input.value=""}
function handleScanResult(text){if(!text){showPhotoFail();return}var mc=config.missionCount||config.missions.length;for(var j=0;j<mc;j++){if(config.missions[j]&&text===config.missions[j].code){if(j===scanTarget){stopCamera();missionSuccess();return}var s=document.getElementById("sc-photo-status")||document.getElementById("sc-live-status");if(s){s.textContent="âš ï¸ ì´ê±´ '"+config.missions[j].name+"' QRì½”ë“œì˜ˆìš”!";s.style.color="var(--error)"}var r=document.getElementById("sc-photo-retry");if(r)r.style.display="flex";return}}var s=document.getElementById("sc-photo-status");if(s){s.textContent="ë³´ë¬¼ì°¾ê¸° QRì½”ë“œê°€ ì•„ë‹ˆì—ìš”!";s.style.color="var(--error)"}var r=document.getElementById("sc-photo-retry");if(r)r.style.display="flex"}
function showPhotoFail(){document.getElementById("sc-photo-status").innerHTML='<span style="font-size:36px;display:block;margin-bottom:10px">ğŸ˜¥</span>QRì½”ë“œ ì¸ì‹ ì‹¤íŒ¨<br><span style="font-size:12px;opacity:.5">ê°€ê¹Œì´, ì •ë©´ì—ì„œ ë‹¤ì‹œ ì°ì–´ì£¼ì„¸ìš”</span>';document.getElementById("sc-photo-status").style.color="rgba(255,255,255,.8)";document.getElementById("sc-photo-retry").style.display="flex"}
function stopCamera(){if(scanInterval){clearInterval(scanInterval);scanInterval=null}if(cameraStream){cameraStream.getTracks().forEach(function(t){t.stop()});cameraStream=null}var v=document.getElementById("sc-video");if(v)v.srcObject=null}
async function missionSuccess(){if(completed.indexOf(scanTarget)<0){completed.push(scanTarget);player.completedMissions=completed;player.lastMissionAt=new Date().toISOString();savePlayerLocal();await saveParticipant(player)}showSuccess()}

/* â•â•â• SUCCESS / COMPLETE â•â•â• */
function showSuccess(){show("pg-success");makeConfetti(document.getElementById("su-confetti"));var m=config.missions[scanTarget],mc=config.missionCount||config.missions.length;document.getElementById("su-mission").textContent=m.emoji+" "+m.name;document.getElementById("su-count").textContent=completed.length+" / "+mc+" ë³´ë¬¼ ë°œê²¬!";var dots=document.getElementById("su-dots"),h="";for(var i=0;i<mc;i++){var dn=completed.indexOf(i)>=0;h+='<div style="width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;'+(dn?"background:linear-gradient(135deg,#4CAF50,#2E7D32);border:2px solid #66BB6A":"background:rgba(255,255,255,.06);border:2px solid rgba(255,255,255,.1)")+'">'+(dn?"âœ“":(config.missions[i]?config.missions[i].emoji:"â­"))+"</div>"}dots.innerHTML=h;var btn=document.getElementById("su-btn");btn.textContent=completed.length>=mc?"ğŸ† ìµœì¢… ë³´ìƒ í™•ì¸!":"ğŸ—ºï¸ ë‹¤ìŒ ë³´ë¬¼ ì°¾ìœ¼ëŸ¬";btn.onclick=function(){completed.length>=mc?showComplete():showMissions()}}
function showComplete(){show("pg-complete");makeConfetti(document.getElementById("cp-confetti"));makeSparkles(document.getElementById("cp-sparkles"),12);document.getElementById("cp-reward-title").textContent=config.rewardTitle;document.getElementById("cp-reward-desc").textContent=config.rewardDesc;document.getElementById("cp-pname").textContent="ğŸ§‘ "+(player?player.name:"");document.getElementById("cp-time").textContent="â° "+formatDate(new Date());document.getElementById("cp-festival").textContent=config.festivalName}
function showRewards(){show("pg-rewards");document.getElementById("rw-title").textContent=config.rewardTitle;document.getElementById("rw-desc").textContent=config.rewardDesc;makeSparkles(document.getElementById("rw-sparkles"),6)}

/* â•â•â• ADMIN â•â•â• */
function showAdminLogin(){show("pg-admin-login");document.getElementById("al-pw").value="";document.getElementById("al-err").style.display="none"}
function doAdminLogin(){if(document.getElementById("al-pw").value===(config.adminPw||"1234"))showAdmin("basic");else document.getElementById("al-err").style.display="block"}
function showAdmin(tab){show("pg-admin");document.querySelectorAll(".admin-section").forEach(function(s){s.classList.remove("active")});document.querySelectorAll(".tab-btn").forEach(function(b){b.className="tab-btn inactive"});var s=document.getElementById("adm-"+tab);if(s)s.classList.add("active");var b=document.getElementById("tbn-"+tab);if(b)b.className="tab-btn active";
  if(tab==="basic")renderAdminBasic();if(tab==="theme")renderAdminTheme();if(tab==="missions")renderAdminMissions();if(tab==="rewards")renderAdminRewards();if(tab==="qrcodes")renderAdminQR();if(tab==="participants")renderAdminParticipants()}

/* â”€â”€ ê¸°ë³¸ì„¤ì • â”€â”€ */
function renderAdminBasic(){document.getElementById("ab-name").value=config.festivalName;document.getElementById("ab-sub").value=config.festivalSub;document.getElementById("ab-icon").value=config.festivalIcon;document.getElementById("ab-pw").value=config.adminPw;document.getElementById("ab-logo-text").value=config.logoText||"";
  /* ë¡œê³  ë¯¸ë¦¬ë³´ê¸° */
  var lp1=document.getElementById("ab-logo1-preview");
  if(config.logoImage)lp1.innerHTML='<img src="'+config.logoImage+'" class="upload-preview"><p style="font-size:11px;color:var(--text-dim);margin-top:6px">í´ë¦­í•˜ì—¬ ë³€ê²½ | <span style="color:var(--error);cursor:pointer" onclick="event.stopPropagation();removeLogo(1)">ì‚­ì œ</span></p>';
  else lp1.innerHTML='<div style="font-size:28px;margin-bottom:4px">ğŸ›ï¸</div><p style="font-size:12px;color:var(--text-muted)">ë¡œê³  1 ì—…ë¡œë“œ (PNG)</p><p style="font-size:10px;color:var(--text-dim)">ì˜ˆ: ëŒ€ì „ê´‘ì—­ì‹œ ë¡œê³ </p>';
  var lp2=document.getElementById("ab-logo2-preview");
  if(config.logoImage2)lp2.innerHTML='<img src="'+config.logoImage2+'" class="upload-preview"><p style="font-size:11px;color:var(--text-dim);margin-top:6px">í´ë¦­í•˜ì—¬ ë³€ê²½ | <span style="color:var(--error);cursor:pointer" onclick="event.stopPropagation();removeLogo(2)">ì‚­ì œ</span></p>';
  else lp2.innerHTML='<div style="font-size:28px;margin-bottom:4px">ğŸ¢</div><p style="font-size:12px;color:var(--text-muted)">ë¡œê³  2 ì—…ë¡œë“œ (PNG)</p><p style="font-size:10px;color:var(--text-dim)">ì˜ˆ: ëŒ€ì „ê´€ê´‘ê³µì‚¬ ë¡œê³ </p>';
  document.getElementById("ab-fb-status").innerHTML=useFirebase?'<span style="color:#4CAF50">âœ… Firebase ì—°ê²°ë¨</span>':'<span style="color:var(--text-dim)">âš ï¸ ë¡œì»¬ ëª¨ë“œ</span>'}
async function onLogoUpload(num,input){if(!input.files||!input.files[0])return;var b=await fileToBase64(input.files[0],200);if(num===1)config.logoImage=b;else config.logoImage2=b;renderAdminBasic();renderHomeLogo();input.value=""}
function removeLogo(num){if(num===1){config.logoImage="";localStorage.removeItem("fh_logo1")}else{config.logoImage2="";localStorage.removeItem("fh_logo2")}renderAdminBasic();renderHomeLogo()}
async function saveAdminBasic(){config.festivalName=document.getElementById("ab-name").value.trim()||"ë³´ë¬¼ì°¾ê¸°";config.festivalSub=document.getElementById("ab-sub").value.trim();config.festivalIcon=document.getElementById("ab-icon").value.trim()||"ğŸ—ºï¸";config.adminPw=document.getElementById("ab-pw").value||"1234";config.logoText=document.getElementById("ab-logo-text").value;await saveConfig();applyTheme();renderHomeLogo();toast("ì €ì¥ ì™„ë£Œ!")}
function saveFirebaseConfig(){var r=document.getElementById("ab-fb-json").value.trim();if(!r){toast("ì„¤ì •ì„ ì…ë ¥í•´ì£¼ì„¸ìš”","err");return}try{var o=JSON.parse(r);if(!o.apiKey){toast("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì„¤ì •","err");return}localStorage.setItem("fh_firebase_config",JSON.stringify(o));toast("ì €ì¥ ì™„ë£Œ! ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.");setTimeout(function(){location.reload()},1500)}catch(e){toast("JSON í˜•ì‹ ì˜¤ë¥˜","err")}}

/* â”€â”€ í…Œë§ˆ â”€â”€ */
function renderAdminTheme(){
  var grid=document.getElementById("at-grid"),h="";Object.keys(THEMES).forEach(function(k){var t=THEMES[k];h+='<div class="theme-card '+(config.theme===k?"selected":"")+'" onclick="selectTheme(\''+k+'\')" style="background:'+t.bgStart+'"><div class="preview" style="background:linear-gradient(135deg,'+t.primary+','+t.secondary+')"></div><span style="font-size:11px;font-weight:700;color:rgba(255,255,255,.8)">'+t.name+"</span></div>"});grid.innerHTML=h;
  var cd=document.getElementById("at-custom");cd.style.display=config.theme==="custom"?"block":"none";
  if(config.theme==="custom"){var cc=config.customColors;document.getElementById("cc-primary").value=cc.primary;document.getElementById("cc-secondary").value=cc.secondary;document.getElementById("cc-accent").value=cc.accent;document.getElementById("cc-bg-start").value=cc.bgStart;document.getElementById("cc-bg-mid").value=cc.bgMid;document.getElementById("cc-bg-end").value=cc.bgEnd}
  var ov=config.colorOverride||{};var ovOn=document.getElementById("at-ov-on");ovOn.className="toggle"+(ov.enabled?" on":"");
  document.getElementById("at-ov-panel").style.display=ov.enabled?"block":"none";
  if(ov.enabled){var ec=getEffectiveColors();document.getElementById("ov-primary").value=ov.primary||ec.primary;document.getElementById("ov-secondary").value=ov.secondary||ec.secondary;document.getElementById("ov-accent").value=ov.accent||ec.accent;document.getElementById("ov-bg-start").value=ov.bgStart||ec.bgStart;document.getElementById("ov-bg-mid").value=ov.bgMid||ec.bgMid;document.getElementById("ov-bg-end").value=ov.bgEnd||ec.bgEnd}
  document.getElementById("at-title-color").value=config.titleColor||"#FFD700";document.getElementById("at-title-color-on").className="toggle"+(config.titleColor?" on":"");
  document.getElementById("at-text-color").value=config.textColor||"#FFFFFF";document.getElementById("at-text-color-on").className="toggle"+(config.textColor?" on":"");
  document.getElementById("at-btn-color").value=config.btnTextColor||"#1a1a2e";document.getElementById("at-btn-color-on").className="toggle"+(config.btnTextColor?" on":"");
  var fList=document.getElementById("at-font-display");h="";
  FONT_DISPLAY_OPTIONS.forEach(function(cat){h+='<div class="font-cat-title">'+cat.cat+"</div>";
    cat.fonts.forEach(function(f){h+='<div class="font-option '+(config.fontDisplay===f.v?"selected":"")+'" onclick="selectFontDisplay(\''+f.v.replace(/'/g,"\\'")+'\')" style="font-family:'+f.v+',sans-serif"><span style="font-size:20px">ë³´ë¬¼ì°¾ê¸° ëŒ€ëª¨í—˜!</span><br><span style="font-size:11px;font-family:var(--font-body);color:var(--text-dim)">'+f.l+" â€” "+f.s+"</span></div>"})});fList.innerHTML=h;
  var bSel=document.getElementById("at-font-body");bSel.innerHTML="";FONT_BODY_OPTIONS.forEach(function(f){var o=document.createElement("option");o.value=f.v;o.textContent=f.l;if(config.fontBody===f.v)o.selected=true;bSel.appendChild(o)});
  var bgP=document.getElementById("at-bg-preview");
  if(config.bgImage)bgP.innerHTML='<img src="'+config.bgImage+'" class="upload-preview"><p style="font-size:11px;color:var(--text-dim);margin-top:6px">í´ë¦­í•˜ì—¬ ë³€ê²½ | <span style="color:var(--error);cursor:pointer" onclick="event.stopPropagation();removeBgImage()">ì‚­ì œ</span></p>';
  else bgP.innerHTML='<div style="font-size:36px;margin-bottom:8px">ğŸ–¼ï¸</div><p style="font-size:13px;color:var(--text-muted)">ë°°ê²½ ì´ë¯¸ì§€ ì—…ë¡œë“œ</p><p style="font-size:11px;color:var(--text-dim)">PNG, JPG (ê¶Œì¥: 1080x1920)</p>';
  document.getElementById("at-bg-overlay").value=config.bgOverlay||"rgba(0,0,0,0.3)";
  document.getElementById("at-bg-fit").value=config.bgFit||"cover";
  document.getElementById("at-bg-fixed").className="toggle"+(config.bgFixed!==false?" on":"");
  renderDecoAdmin()}

function selectTheme(k){config.theme=k;renderAdminTheme();applyTheme()}
function selectFontDisplay(v){config.fontDisplay=v;renderAdminTheme();applyTheme()}
function toggleColorOverride(){var ov=config.colorOverride||{};ov.enabled=!ov.enabled;
  if(ov.enabled&&!ov.primary){var base=config.theme==="custom"?config.customColors:(THEMES[config.theme]||THEMES.treasure);ov.primary=base.primary;ov.secondary=base.secondary;ov.accent=base.accent;ov.bgStart=base.bgStart;ov.bgMid=base.bgMid;ov.bgEnd=base.bgEnd}
  config.colorOverride=ov;renderAdminTheme();applyTheme()}
function updateOverrideColor(key){var ov=config.colorOverride||{};
  var idMap={primary:"ov-primary",secondary:"ov-secondary",accent:"ov-accent",bgStart:"ov-bg-start",bgMid:"ov-bg-mid",bgEnd:"ov-bg-end"};
  var el=document.getElementById(idMap[key]);if(el)ov[key]=el.value;config.colorOverride=ov;applyTheme()}
function toggleTitleColor(){config.titleColor=config.titleColor?"":document.getElementById("at-title-color").value;renderAdminTheme();applyTheme()}
function toggleTextColor(){config.textColor=config.textColor?"":document.getElementById("at-text-color").value;renderAdminTheme();applyTheme()}
function toggleBtnColor(){config.btnTextColor=config.btnTextColor?"":document.getElementById("at-btn-color").value;renderAdminTheme();applyTheme()}
function toggleBgFixed(){config.bgFixed=!config.bgFixed;renderAdminTheme();applyTheme()}
async function onBgImageUpload(input){if(!input.files||!input.files[0])return;var b=await fileToBase64(input.files[0],500);config.bgImage=b;renderAdminTheme();applyTheme();input.value=""}
function removeBgImage(){config.bgImage="";localStorage.removeItem("fh_bg");renderAdminTheme();applyTheme()}
async function onDecoUpload(input){if(!input.files||!input.files[0])return;if(!config.decorations)config.decorations=[];if(config.decorations.length>=8){toast("ìµœëŒ€ 8ê°œ","err");input.value="";return}var b=await fileToBase64(input.files[0],200);config.decorations.push({data:b,x:10+Math.random()*60,y:10+Math.random()*60,anim:"deco-float",size:15,opacity:0.7,rotate:0});renderDecoAdmin();applyTheme();input.value=""}
function renderDecoAdmin(){var list=document.getElementById("at-deco-list"),h="";
  (config.decorations||[]).forEach(function(d,i){
    h+='<div class="deco-admin-card"><img src="'+d.data+'">';
    h+='<div style="flex:1;display:flex;flex-direction:column;gap:6px">';
    h+='<div class="xy-grid"><span>X</span><input type="range" min="0" max="95" value="'+Math.round(d.x||10)+'" oninput="updateDeco('+i+",'x',+this.value)\"><span>Y</span><input type=\"range\" min=\"0\" max=\"95\" value=\""+Math.round(d.y||10)+"\" oninput=\"updateDeco("+i+",'y',+this.value)\"></div>";
    h+='<div class="xy-grid"><span>í¬ê¸°</span><input type="range" min="3" max="50" value="'+(d.size||15)+'" oninput="updateDeco('+i+",'size',+this.value)\"><span>íˆ¬ëª…</span><input type=\"range\" min=\"10\" max=\"100\" value=\""+Math.round((d.opacity!=null?d.opacity:0.7)*100)+"\" oninput=\"updateDeco("+i+",'opacity',this.value/100)\"></div>";
    h+='<div class="xy-grid"><span>íšŒì „</span><input type="range" min="-180" max="180" value="'+(d.rotate||0)+'" oninput="updateDeco('+i+",'rotate',+this.value)\" style=\"grid-column:2/5\"></div>";
    h+='<select class="inp inp-xs" onchange="updateDeco('+i+",'anim',this.value)\">";DECO_ANIMS.forEach(function(a){h+='<option value="'+a.v+'"'+(d.anim===a.v?" selected":"")+">"+a.l+"</option>"});h+="</select>";
    h+='<button class="btn btn-danger btn-xs" style="align-self:flex-end" onclick="removeDeco('+i+')">ì‚­ì œ</button>';
    h+="</div></div>"});
  if(!h)h='<p style="text-align:center;color:var(--text-dim);font-size:13px;padding:16px">ì¥ì‹ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>';list.innerHTML=h}
function updateDeco(i,k,v){if(config.decorations&&config.decorations[i]){config.decorations[i][k]=v;applyTheme()}}
function removeDeco(i){if(config.decorations){config.decorations.splice(i,1);renderDecoAdmin();applyTheme()}}

async function saveAdminTheme(){
  config.fontBody=document.getElementById("at-font-body").value;
  if(config.titleColor)config.titleColor=document.getElementById("at-title-color").value;
  if(config.textColor)config.textColor=document.getElementById("at-text-color").value;
  if(config.btnTextColor)config.btnTextColor=document.getElementById("at-btn-color").value;
  if(config.theme==="custom")config.customColors={primary:document.getElementById("cc-primary").value,secondary:document.getElementById("cc-secondary").value,accent:document.getElementById("cc-accent").value,bgStart:document.getElementById("cc-bg-start").value,bgMid:document.getElementById("cc-bg-mid").value,bgEnd:document.getElementById("cc-bg-end").value};
  if(config.colorOverride&&config.colorOverride.enabled){var ov=config.colorOverride;ov.primary=document.getElementById("ov-primary").value;ov.secondary=document.getElementById("ov-secondary").value;ov.accent=document.getElementById("ov-accent").value;ov.bgStart=document.getElementById("ov-bg-start").value;ov.bgMid=document.getElementById("ov-bg-mid").value;ov.bgEnd=document.getElementById("ov-bg-end").value}
  config.bgOverlay=document.getElementById("at-bg-overlay").value;
  config.bgFit=document.getElementById("at-bg-fit").value;
  await saveConfig();applyTheme();toast("í…Œë§ˆ ì €ì¥ ì™„ë£Œ!")}

/* â”€â”€ ë¯¸ì…˜ â”€â”€ */
function renderAdminMissions(){var list=document.getElementById("am-list"),h="",mc=config.missions.length;for(var i=0;i<mc;i++){var m=config.missions[i];h+='<div class="admin-group" style="border-left:3px solid '+getMissionColor(i)+'"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><span style="font-size:14px;font-weight:900;color:'+getMissionColor(i)+'">ë¯¸ì…˜ '+(i+1)+"</span>";if(mc>2)h+='<button class="btn btn-danger btn-sm" onclick="removeMission('+i+')">ì‚­ì œ</button>';h+='</div><div style="display:flex;gap:8px;margin-bottom:8px"><select class="inp inp-sm am-emoji" style="width:70px;font-size:20px;text-align:center" data-idx="'+i+'">';EMOJI_LIST.forEach(function(e){h+='<option value="'+e+'"'+(m.emoji===e?" selected":"")+">"+e+"</option>"});h+='</select><input class="inp inp-sm am-name" placeholder="ë¯¸ì…˜ ì´ë¦„" value="'+m.name+'" data-idx="'+i+'" style="flex:1"></div><textarea class="inp inp-sm am-hint" rows="2" placeholder="ìœ„ì¹˜ íŒíŠ¸" data-idx="'+i+'" style="resize:vertical">'+m.hint+"</textarea><p style=\"margin-top:6px;font-size:11px;color:rgba(255,255,255,.3)\">QR: "+m.code+"</p></div>"}list.innerHTML=h;document.getElementById("am-add-btn").style.display=mc>=10?"none":"block"}
function addMission(){if(config.missions.length>=10){toast("ìµœëŒ€ 10ê°œ","err");return}config.missions.push({name:"ìƒˆ ë¯¸ì…˜",hint:"íŒíŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",emoji:EMOJI_LIST[config.missions.length%EMOJI_LIST.length],code:generateCode()});config.missionCount=config.missions.length;renderAdminMissions()}
function removeMission(i){if(config.missions.length<=2)return;if(!confirm("ë¯¸ì…˜ "+(i+1)+" ì‚­ì œ?"))return;config.missions.splice(i,1);config.missionCount=config.missions.length;renderAdminMissions()}
async function saveAdminMissions(){document.querySelectorAll(".am-name").forEach(function(el){config.missions[+el.dataset.idx].name=el.value});document.querySelectorAll(".am-hint").forEach(function(el){config.missions[+el.dataset.idx].hint=el.value});document.querySelectorAll(".am-emoji").forEach(function(el){config.missions[+el.dataset.idx].emoji=el.value});config.missionCount=config.missions.length;await saveConfig();toast("ë¯¸ì…˜ ì €ì¥ ì™„ë£Œ!")}

/* â”€â”€ ë³´ìƒ â”€â”€ */
function renderAdminRewards(){document.getElementById("ar-title").value=config.rewardTitle;document.getElementById("ar-desc").value=config.rewardDesc}
async function saveAdminRewards(){config.rewardTitle=document.getElementById("ar-title").value;config.rewardDesc=document.getElementById("ar-desc").value;await saveConfig();toast("ë³´ìƒ ì €ì¥ ì™„ë£Œ!")}
function renderAdminQR(){var g=document.getElementById("aq-grid"),h="";for(var i=0;i<config.missions.length;i++){var m=config.missions[i];h+='<div class="qr-card"><p style="font-size:13px;font-weight:900;color:#1a1a2e;margin-bottom:6px">'+m.emoji+" "+m.name+'</p><img src="'+generateQRDataURL(m.code)+'"><p style="font-size:11px;color:#999;margin-top:4px">'+m.code+"</p></div>"}g.innerHTML=h}

/* â”€â”€ ì°¸ê°€ì â”€â”€ */
async function renderAdminParticipants(){var pts=await getParticipants(),mc=config.missions.length,tc=0;pts.forEach(function(p){if((p.completedMissions||[]).length>=mc)tc++});document.getElementById("ap-total").textContent=pts.length;document.getElementById("ap-complete").textContent=tc;document.getElementById("ap-progress").textContent=pts.length?Math.round(pts.reduce(function(s,p){return s+(p.completedMissions||[]).length},0)/pts.length*10)/10:"0";
  var list=document.getElementById("ap-list");if(!pts.length){list.innerHTML='<p style="text-align:center;color:var(--text-dim);padding:40px 0">ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤</p>';return}pts.sort(function(a,b){return(b.completedMissions||[]).length-(a.completedMissions||[]).length});var h="";pts.forEach(function(p){var cm=p.completedMissions||[];h+='<div class="pt-row"><div><p style="font-weight:700;font-size:14px">'+p.name+'</p><p style="font-size:11px;color:var(--text-dim)">'+cm.length+'/'+mc+'</p></div><div>';for(var j=0;j<mc;j++){var d=cm.indexOf(j)>=0;h+='<span class="mini-dot" style="background:'+(d?"#4CAF50":"rgba(255,255,255,.08)")+";color:"+(d?"#fff":"rgba(255,255,255,.25)")+'">'+(d?"âœ“":(j+1))+"</span>"}h+="</div></div>"});list.innerHTML=h}

/* â”€â”€ ë°ì´í„° â”€â”€ */
async function exportParticipants(){var pts=await getParticipants();if(!pts.length){toast("ì°¸ê°€ì ì—†ìŒ","err");return}var mc=config.missions.length,csv="\uFEFFì´ë¦„,ì—°ë½ì²˜,ìƒë…„ì›”ì¼,ë“±ë¡ì¼,ì™„ë£Œìˆ˜";for(var i=0;i<mc;i++)csv+=",ë¯¸ì…˜"+(i+1);csv+="\n";pts.forEach(function(p){var cm=p.completedMissions||[];csv+=p.name+","+p.phone+","+p.birthdate+","+(p.registeredAt||"")+","+cm.length;for(var i=0;i<mc;i++)csv+=","+(cm.indexOf(i)>=0?"O":"X");csv+="\n"});var a=document.createElement("a");a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv;charset=utf-8"}));a.download=config.festivalName+"_ì°¸ê°€ì.csv";a.click();toast("CSV ë‹¤ìš´ë¡œë“œ!")}
async function resetAllData(){if(!confirm("ëª¨ë“  ì°¸ê°€ì ì‚­ì œ?"))return;if(!confirm("ì •ë§ ì‚­ì œ?"))return;localStorage.removeItem("fh_participants");localStorage.removeItem("fh_player");player=null;completed=[];if(useFirebase&&db){try{var s=await db.collection("participants").get(),b=db.batch();s.forEach(function(d){b.delete(d.ref)});await b.commit()}catch(e){}}toast("ì°¸ê°€ì ì´ˆê¸°í™” ì™„ë£Œ");renderAdminParticipants()}
async function resetConfigToDefault(){if(!confirm("ì„¤ì • ì´ˆê¸°í™”?"))return;config=JSON.parse(JSON.stringify(DEFAULT_CONFIG));for(var i=0;i<config.missions.length;i++)config.missions[i].code=generateCode();await saveConfig();applyTheme();toast("ì„¤ì • ì´ˆê¸°í™” ì™„ë£Œ");showAdmin("basic")}
function exportConfig(){var c=JSON.parse(JSON.stringify(config));c.bgImage="";c.logoImage="";c.logoImage2="";c.decorations=(c.decorations||[]).map(function(d){return Object.assign({},d,{data:""})});var a=document.createElement("a");a.href=URL.createObjectURL(new Blob([JSON.stringify(c,null,2)],{type:"application/json"}));a.download=config.festivalName+"_ì„¤ì •.json";a.click();toast("ì„¤ì • ë‹¤ìš´ë¡œë“œ! (ì´ë¯¸ì§€ëŠ” ë³„ë„ ë°±ì—… í•„ìš”)")}
function importConfig(){document.getElementById("ad-import-file").click()}
function onImportConfig(input){if(!input.files||!input.files[0])return;var r=new FileReader();r.onload=async function(e){try{var o=JSON.parse(e.target.result);if(!o.festivalName){toast("ì˜¬ë°”ë¥´ì§€ ì•Šì€ íŒŒì¼","err");return}config=o;if(!config.colorOverride)config.colorOverride={enabled:false};await saveConfig();applyTheme();toast("ì„¤ì • ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!");showAdmin("basic")}catch(e){toast("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨","err")}};r.readAsText(input.files[0]);input.value=""}

/* â•â•â• START â•â•â• */
async function startApp(){initFirebase();await loadConfig();applyTheme();var sp=JSON.parse(localStorage.getItem("fh_player")||"null");if(sp){player=sp;completed=sp.completedMissions||[]}if(player)showMissions();else showHome()}
startApp();
</script>

<!-- HOME -->
<div id="pg-home" class="page active">
<div class="center" style="position:relative">
<div class="sparkle-wrap" id="home-sparkles"></div>
<div id="home-icon" class="float" style="font-size:88px;margin-bottom:12px;filter:drop-shadow(0 8px 24px rgba(var(--primary-rgb),.4))">ğŸ—ºï¸</div>
<h1 id="home-title" class="title gold" style="font-size:clamp(32px,8vw,48px);line-height:1.2;margin-bottom:6px">ë³´ë¬¼ì°¾ê¸°</h1>
<p id="home-sub" style="font-size:16px;color:var(--text-muted);margin-bottom:40px;font-weight:600"></p>
<button class="btn btn-gold glow" style="max-width:320px" onclick="showRegister()">ğŸš€ ìƒˆë¡œ ì‹œì‘í•˜ê¸°</button>
<button class="btn btn-accent" style="margin-top:12px;max-width:320px" onclick="showLogin()">ğŸ”„ ì´ì–´í•˜ê¸°</button>
</div>
<!-- í•˜ë‹¨ ë¡œê³  ì˜ì—­ -->
<div id="home-logo-area" class="home-logo-area"></div>
</div>

<!-- REGISTER -->
<div id="pg-register" class="page"><button class="btn" style="align-self:flex-start;background:none;color:var(--text-muted);font-size:15px;padding:8px 0" onclick="showHome()">â† ë’¤ë¡œ</button><div class="center" style="max-width:400px;margin:0 auto;width:100%"><div style="font-size:52px;margin-bottom:10px">ğŸ´â€â˜ ï¸</div><h2 class="title gold" style="font-size:26px">ëª¨í—˜ê°€ ë“±ë¡</h2><p style="color:var(--text-dim);font-size:13px;margin-bottom:24px">ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p><div style="display:flex;flex-direction:column;gap:16px;width:100%"><div><label class="admin-label">ğŸ‘¤ ì´ë¦„</label><input id="reg-name" class="inp" placeholder="í™ê¸¸ë™"></div><div><label class="admin-label">ğŸ“± ì—°ë½ì²˜</label><input id="reg-phone" class="inp" placeholder="01012345678" type="tel"></div><div><label class="admin-label">ğŸ‚ ìƒë…„ì›”ì¼ (ì• 6ìë¦¬)</label><input id="reg-birth" class="inp" placeholder="990101" type="tel" maxlength="6" oninput="this.value=this.value.replace(/\D/g,'').slice(0,6)"></div></div><div id="reg-err" class="err-box" style="display:none"></div><button class="btn btn-gold" style="margin-top:24px" onclick="doRegister()">âœ¨ ë“±ë¡ ì™„ë£Œ</button></div></div>
<!-- LOGIN -->
<div id="pg-login" class="page"><button class="btn" style="align-self:flex-start;background:none;color:var(--text-muted);font-size:15px;padding:8px 0" onclick="showHome()">â† ë’¤ë¡œ</button><div class="center" style="max-width:400px;margin:0 auto;width:100%"><div style="font-size:52px;margin-bottom:10px">ğŸ”„</div><h2 class="title gold" style="font-size:26px">ì´ì–´í•˜ê¸°</h2><p style="color:var(--text-dim);font-size:13px;margin-bottom:24px">ë“±ë¡ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p><div style="display:flex;flex-direction:column;gap:16px;width:100%"><div><label class="admin-label">ğŸ“± ì—°ë½ì²˜</label><input id="login-phone" class="inp" placeholder="01012345678" type="tel"></div><div><label class="admin-label">ğŸ‚ ìƒë…„ì›”ì¼</label><input id="login-birth" class="inp" placeholder="990101" type="tel" maxlength="6" oninput="this.value=this.value.replace(/\D/g,'').slice(0,6)"></div></div><div id="login-err" class="err-box" style="display:none"></div><button class="btn btn-gold" style="margin-top:24px" onclick="doLogin()">ğŸ”“ ë¶ˆëŸ¬ì˜¤ê¸°</button></div></div>
<!-- MISSIONS -->
<div id="pg-missions" class="page"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><button class="btn btn-sm" style="background:none;border:none;color:var(--text-dim);font-size:12px" onclick="player=null;localStorage.removeItem('fh_player');completed=[];showHome()">â† ë‚˜ê°€ê¸°</button><button class="btn btn-sm" style="background:rgba(var(--primary-rgb),.12);border:1px solid rgba(var(--primary-rgb),.25);color:var(--primary);border-radius:20px;font-weight:700;font-size:12px" onclick="showRewards()">ğŸ ë³´ìƒ</button></div><div style="text-align:center;margin-bottom:20px"><p id="m-festival" style="font-size:12px;color:var(--text-dim);margin-bottom:2px"></p><p style="font-size:13px;color:var(--text-muted)">ì•ˆë…•, <span style="color:var(--primary);font-weight:700" id="m-player-name"></span>!</p><h2 class="title" style="font-size:24px">ë¯¸ì…˜ ë³´ë“œ</h2><div id="m-dots" style="display:flex;justify-content:center;gap:6px;margin-top:10px;flex-wrap:wrap"></div><p id="m-count" style="margin-top:8px;font-size:14px;color:var(--text-muted);font-weight:600"></p></div><div id="m-grid" class="mission-grid"></div><button id="m-complete-btn" class="btn btn-gold glow" style="margin-top:20px;display:none" onclick="showComplete()">ğŸ† ëª¨ë“  ë¯¸ì…˜ ì™„ë£Œ!</button></div>
<!-- SCAN INFO -->
<div id="pg-scan-info" class="page"><button class="btn" style="align-self:flex-start;background:none;border:none;color:var(--text-muted);font-size:15px;padding:8px 0" onclick="showMissions()">â† ë¯¸ì…˜ ë³´ë“œ</button><div class="center" style="max-width:400px;margin:0 auto;width:100%"><div id="si-emoji" style="font-size:60px;margin-bottom:12px"></div><h2 id="si-name" class="title" style="font-size:22px;margin-bottom:8px"></h2><div class="card" style="margin-bottom:28px;width:100%"><p style="font-size:12px;color:var(--text-dim);margin-bottom:6px;font-weight:700">ğŸ“ ìœ„ì¹˜ íŒíŠ¸</p><p id="si-hint" style="font-size:16px;color:var(--primary);font-weight:700;line-height:1.6"></p></div><button class="btn btn-gold" style="width:100%" onclick="showScanCamera()">ğŸ“· QRì½”ë“œ ìŠ¤ìº”í•˜ê¸°</button></div></div>
<!-- SCAN CAM -->
<div id="pg-scan-cam" class="page"><button class="btn" style="align-self:flex-start;background:none;border:none;color:var(--text-muted);font-size:15px;padding:8px 0" onclick="stopCamera();showMissions()">â† ë¯¸ì…˜ ë³´ë“œ</button><div class="center"><input type="file" id="sc-file-input" accept="image/*" capture="environment" style="display:none" onchange="onPhotoCaptured(this)"><div id="sc-main" style="display:flex;flex-direction:column;align-items:center;width:100%;max-width:340px"><div style="font-size:60px;margin-bottom:12px">ğŸ“·</div><h3 class="title" style="font-size:20px;margin-bottom:6px">QRì½”ë“œ ìŠ¤ìº”</h3><p style="color:var(--text-muted);font-size:13px;margin-bottom:14px">QRì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”!</p><p id="sc-env-msg" style="display:none;font-size:12px;padding:10px;border-radius:10px;background:rgba(var(--primary-rgb),.1);color:var(--primary);margin-bottom:14px;width:100%">HTTPS í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤. ì‚¬ì§„ ì´¬ì˜ì„ ì´ìš©í•´ì£¼ì„¸ìš”.</p><button id="sc-btn-stream" class="btn btn-gold" style="margin-bottom:10px;width:100%;font-size:16px;padding:16px" onclick="tryLiveCamera()">ğŸ“· ì‹¤ì‹œê°„ ì¹´ë©”ë¼</button><button class="btn btn-accent" style="width:100%;font-size:16px;padding:16px" onclick="triggerPhotoCapture()">ğŸ“¸ ì‚¬ì§„ ì°ê¸°</button></div><div id="sc-live" style="display:none;flex-direction:column;align-items:center;width:100%"><div style="width:100%;max-width:300px;aspect-ratio:1;border-radius:20px;overflow:hidden;border:3px solid rgba(var(--primary-rgb),.4);position:relative;background:#000;margin-bottom:10px"><video id="sc-video" playsinline muted autoplay></video><div style="position:absolute;inset:20%;border:3px solid rgba(var(--primary-rgb),.5);border-radius:14px;pointer-events:none"></div></div><p id="sc-live-status" style="font-size:13px;color:var(--primary);text-align:center;margin-bottom:10px;white-space:pre-wrap"></p><div style="display:flex;gap:8px;width:100%;max-width:300px"><button class="btn btn-accent" style="flex:1;font-size:13px;padding:10px" onclick="stopCamera();triggerPhotoCapture()">ğŸ“¸ ì‚¬ì§„</button><button class="btn btn-ghost" style="flex:1;font-size:13px;padding:10px" onclick="stopCamera();showScanCamera()">â† ëŒì•„ê°€ê¸°</button></div></div><div id="sc-photo-result" style="display:none;flex-direction:column;align-items:center;width:100%"><div style="width:100%;max-width:260px;border-radius:18px;overflow:hidden;border:3px solid rgba(var(--accent-rgb),.4);margin-bottom:10px;background:#000"><img id="sc-photo-img" style="width:100%;display:block"></div><p id="sc-photo-status" style="font-size:13px;color:var(--primary);text-align:center;margin-bottom:14px;white-space:pre-wrap;line-height:1.6"></p><div id="sc-photo-retry" style="display:none;flex-direction:column;gap:8px;width:100%;max-width:300px"><button class="btn btn-accent" style="width:100%;font-size:15px;padding:14px" onclick="triggerPhotoCapture()">ğŸ“¸ ë‹¤ì‹œ ì°ê¸°</button><button class="btn btn-ghost" style="width:100%;font-size:13px;padding:10px" onclick="showScanCamera()">â† ëŒì•„ê°€ê¸°</button></div></div></div></div>
<!-- SUCCESS -->
<div id="pg-success" class="page"><div class="confetti-wrap" id="su-confetti"></div><div class="center"><div class="bounce" style="font-size:88px;margin-bottom:12px">ğŸ‰</div><h2 class="title bounce gold" style="font-size:30px;margin-bottom:6px">ë¯¸ì…˜ ì„±ê³µ!</h2><p id="su-mission" style="font-size:16px;color:var(--text-muted);margin-bottom:6px"></p><p id="su-count" style="font-size:14px;color:var(--text-dim);margin-bottom:32px"></p><div id="su-dots" style="display:flex;gap:10px;margin-bottom:28px;flex-wrap:wrap;justify-content:center"></div><button id="su-btn" class="btn btn-gold glow" style="max-width:320px"></button></div></div>
<!-- COMPLETE -->
<div id="pg-complete" class="page"><div class="confetti-wrap" id="cp-confetti"></div><div class="center" style="position:relative"><div class="sparkle-wrap" id="cp-sparkles"></div><div class="bounce" style="font-size:92px;margin-bottom:12px">ğŸ†</div><h2 class="title" style="font-size:30px;background:linear-gradient(135deg,var(--primary),var(--secondary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px">ì¶•í•˜í•©ë‹ˆë‹¤!</h2><p style="font-size:16px;color:var(--text-muted);margin-bottom:20px;font-weight:700">ëª¨ë“  ë³´ë¬¼ì„ ì°¾ì•˜ì–´ìš”!</p><div style="background:rgba(var(--primary-rgb),.06);border:2px solid rgba(var(--primary-rgb),.2);border-radius:18px;padding:24px 20px;width:100%;max-width:360px;margin-bottom:28px"><h3 id="cp-reward-title" class="title" style="font-size:18px;color:var(--primary);margin-bottom:10px"></h3><p id="cp-reward-desc" style="font-size:14px;color:var(--text-muted);line-height:1.7;white-space:pre-wrap"></p><div style="margin-top:16px;padding-top:14px;border-top:1px solid rgba(255,255,255,.08)"><p id="cp-festival" style="font-size:12px;color:var(--text-dim)"></p><p id="cp-pname" style="font-size:12px;color:var(--text-dim)"></p><p id="cp-time" style="font-size:12px;color:var(--text-dim)"></p></div></div><button class="btn btn-ghost" onclick="showMissions()">â† ë¯¸ì…˜ ë³´ë“œë¡œ</button></div></div>
<!-- REWARDS -->
<div id="pg-rewards" class="page"><button class="btn" style="align-self:flex-start;background:none;border:none;color:var(--text-muted);font-size:15px;padding:8px 0" onclick="showMissions()">â† ë’¤ë¡œ</button><div class="center" style="position:relative"><div class="sparkle-wrap" id="rw-sparkles"></div><div class="float" style="font-size:64px;margin-bottom:16px">ğŸ</div><h2 class="title gold" style="font-size:26px;margin-bottom:16px">ë¯¸ì…˜ ë³´ìƒ ì•ˆë‚´</h2><div style="background:rgba(var(--primary-rgb),.05);border:2px solid rgba(var(--primary-rgb),.15);border-radius:18px;padding:28px 20px;width:100%;max-width:400px"><h3 id="rw-title" style="font-size:18px;font-weight:900;color:var(--primary);margin-bottom:12px"></h3><p id="rw-desc" style="font-size:15px;color:var(--text-muted);line-height:1.8;white-space:pre-wrap"></p></div></div></div>
<!-- ADMIN LOGIN -->
<div id="pg-admin-login" class="page"><button class="btn" style="align-self:flex-start;background:none;border:none;color:var(--text-muted);font-size:15px;padding:8px 0" onclick="showHome()">â† ë’¤ë¡œ</button><div class="center"><div style="font-size:52px;margin-bottom:16px">ğŸ”</div><h2 class="title" style="font-size:22px;margin-bottom:20px">ê´€ë¦¬ì ë¡œê·¸ì¸</h2><input id="al-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" class="inp" style="max-width:280px;text-align:center;font-size:17px" onkeydown="if(event.key==='Enter')doAdminLogin()"><p id="al-err" class="err-box shake" style="display:none">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”!</p><button class="btn btn-accent" style="margin-top:16px;max-width:280px" onclick="doAdminLogin()">ë¡œê·¸ì¸</button></div></div>

<!-- â•â•â• ADMIN PANEL â•â•â• -->
<div id="pg-admin" class="page"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><button class="btn" style="background:none;border:none;color:var(--text-muted);font-size:14px" onclick="showHome()">â† ë‚˜ê°€ê¸°</button><h2 class="title" style="font-size:18px;color:var(--accent)">âš™ï¸ ê´€ë¦¬ì</h2><div style="width:50px"></div></div>
<div class="admin-tabs"><button id="tbn-basic" class="tab-btn active" onclick="showAdmin('basic')">ğŸ  ê¸°ë³¸</button><button id="tbn-theme" class="tab-btn inactive" onclick="showAdmin('theme')">ğŸ¨ í…Œë§ˆ</button><button id="tbn-missions" class="tab-btn inactive" onclick="showAdmin('missions')">ğŸ“ ë¯¸ì…˜</button><button id="tbn-rewards" class="tab-btn inactive" onclick="showAdmin('rewards')">ğŸ ë³´ìƒ</button><button id="tbn-qrcodes" class="tab-btn inactive" onclick="showAdmin('qrcodes')">ğŸ“± QR</button><button id="tbn-participants" class="tab-btn inactive" onclick="showAdmin('participants')">ğŸ‘¥ ì°¸ê°€ì</button><button id="tbn-data" class="tab-btn inactive" onclick="showAdmin('data')">ğŸ’¾ ë°ì´í„°</button></div>

<!-- ê¸°ë³¸ -->
<div id="adm-basic" class="admin-section active">
<div class="admin-group"><label class="admin-label">ğŸª ì¶•ì œ ì´ë¦„</label><input id="ab-name" class="inp" placeholder="ì¶•ì œ ì´ë¦„"><div style="height:12px"></div><label class="admin-label">ğŸ“ ë¶€ì œëª©</label><input id="ab-sub" class="inp" placeholder="ë¶€ì œëª©"><div style="height:12px"></div><div style="display:flex;gap:10px"><div style="flex:1"><label class="admin-label">ğŸ­ ì•„ì´ì½˜</label><input id="ab-icon" class="inp" placeholder="ğŸ—ºï¸" style="text-align:center;font-size:28px"></div><div style="flex:1"><label class="admin-label">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸</label><input id="ab-pw" class="inp" type="text" placeholder="1234"></div></div></div>

<!-- ë¡œê³  ì„¤ì • -->
<div class="admin-group">
<label class="admin-label" style="font-size:15px">ğŸ›ï¸ ë©”ì¸í™”ë©´ í•˜ë‹¨ ë¡œê³ </label>
<p style="font-size:11px;color:var(--text-dim);margin-bottom:12px">ë©”ì¸ í™”ë©´ í•˜ë‹¨ì— í‘œì‹œë  ë¡œê³  ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš” (PNG ê¶Œì¥)</p>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
<div class="upload-zone" style="padding:14px" onclick="document.getElementById('ab-logo1-file').click()">
<input type="file" id="ab-logo1-file" accept="image/*" style="display:none" onchange="onLogoUpload(1,this)">
<div id="ab-logo1-preview"></div>
</div>
<div class="upload-zone" style="padding:14px" onclick="document.getElementById('ab-logo2-file').click()">
<input type="file" id="ab-logo2-file" accept="image/*" style="display:none" onchange="onLogoUpload(2,this)">
<div id="ab-logo2-preview"></div>
</div>
</div>
<label class="admin-label">ë¡œê³  í•˜ë‹¨ í…ìŠ¤íŠ¸</label>
<input id="ab-logo-text" class="inp inp-sm" placeholder="ëŒ€ì „ê´‘ì—­ì‹œ Â· ëŒ€ì „ê´€ê´‘ê³µì‚¬">
</div>

<button class="btn btn-accent" onclick="saveAdminBasic()">ğŸ’¾ ê¸°ë³¸ ì„¤ì • ì €ì¥</button>
<div class="divider"></div>
<div class="admin-group"><label class="admin-label">ğŸ”¥ Firebase ì—°ê²°</label><p id="ab-fb-status" style="font-size:13px;margin-bottom:10px"></p><textarea id="ab-fb-json" class="inp" rows="4" placeholder="Firebase ì„¤ì • JSON" style="font-size:12px;resize:vertical"></textarea><button class="btn btn-ghost" style="margin-top:8px;width:100%" onclick="saveFirebaseConfig()">Firebase ì—°ê²°í•˜ê¸°</button></div>
</div>

<!-- í…Œë§ˆ -->
<div id="adm-theme" class="admin-section">
<div class="admin-group"><label class="admin-label">ğŸ¨ í…Œë§ˆ í”„ë¦¬ì…‹ (12ì¢…)</label><div id="at-grid" class="theme-grid"></div></div>
<div id="at-custom" class="admin-group" style="display:none"><label class="admin-label">ğŸ–Œï¸ ì»¤ìŠ¤í…€ í…Œë§ˆ ê¸°ë³¸ ìƒ‰ìƒ</label><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div class="color-row"><input type="color" id="cc-primary" class="color-inp"><label>ë©”ì¸</label></div><div class="color-row"><input type="color" id="cc-secondary" class="color-inp"><label>ë³´ì¡°</label></div><div class="color-row"><input type="color" id="cc-accent" class="color-inp"><label>ê°•ì¡°</label></div><div class="color-row"><input type="color" id="cc-bg-start" class="color-inp"><label>ë°°ê²½1</label></div><div class="color-row"><input type="color" id="cc-bg-mid" class="color-inp"><label>ë°°ê²½2</label></div><div class="color-row"><input type="color" id="cc-bg-end" class="color-inp"><label>ë°°ê²½3</label></div></div></div>
<div class="admin-group"><label class="admin-label">ğŸ”§ ìƒ‰ìƒ ì»¤ìŠ¤í„°ë§ˆì´ì§•</label>
<p style="font-size:11px;color:var(--text-dim);margin-bottom:10px">í”„ë¦¬ì…‹ í…Œë§ˆë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒ‰ìƒë§Œ ì›í•˜ëŠ” ëŒ€ë¡œ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”</p>
<div class="toggle-row"><div id="at-ov-on" class="toggle" onclick="toggleColorOverride()"></div><span style="font-size:13px;color:var(--text-muted)">ìƒ‰ìƒ ì§ì ‘ ìˆ˜ì • í™œì„±í™”</span></div>
<div id="at-ov-panel" style="display:none;margin-top:12px"><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
<div class="color-row"><input type="color" id="ov-primary" class="color-inp" oninput="updateOverrideColor('primary')"><label>ë©”ì¸</label></div>
<div class="color-row"><input type="color" id="ov-secondary" class="color-inp" oninput="updateOverrideColor('secondary')"><label>ë³´ì¡°</label></div>
<div class="color-row"><input type="color" id="ov-accent" class="color-inp" oninput="updateOverrideColor('accent')"><label>ê°•ì¡°</label></div>
<div class="color-row"><input type="color" id="ov-bg-start" class="color-inp" oninput="updateOverrideColor('bgStart')"><label>ë°°ê²½1</label></div>
<div class="color-row"><input type="color" id="ov-bg-mid" class="color-inp" oninput="updateOverrideColor('bgMid')"><label>ë°°ê²½2</label></div>
<div class="color-row"><input type="color" id="ov-bg-end" class="color-inp" oninput="updateOverrideColor('bgEnd')"><label>ë°°ê²½3</label></div>
</div></div></div>
<div class="admin-group"><label class="admin-label">âœï¸ ê¸€ì ìƒ‰ìƒ</label>
<div class="toggle-row"><div id="at-title-color-on" class="toggle" onclick="toggleTitleColor()"></div><input type="color" id="at-title-color" class="color-inp" style="width:36px;height:36px" oninput="if(config.titleColor){config.titleColor=this.value;applyTheme()}"><span style="font-size:13px;color:var(--text-muted)">ì œëª© ìƒ‰ìƒ (ë„ë©´ ê·¸ë¼ë°ì´ì…˜)</span></div>
<div class="toggle-row"><div id="at-text-color-on" class="toggle" onclick="toggleTextColor()"></div><input type="color" id="at-text-color" class="color-inp" style="width:36px;height:36px" oninput="if(config.textColor){config.textColor=this.value;applyTheme()}"><span style="font-size:13px;color:var(--text-muted)">ë³¸ë¬¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ</span></div>
<div class="toggle-row"><div id="at-btn-color-on" class="toggle" onclick="toggleBtnColor()"></div><input type="color" id="at-btn-color" class="color-inp" style="width:36px;height:36px" oninput="if(config.btnTextColor){config.btnTextColor=this.value;applyTheme()}"><span style="font-size:13px;color:var(--text-muted)">ë²„íŠ¼ ê¸€ì ìƒ‰ìƒ</span></div>
</div>
<div class="admin-group"><label class="admin-label">ğŸ”¤ ì œëª© í°íŠ¸ (33ì¢…)</label><p style="font-size:11px;color:var(--text-dim);margin-bottom:8px">ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë¶„ë¥˜ë˜ì–´ ìˆì–´ìš”. í„°ì¹˜í•˜ë©´ ì¦‰ì‹œ ë¯¸ë¦¬ë³´ê¸°!</p><div id="at-font-display" style="max-height:350px;overflow-y:auto;padding-right:4px"></div></div>
<div class="admin-group"><label class="admin-label">ğŸ“– ë³¸ë¬¸ í°íŠ¸ (15ì¢…)</label><select id="at-font-body" class="inp" onchange="config.fontBody=this.value;applyTheme()"></select></div>
<div class="admin-group"><label class="admin-label">ğŸ–¼ï¸ ë°°ê²½ ì´ë¯¸ì§€</label>
<div class="upload-zone" onclick="document.getElementById('at-bg-file').click()"><input type="file" id="at-bg-file" accept="image/*" style="display:none" onchange="onBgImageUpload(this)"><div id="at-bg-preview"></div></div>
<div style="display:flex;gap:10px;margin-top:10px">
<div style="flex:1"><label class="admin-label" style="font-size:11px">ì˜¤ë²„ë ˆì´</label><input id="at-bg-overlay" class="inp inp-xs" placeholder="rgba(0,0,0,0.3)" style="font-size:11px"></div>
<div style="flex:1"><label class="admin-label" style="font-size:11px">ë§ì¶¤</label><select id="at-bg-fit" class="inp inp-xs" style="font-size:11px"><option value="cover">ê½‰ ì±„ìš°ê¸°</option><option value="contain">ë¹„ìœ¨ ìœ ì§€</option><option value="100% 100%">ëŠ˜ë¦¬ê¸°</option></select></div>
</div>
<div class="toggle-row" style="margin-top:6px"><div id="at-bg-fixed" class="toggle on" onclick="toggleBgFixed()"></div><span style="font-size:12px;color:var(--text-dim)">ë°°ê²½ ê³ ì • (ìŠ¤í¬ë¡¤í•´ë„ ì•ˆ ì›€ì§ì„)</span></div>
</div>
<div class="admin-group"><label class="admin-label">ğŸ€ ì¥ì‹ PNG ì´ë¯¸ì§€ (ìµœëŒ€ 8ê°œ)</label>
<p style="font-size:11px;color:var(--text-dim);margin-bottom:10px">íˆ¬ëª… PNG/GIFë¥¼ ì˜¬ë ¤ í™”ë©´ì„ ê¾¸ë©°ë³´ì„¸ìš”!</p>
<div id="at-deco-list"></div>
<div class="upload-zone" style="padding:16px;margin-top:8px" onclick="document.getElementById('at-deco-file').click()"><input type="file" id="at-deco-file" accept="image/png,image/gif,image/webp,image/svg+xml" style="display:none" onchange="onDecoUpload(this)"><span style="font-size:24px">â•</span><p style="font-size:12px;color:var(--text-muted);margin-top:4px">ì¥ì‹ ì´ë¯¸ì§€ ì¶”ê°€</p></div></div>
<button class="btn btn-accent" onclick="saveAdminTheme()">ğŸ’¾ í…Œë§ˆ ì „ì²´ ì €ì¥</button>
</div>

<!-- ë¯¸ì…˜ -->
<div id="adm-missions" class="admin-section"><div id="am-list"></div><button id="am-add-btn" class="btn btn-ghost" style="width:100%;margin-top:4px" onclick="addMission()">+ ë¯¸ì…˜ ì¶”ê°€ (ìµœëŒ€ 10ê°œ)</button><button class="btn btn-accent" style="margin-top:8px" onclick="saveAdminMissions()">ğŸ’¾ ë¯¸ì…˜ ì €ì¥</button></div>
<!-- ë³´ìƒ -->
<div id="adm-rewards" class="admin-section"><div class="admin-group"><label class="admin-label">ğŸ† ë³´ìƒ ì œëª©</label><input id="ar-title" class="inp" placeholder="ë³´ìƒ ì œëª©"><div style="height:12px"></div><label class="admin-label">ğŸ“‹ ë³´ìƒ ì„¤ëª…</label><textarea id="ar-desc" class="inp" rows="6" placeholder="ë³´ìƒ ì„¤ëª…" style="resize:vertical"></textarea></div><button class="btn btn-accent" onclick="saveAdminRewards()">ğŸ’¾ ë³´ìƒ ì €ì¥</button></div>
<!-- QR -->
<div id="adm-qrcodes" class="admin-section"><p style="font-size:13px;color:var(--text-muted);text-align:center;margin-bottom:8px">QRì½”ë“œë¥¼ ì¸ì‡„í•˜ì—¬ ìˆ¨ê²¨ì£¼ì„¸ìš”</p><div id="aq-grid" style="display:grid;grid-template-columns:1fr;gap:14px;max-width:300px;margin:0 auto"></div><button class="btn btn-accent" style="margin-top:16px" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button></div>
<!-- ì°¸ê°€ì -->
<div id="adm-participants" class="admin-section"><div style="display:flex;gap:10px;margin-bottom:14px"><div class="stat-card"><div class="stat-num" id="ap-total" style="color:var(--primary)">0</div><div style="font-size:11px;color:var(--text-dim)">ì°¸ê°€ì</div></div><div class="stat-card"><div class="stat-num" id="ap-complete" style="color:var(--success)">0</div><div style="font-size:11px;color:var(--text-dim)">ì™„ë£Œ</div></div><div class="stat-card"><div class="stat-num" id="ap-progress" style="color:var(--accent)">0</div><div style="font-size:11px;color:var(--text-dim)">í‰ê· </div></div></div><div style="display:flex;justify-content:flex-end;margin-bottom:10px"><button class="btn btn-ghost btn-sm" onclick="renderAdminParticipants()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button></div><div id="ap-list"></div></div>
<!-- ë°ì´í„° -->
<div id="adm-data" class="admin-section"><input type="file" id="ad-import-file" accept=".json" style="display:none" onchange="onImportConfig(this)"><div class="admin-group"><label class="admin-label" style="font-size:15px">ğŸ“¦ ì„¤ì • ë°±ì—… & ë³µì›</label><div style="display:flex;gap:8px"><button class="btn btn-accent btn-sm" style="flex:1" onclick="exportConfig()">â¬‡ï¸ ë‚´ë³´ë‚´ê¸°</button><button class="btn btn-ghost btn-sm" style="flex:1" onclick="importConfig()">â¬†ï¸ ê°€ì ¸ì˜¤ê¸°</button></div></div><div class="admin-group"><label class="admin-label" style="font-size:15px">ğŸ“Š ì°¸ê°€ì ë°ì´í„°</label><button class="btn btn-accent btn-sm" style="width:100%" onclick="exportParticipants()">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button></div><div class="divider"></div><div class="admin-group" style="border:1px solid rgba(255,107,107,.2)"><label class="admin-label" style="color:#FF6B6B">âš ï¸ ìœ„í—˜ êµ¬ì—­</label><button class="btn btn-danger" style="width:100%;margin-bottom:8px" onclick="resetAllData()">ğŸ—‘ï¸ ì°¸ê°€ì ì „ì²´ ì‚­ì œ</button><button class="btn btn-danger" style="width:100%" onclick="resetConfigToDefault()">ğŸ”„ ì„¤ì • ì´ˆê¸°í™”</button></div></div>
</div>
</body>
</html>
